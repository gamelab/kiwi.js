var Kiwi;!function(a){var b=function(){function b(b,c,d,e){"undefined"==typeof b&&(b=""),"undefined"==typeof c&&(c="KiwiGame"),"undefined"==typeof d&&(d=null),"undefined"==typeof e&&(e={});var f=this;if(this._startup=null,this.audio=null,this.fileStore=null,this.input=null,this.cameras=null,this.pluginManager=null,this.loader=null,this.raf=null,this.stage=null,this.states=null,this.time=null,this.tweens=null,this.rnd=null,this._frameRate=60,this._interval=1e3/60,this._delta=0,this._frame=0,console.log("Kiwi.Game: "+c+" is booting, using Kiwi.js version "+a.VERSION),null===a.DEVICE&&(a.DEVICE=new a.System.Device),"undefined"!==e.debug&&"number"==typeof e.debug)switch(e.debug){case a.DEBUG_ON:this._debugOption=e.debug,console.log("  Kiwi.Game: Debugging turned ON.");break;case a.DEBUG_OFF:this._debugOption=e.debug,console.log("  Kiwi.Game: Debugging turned OFF.");break;default:this._debugOption=a.DEBUG_ON,console.error("  Kiwi.Game: Debug option passed, but is not a valid option. Turned ON by default.")}else this._debugOption=a.DEBUG_ON,console.log("  Kiwi.Game: Debug option not specified. Turned ON by default.");if("undefined"!==e.bootCallback&&(this.bootCallbackOption=e.bootCallback),"undefined"!==e.deviceTarget&&"number"==typeof e.deviceTarget)switch(e.deviceTarget){case a.TARGET_BROWSER:this._deviceTargetOption=e.deviceTarget,console.log("  Kiwi.Game: Targeting BROWSERS.");break;case a.TARGET_COCOON:this._deviceTargetOption=e.deviceTarget,console.log("  Kiwi.Game: Targeting COCOONJS.");break;default:this._deviceTargetOption=a.TARGET_BROWSER,console.error("  Kiwi.Game: Target device specified, but is not a valid option. Defaulting to BROWSER.")}else this._deviceTargetOption=a.TARGET_BROWSER,console.log("  Kiwi.Game: Targeted device not specified. Defaulting to BROWSER");var g=a.RENDERER_WEBGL,h=a.RENDERER_CANVAS;if("undefined"!==e.renderer&&"number"==typeof e.renderer)switch(e.renderer){case a.RENDERER_CANVAS:this._renderOption=e.renderer,console.log("  Kiwi.Game: Rendering using CANVAS.");break;case a.RENDERER_WEBGL:a.DEVICE.webGL?(this._renderOption=e.renderer,console.log("  Kiwi.Game: Rendering using WEBGL.")):(this._renderOption=h,console.log("  Kiwi.Game: WEBGL renderer requested but device does not support WEBGL. Rendering using CANVAS."));break;case a.RENDERER_AUTO:a.DEVICE.webGL?(this._renderOption=g,console.log("  Kiwi.Game: Renderer auto-detected WEBGL.")):(this._renderOption=h,console.log("  Kiwi.Game: Renderer auto-detected CANVAS."));break;default:a.DEVICE.webGL?(this._renderOption=g,console.log("  Kiwi.Game: Renderer specified, but is not a valid option. Defaulting to WEBGL.")):(this._renderOption=h,console.log("  Kiwi.Game: Renderer specified, but is not a valid option. WEBGL renderer sought by default but device does not support WEBGL. Defaulting to CANVAS."))}else a.DEVICE.webGL?(this._renderOption=g,console.log("  Kiwi.Game: Renderer not specified. Defaulting to WEBGL.")):(this._renderOption=h,console.log("  Kiwi.Game: Renderer not specified. WEBGL renderer sought by default but device does not support WEBGL. Defaulting to CANVAS."));this.id=a.GameManager.register(this),this._startup=new a.System.Bootstrap,this.audio=new a.Sound.AudioManager(this),this.fileStore=new a.Files.FileStore(this),this.input=new a.Input.InputManager(this);var i=a.Stage.DEFAULT_WIDTH,j=a.Stage.DEFAULT_HEIGHT;if("undefined"!==e.width&&"number"==typeof e.width&&(i=e.width),"undefined"!==e.height&&"number"==typeof e.height&&(j=e.height),console.log("  Kiwi.Game: Stage Dimensions: "+i+"x"+j),"undefined"!==e.scaleType)switch(e.scaleType){case a.Stage.SCALE_FIT:console.log("  Kiwi.Game: Stage scaling set to FIT.");break;case a.Stage.SCALE_STRETCH:console.log("  Kiwi.Game: Stage scaling set to STRETCH.");break;case a.Stage.SCALE_NONE:console.log("  Kiwi.Game: Stage scaling set to NONE.");break;default:console.log("  Kiwi.Game: Stage specified, but is not a valid option. Set to NONE."),e.scaleType=0}else e.scaleType=0;this.stage=new a.Stage(this,c,i,j,e.scaleType),this.renderer=null,this.cameras=new a.CameraManager(this),this._deviceTargetOption!==a.TARGET_COCOON&&(this.huds=new a.HUD.HUDManager(this)),this.loader=new a.Files.Loader(this),this.states=new a.StateManager(this),this.rnd=new a.Utils.RandomDataGenerator([Date.now.toString()]),this.time=new a.Time.ClockManager(this),this.tweens=new a.Animations.Tweens.TweenManager(this),null!==d?this.states.addState(d,!0):console.log("  Kiwi.Game: Default State not passed."),this.pluginManager=new a.PluginManager(this,e.plugins),this.deviceTargetOption===a.TARGET_BROWSER?(console.log(""!==b?document.getElementById(b)?"  Kiwi.Game: Game being created inside "+b+".":'  Kiwi.Game: The element "'+b+'" could not be found. Appending the game to the body.':"  Kiwi.Game: No DOM parent specified. Appending the game to the body."),this._startup.boot(b,function(){return f._start()})):(""!==b&&console.log("  Kiwi.Game: Not Targetting a BROWSER. DOM Parent parameter ignored."),this._start())}return Object.defineProperty(b.prototype,"renderOption",{get:function(){return this._renderOption},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"deviceTargetOption",{get:function(){return this._deviceTargetOption},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"debugOption",{get:function(){return this._debugOption},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"debug",{get:function(){return this._debugOption===a.DEBUG_ON},enumerable:!0,configurable:!0}),b.prototype.objType=function(){return"Game"},Object.defineProperty(b.prototype,"frame",{get:function(){return this._frame},set:function(b){this._frame=a.Utils.GameMath.truncate(b)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"idealFrame",{get:function(){return this.time.elapsed()/(1e3/this._frameRate)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"frameRate",{get:function(){return this._frameRate},set:function(a){a>0&&(this._frameRate=a,this._interval=1e3/this._frameRate,this.time.setMasterInterval(this._interval))},enumerable:!0,configurable:!0}),b.prototype._start=function(){var b=this;this.stage.boot(this._startup),this.stage.renderer||console.error("Could not create rendering context"),this._renderOption===a.RENDERER_WEBGL&&this.stage.ctx&&(this._renderOption=a.RENDERER_CANVAS),this.renderer=this.stage.renderer,this.renderer.boot(),this.cameras.boot(),this._deviceTargetOption!==a.TARGET_COCOON&&this.huds.boot(),this.time.boot(),this.input.boot(),this.audio.boot(),this.fileStore.boot(),this.loader.boot(),this.states.boot(),this.pluginManager.boot(),this._lastTime=Date.now(),this.raf=new a.Utils.RequestAnimationFrame(function(){return b._loop()}),this.raf.start(),this.bootCallbackOption&&(console.log("  Kiwi.Game: invoked boot callback"),this.bootCallbackOption(this))},b.prototype._loop=function(){this._delta=this.raf.currentTime-this._lastTime,this._delta>this._interval&&(this.time.update(),this.audio.update(),this.input.update(),this.tweens.update(),this.cameras.update(),this._deviceTargetOption!==a.TARGET_COCOON&&this.huds.update(),this.states.update(),this.pluginManager.update(),this._frame++,null!==this.states.current&&(this.cameras.render(),this.states.postRender()),this._lastTime=this.raf.currentTime-this._delta%this._interval)},b}();a.Game=b}(Kiwi||(Kiwi={}));var Kiwi;!function(a){var b=function(){function b(b,c,d,e,f){this._scaleType=a.Stage.SCALE_NONE,this.offset=new a.Geom.Point,this.container=null,this._game=b,this.name=c,this.domReady=!1,this._alpha=1,this._x=0,this._y=0,this._width=d,this._height=e,this.color="ffffff",this._scale=new a.Geom.Point(1,1),this._scaleType=f,this.onResize=new a.Signal,this.onWindowResize=new a.Signal,this._renderer=null}return b.prototype.objType=function(){return"Stage"},Object.defineProperty(b.prototype,"scaleType",{get:function(){return this._scaleType},set:function(a){this._scaleType=a,this._scaleContainer()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"alpha",{get:function(){return this._alpha},set:function(b){this._game.deviceTargetOption===a.TARGET_BROWSER&&(this.container.style.opacity=String(a.Utils.GameMath.clamp(b,1,0))),this._alpha=b},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"x",{get:function(){return this._x},set:function(b){this._game.deviceTargetOption===a.TARGET_BROWSER?this.container.style.left=String(b+"px"):this._game.deviceTargetOption===a.TARGET_COCOON&&(this.canvas.style.left=String(b+"px")),this._x=b},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this._y},set:function(b){this._game.deviceTargetOption===a.TARGET_BROWSER?this.container.style.top=String(b+"px"):this._game.deviceTargetOption===a.TARGET_COCOON&&(this.canvas.style.top=String(b+"px")),this._y=b},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scaleX",{get:function(){return this._scale.x},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scaleY",{get:function(){return this._scale.y},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"color",{get:function(){return this._color},set:function(a){this._color=a;var b=parseInt(a,16),c=255,d=255,e=255,f=255;6==a.length?(c=b>>16&255,d=b>>8&255,e=255&b,f=255):8==a.length&&(c=b>>24&255,d=b>>16&255,e=b>>8&255,f=255&b),this._normalizedColor={r:c/255,g:d/255,b:e/255,a:f/255}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rgbColor",{get:function(){return{r:255*this._normalizedColor.r,g:255*this._normalizedColor.g,b:255*this._normalizedColor.b}},set:function(a){this.color=this.componentToHex(a.r)+this.componentToHex(a.g)+this.componentToHex(a.b)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rgbaColor",{get:function(){return{r:255*this._normalizedColor.r,g:255*this._normalizedColor.g,b:255*this._normalizedColor.b,a:255*this._normalizedColor.a}},set:function(a){this.color=this.componentToHex(a.r)+this.componentToHex(a.g)+this.componentToHex(a.b)+this.componentToHex(a.a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"normalizedColor",{get:function(){return this._normalizedColor},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0}),b.prototype.boot=function(b){var c=this;this.domReady=!0,this.container=b.container,this._game.deviceTargetOption===a.TARGET_BROWSER&&(this.offset=this.getOffsetPoint(this.container),this._x=this.offset.x,this._y=this.offset.y,window.addEventListener("resize",function(a){return c._windowResized(a)},!0)),this._createCompositeCanvas(),this._game.deviceTargetOption===a.TARGET_COCOON?this._scaleContainer():this._calculateContainerScale()},b.prototype.getOffsetPoint=function(b,c){"undefined"==typeof c&&(c=new a.Geom.Point);var d=b.getBoundingClientRect(),e=b.clientTop||document.body.clientTop||0,f=b.clientLeft||document.body.clientLeft||0,g=window.pageYOffset||b.scrollTop||document.body.scrollTop,h=window.pageXOffset||b.scrollLeft||document.body.scrollLeft;return c.setTo(d.left+h-f,d.top+g-e)},b.prototype._windowResized=function(){this._calculateContainerScale(),this.onWindowResize.dispatch()},b.prototype._calculateContainerScale=function(){this.offset=this.getOffsetPoint(this.container),this._scaleContainer(),this._scale.x=this._width/this.container.clientWidth,this._scale.y=this._height/this.container.clientHeight},b.prototype._createCompositeCanvas=function(){this._game.deviceTargetOption==a.TARGET_COCOON?this.canvas=document.createElement(navigator.isCocoonJS?"screencanvas":"canvas"):(this.canvas=document.createElement("canvas"),this.canvas.style.width="100%",this.canvas.style.height="100%"),this.canvas.id=this._game.id+"compositeCanvas",this.canvas.style.position="absolute",this.canvas.width=this.width,this.canvas.height=this.height,this._game.renderOption===a.RENDERER_CANVAS?(this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#fff",this.gl=null):this._game.renderOption===a.RENDERER_WEBGL&&(this.gl=this.canvas.getContext("webgl"),this.gl||(this.gl=this.canvas.getContext("experimental-webgl"),this.gl?console.warn("Kiwi.Stage: 'webgl' context is not available. Using 'experimental-webgl'"):(console.warn("Kiwi.Stage: WebGL rendering is not available despite the device apparently supporting it. Reverting to CANVAS."),this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#fff",this.gl=null)),this.gl&&(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.ctx=null)),this.ctx?this._renderer=new a.Renderers.CanvasRenderer(this._game):this.gl&&(this._renderer=new a.Renderers.GLRenderManager(this._game)),this._game.deviceTargetOption===a.TARGET_BROWSER?this.container.appendChild(this.canvas):document.body.appendChild(this.canvas)},b.prototype.resize=function(b,c){this.canvas.height=c,this.canvas.width=b,this._height=c,this._width=b,this._game.deviceTargetOption===a.TARGET_BROWSER&&this._calculateContainerScale(),this.onResize.dispatch(this._width,this._height)},b.prototype.setRGBColor=function(a,b,c){return this.rgbColor={r:a,g:b,b:c},this.rgbColor},b.prototype.componentToHex=function(a){var b=a.toString(16);return 1==b.length?"0"+b:b},b.prototype.createDebugCanvas=function(){0!=a.Utils.Common.isUndefined(this.debugCanvas)&&(this._game.deviceTargetOption===a.TARGET_COCOON&&console.log("Debug canvas not supported in cocoon, creating canvas and context anyway"),this.debugCanvas=document.createElement("canvas"),this.debugCanvas.id=this._game.id+"debugCanvas",this.debugCanvas.style.position="absolute",this.debugCanvas.width=this.width,this.debugCanvas.height=this.height,this.debugCanvas.style.width="100%",this.debugCanvas.style.height="100%",this.dctx=this.debugCanvas.getContext("2d"),this.clearDebugCanvas(),this._game.deviceTargetOption===a.TARGET_BROWSER&&this.container.appendChild(this.debugCanvas))},b.prototype.clearDebugCanvas=function(a){this.dctx.fillStyle=a||"rgba(255,0,0,.2)",this.dctx.clearRect(0,0,this.width,this.height),this.dctx.fillRect(0,0,this.width,this.height)},b.prototype.toggleDebugCanvas=function(){this.debugCanvas.style.display="none"===this.debugCanvas.style.display?"block":"none"},b.prototype._scaleContainer=function(){if(this._game.deviceTargetOption==a.TARGET_BROWSER&&(this.container.style.width=String(this._width+"px"),this.container.style.height=String(this._height+"px"),this._scaleType==a.Stage.SCALE_NONE&&(this.container.style.maxWidth="",this.container.style.minWidth=""),(this._scaleType==a.Stage.SCALE_STRETCH||this._scaleType==a.Stage.SCALE_FIT)&&(this.container.style.minWidth="100%",this.container.style.maxWidth="100%"),this._scaleType==a.Stage.SCALE_STRETCH?(this.container.style.minHeight="100%",this.container.style.maxHeight="100%"):(this.container.style.minHeight="",this.container.style.maxHeight=""),this._scaleType==a.Stage.SCALE_FIT&&(this.container.style.height=String(this.container.clientWidth/this._width*this._height)+"px")),this._game.deviceTargetOption==a.TARGET_COCOON)switch(this._scaleType){case a.Stage.SCALE_FIT:this.canvas.style.cssText="idtkscale:ScaleAspectFit";break;case a.Stage.SCALE_STRETCH:this.canvas.style.cssText="idtkscale:ScaleToFill";break;case a.Stage.SCALE_NONE:this.canvas.style.cssText=""}},b.DEFAULT_WIDTH=800,b.DEFAULT_HEIGHT=600,b.SCALE_NONE=0,b.SCALE_FIT=1,b.SCALE_STRETCH=2,b}();a.Stage=b}(Kiwi||(Kiwi={}));var Kiwi;!function(a){var b=function(){function a(a,b){this._components={},this._type=a,this._owner=b}return a.prototype.objType=function(){return"ComponentManager"},a.prototype.hasComponent=function(a){return this._components[a]?!0:!1},a.prototype.hasActiveComponent=function(a){return this._components[a]&&this._components[a].active===!0?!0:!1},a.prototype.getComponent=function(a){return this._components[a]?this._components[a]:null},a.prototype.add=function(a){return this._components[a.name]=a,a},a.prototype.addBatch=function(){for(var a=[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0];for(var c=0;c<a.length;c++)this.add(a[c])},a.prototype.removeComponent=function(a,b){"undefined"==typeof b&&(b=!0);var c=a.name;return this._components[c]?(b&&this._components[c].destroy(),delete this._components[c],!0):!1},a.prototype.removeComponentByName=function(a,b){return"undefined"==typeof b&&(b=!0),this._components[a]?(b&&this._components[a].destroy(),delete this._components[a],!0):!1},a.prototype.removeAll=function(a){"undefined"==typeof a&&(a=!0);for(var b in this._components)this.removeComponent(this._components[b],a)},a.prototype.preUpdate=function(){for(var a in this._components)this._components[a].active&&this._components[a].preUpdate()},a.prototype.update=function(){for(var a in this._components)this._components[a].active&&this._components[a].update()},a.prototype.postUpdate=function(){for(var a in this._components)this._components[a].active&&this._components[a].postUpdate()},a.prototype.preRender=function(){for(var a in this._components)this._components[a].active&&this._components[a].preRender()},a.prototype.render=function(){for(var a in this._components)this._components[a].active&&this._components[a].render()},a.prototype.postRender=function(){for(var a in this._components)this._components[a].active&&this._components[a].postRender()},a}();a.ComponentManager=b}(Kiwi||(Kiwi={}));var Kiwi;!function(a){var b=function(){function b(a,b){this._game=a,this._plugins=b||new Array,this._bootObjects=new Array,this.validatePlugins(),this._createPlugins()}return Object.defineProperty(b,"availablePlugins",{get:function(){for(var a=[],c=0;c<b._availablePlugins.length;c++)a.push({name:b._availablePlugins[c].name,version:b._availablePlugins[c].version});return a},enumerable:!0,configurable:!0}),b.register=function(a){if(console.log("Kiwi.PluginManager: Attempting to register plugin :"+a.name),-1==this._availablePlugins.indexOf(a)){for(var b=!0,c=0;c<this._availablePlugins.length;c++)a.name===this._availablePlugins[c].name&&(b=!1);b?(this._availablePlugins.push(a),console.log("  Kiwi.PluginManager: Registered plugin "+a.name+": version "+a.version)):console.log("  Kiwi.PluginManager: A plugin with the same name has already been registered. Ignoring this plugin.")}else console.log("  Kiwi.PluginManager: This plugin has already been registered. Ignoring second registration.")},Object.defineProperty(b.prototype,"objType",{get:function(){return"PluginManager"},enumerable:!0,configurable:!0}),b.prototype.validatePlugins=function(){var b=new Array;console.log("Kiwi.PluginManager: Validating Plugins");for(var c=0;c<this._plugins.length;c++){var d=this._plugins[c];if("string"==typeof d||d instanceof String)if(a.Plugins.hasOwnProperty(d)&&this.pluginIsRegistered(d))if(b.push(d),console.log("  Kiwi.PluginManager: Plugin '"+d+"' appears to be valid."),console.log("  Kiwi.PluginManager: Name:"+a.Plugins[d].name),console.log("  Kiwi.PluginManager: Version:"+a.Plugins[d].version),"undefined"!=typeof a.Plugins[d].minimumKiwiVersion){console.log("  Kiwi.PluginManager: "+d+" requires minimum Kiwi version "+a.Plugins[d].minimumKiwiVersion);var e=a.Utils.Version.parseVersion(a.VERSION),f=a.Utils.Version.parseVersion(a.Plugins[d].minimumKiwiVersion);e.majorVersion>f.majorVersion?console.warn("  Kiwi.PluginManager: This major version of Kiwi is greater than that required by '"+d+"'. It is unknown whether this plugin will work with this version of Kiwi"):a.Utils.Version.greaterOrEqual(a.VERSION,a.Plugins[d].minimumKiwiVersion)?console.log("  Kiwi.PluginManager: Kiwi version meets minimum version requirements for '"+d+"'."):console.warn("  Kiwi.PluginManager: Kiwi version ("+a.VERSION+") does not meet minimum version requirements for the plugin ("+a.Plugins[d].minimumKiwiVersion+").")}else console.warn("  Kiwi.PluginManager: '"+d+"' is missing the minimumKiwiVersion property. It is unknown whether '"+d+"' will work with this version of Kiwi");else console.log("  Kiwi.PluginManager: Plugin '"+d+"' appears to be invalid. No property with that name exists on the Kiwi.Plugins object or the Plugin is not registered. Check that the js file containing the plugin has been included. This plugin will be ignored");else console.log("  Kiwi.PluginManager: The supplied plugin name at index "+c+"is not a string and will be ignored")}this._plugins=b;for(var c=0;c<this._plugins.length;c++){var g=this._plugins[c],d=a.Plugins[g];if("undefined"!=typeof d.pluginDependencies)if(0===d.pluginDependencies.length)console.log("  Kiwi.PluginManager: '"+g+"' does not depend on any other plugins.");else{console.log("  Kiwi.PluginManager: '"+g+"' depends on the following plugins:");for(var h=0;h<d.pluginDependencies.length;h++)console.log(d.pluginDependencies[h].name,d.pluginDependencies[h].minimumVersion),this.validMinimumPluginVersionExists(d.pluginDependencies[h].name,d.pluginDependencies[h].minimumVersion)||console.warn("  Kiwi.PluginManager: '"+d.pluginDependencies[h].name+" hasn't been added to this game via the config, doesn't exist, or does not meet minimum version requirement ( "+d.pluginDependencies[h].minimumVersion+").")}else console.log("  Kiwi.PluginManager: '"+g+"' does not depend on any other plugins.")}},b.prototype.validMinimumPluginVersionExists=function(b,c){var d=!1,e=!1;return-1!==this._plugins.indexOf(b)&&(d=!0,a.Utils.Version.greaterOrEqual(c,a.Plugins[b].version)&&(e=!0)),d&&e},b.prototype.pluginIsRegistered=function(b){for(var c=!1,d=0;d<a.PluginManager._availablePlugins.length;d++)a.PluginManager._availablePlugins[d].name===b&&(c=!0);return c},b.prototype._createPlugins=function(){for(var b=0;b<this._plugins.length;b++){var c=this._plugins[b];if(a.Plugins[c].hasOwnProperty("create")){var d=a.Plugins[c].create(this._game);d&&this._bootObjects.push(d)}}},b.prototype.boot=function(){for(var a=0;a<this._bootObjects.length;a++)"boot"in this._bootObjects[a]?this._bootObjects[a].boot.call(this._bootObjects[a]):console.warn("Kiwi.PluginManager: Warning! No boot function found on boot object")},b.prototype.update=function(){for(var a=0;a<this._bootObjects.length;a++)"update"in this._bootObjects[a]&&this._bootObjects[a].update.call(this._bootObjects[a])},b._availablePlugins=new Array,b}();a.PluginManager=b}(Kiwi||(Kiwi={}));var Kiwi;!function(a){var b=function(){function b(a){this._game=a,this._cameras=[],this._nextCameraID=0}return b.prototype.objType=function(){return"CameraManager"},b.prototype.boot=function(){this.create("defaultCamera",0,0,this._game.stage.width,this._game.stage.height),this.defaultCamera=this._cameras[0]},b.prototype.create=function(b,c,d,e,f){var g=new a.Camera(this._game,this._nextCameraID++,b,c,d,e,f);return this._cameras.push(g),g},b.prototype.remove=function(a){var b=this._cameras.indexOf(a);return-1!==b?(this._cameras.splice(b,1),!0):!1},b.prototype.update=function(){if(0===this._cameras.length)return!1;for(var a=0;a<this._cameras.length;a++)this._cameras[a].update()},b.prototype.render=function(){if(0===this._cameras.length)return!1;for(var a=0;a<this._cameras.length;a++)this._cameras[a].render()},b.prototype.removeAll=function(){this._cameras=[]},b.prototype.zeroAllCameras=function(){for(var a=0;a<this._cameras.length;a++)this.zeroCamera(this._cameras[a]);this.zeroCamera(this.defaultCamera)},b.prototype.zeroCamera=function(a){a.transform.x=0,a.transform.y=0,a.transform.rotation=0,a.transform.scaleX=1,a.transform.scaleY=1,a.transform.rotPointX=a.width/2,a.transform.rotPointY=a.height/2},b}();a.CameraManager=b}(Kiwi||(Kiwi={}));var Kiwi;!function(a){var b=function(){function a(a,b){this.name="",this.isPersistent=!1,this.isCreated=!1,this.isInitialised=!1,this.isReady=!1,this.hasPreloader=!1,this.runCount=0,this.type=0,this._state=a,this.name=b,"function"==typeof this._state.preload&&(this.hasPreloader=!0)}return a.prototype.objType=function(){return"StateConfig"},a.prototype.reset=function(){this.isReady=!1,this.isCreated=!1,this.createParams=[],this.initParams=[]},a}();a.StateConfig=b}(Kiwi||(Kiwi={}));var Kiwi;!function(a){var b=function(){function b(a){this.current=null,this._newStateKey=null,this._game=a,this._states=[]}return b.prototype.objType=function(){return"StateManager"},b.prototype.checkKeyExists=function(a){for(var b=0;b<this._states.length;b++)if(this._states[b].config.name===a)return!0;return!1},b.prototype.checkValidState=function(a){return a.game&&a.config?!0:!1},b.prototype.addState=function(a,b){"undefined"==typeof b&&(b=!1),console.log("Kiwi.StateManager: Adding state");var c;return c="function"==typeof a?new a:"string"==typeof a?window[a]:a,c.config.name&&this.checkKeyExists(c.config.name)===!0?(this._game.debug&&console.error("  Kiwi.StateManager: Could not add "+c.config.name+" as a State with that name already exists."),!1):(c.game=this._game,this.checkValidState(c)===!1?(this._game.debug&&console.error("  Kiwi.StateManager: "+c.config.name+" isn't a valid state. Make sure you are using the Kiwi.State class!"),!1):(this._states.push(c),this._game.debug&&console.log("  Kiwi.StateManager: "+c.config.name+" was successfully added."),b===!0&&this.setCurrentState(c.config.name),!0))},b.prototype.boot=function(){},b.prototype.setCurrentState=function(a){return null!==this.current&&this.current.config.name===a||this.checkKeyExists(a)===!1?!1:(this._game.debug&&console.log('Kiwi.StateManager: Switching to "'+a+'" State.'),this._newStateKey=a,!0)},b.prototype.bootNewState=function(){null!==this.current&&(this.current.shutDown(),this._game.input.reset(),this.current.destroy(!0),this._game.fileStore.removeStateFiles(this.current),this.current.config.reset(),this._game.cameras.zeroAllCameras()),this.current=this.getState(this._newStateKey),this._newStateKey=null,this.checkInit(),this.checkPreload()},b.prototype.switchState=function(a,b,c,d){if("undefined"==typeof b&&(b=null),"undefined"==typeof c&&(c=null),"undefined"==typeof d&&(d=null),null!==this.current&&this.current.config.isReady===!1)return this._game.debug&&console.error("Kiwi.StateManager: Cannot change to a new state till the current state has finished loading!"),!1;if(this.checkKeyExists(a)===!1&&null!==b&&this.addState(b,!1)===!1)return!1;if(null!==c||null!==d){var e=this.getState(a);e.config.initParams=[],e.config.createParams=[];for(var f in c)e.config.initParams.push(c[f]);for(var g in d)e.config.createParams.push(d[g])}return this.setCurrentState(a)},b.prototype.getState=function(a){for(var b=0;b<this._states.length;b++)if(this._states[b].config.name===a)return this._states[b];return null},b.prototype.checkPreload=function(){var a=this;this.rebuildLibraries(),this._game.loader.init(function(b,c,d){return a.onLoadProgress(b,c,d)},function(){return a.onLoadComplete()}),this.current.preload(),this._game.loader.startLoad()},b.prototype.callCreate=function(){this._game.debug&&console.log("Kiwi.StateManager: Calling "+this.current.name+":Create"),this.current.config.createParams?this.current.create.apply(this.current,this.current.config.createParams):this.current.create.call(this.current),this.current.config.runCount++,this.current.config.isCreated=!0},b.prototype.checkInit=function(){this.current.config.isInitialised===!1&&(this.current.boot(),this.current.config.initParams?this.current.init.apply(this.current,this.current.config.initParams):this.current.init.call(this.current),this.current.config.isInitialised=!0)},b.prototype.onLoadProgress=function(a,b,c){this.current.loadProgress(a,b,c)},b.prototype.onLoadComplete=function(){this.current.loadComplete(),this.rebuildLibraries(),this.current.config.isReady=!0,this.callCreate()},b.prototype.rebuildLibraries=function(){this.current.audioLibrary.rebuild(this._game.fileStore,this.current),this.current.dataLibrary.rebuild(this._game.fileStore,this.current),this.current.textureLibrary.rebuild(this._game.fileStore,this.current),this._game.renderOption==a.RENDERER_WEBGL&&this._game.renderer.initState(this.current)},b.prototype.update=function(){null!==this.current&&(this.current.config.isReady===!0?(this.current.preUpdate(),this.current.update(),this.current.postUpdate()):this.current.loadUpdate()),null!==this._newStateKey&&this.bootNewState()},b.prototype.postRender=function(){null!==this.current&&this.current.config.isReady===!0&&this.current.postRender()},b}();a.StateManager=b}(Kiwi||(Kiwi={}));var Kiwi;!function(a){var b=function(){function b(b,c,d){this._parent=null,this._alpha=1,this.width=0,this.height=0,this.atlas=null,this._cellIndex=0,this.name="",this._tags=[],this._clock=null,this.state=b,this.game=b.game,this.id=this.game.rnd.uuid(),this.state.addToTrackingList(this),this._clock=this.game.time.clock,this._exists=!0,this._active=!0,this._visible=!0,this.components=new a.ComponentManager(a.ENTITY,this),this.transform=new a.Geom.Transform,this.transform.x=c,this.transform.y=d}return Object.defineProperty(b.prototype,"parent",{get:function(){return this._parent},set:function(a){this.transform.parent=null!==a?a.transform:null,this._parent=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"x",{get:function(){return this.transform.x},set:function(a){this.transform.x=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this.transform.y},set:function(a){this.transform.y=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"worldX",{get:function(){return this.transform.worldX},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"worldY",{get:function(){return this.transform.worldY},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scaleX",{get:function(){return this.transform.scaleX},set:function(a){this.transform.scaleX=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scaleY",{get:function(){return this.transform.scaleY},set:function(a){this.transform.scaleY=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scale",{set:function(a){this.transform.scale=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(a){this.transform.rotation=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rotPointX",{get:function(){return this.transform.rotPointX},set:function(a){this.transform.rotPointX=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rotPointY",{get:function(){return this.transform.rotPointY},set:function(a){this.transform.rotPointY=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"anchorPointX",{get:function(){return this.transform.anchorPointX},set:function(a){this.transform.anchorPointX=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"anchorPointY",{get:function(){return this.transform.anchorPointY},set:function(a){this.transform.anchorPointY=a},enumerable:!0,configurable:!0}),b.prototype.childType=function(){return a.ENTITY},Object.defineProperty(b.prototype,"alpha",{get:function(){return this._alpha},set:function(a){0>=a&&(a=0),a>1&&(a=1),this._alpha=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible=a},enumerable:!0,configurable:!0}),b.prototype.scaleToWidth=function(a){this.scale=a/this.width},b.prototype.scaleToHeight=function(a){this.scale=a/this.height},b.prototype.centerAnchorPoint=function(){this.anchorPointX=.5*this.width,this.anchorPointY=.5*this.height},Object.defineProperty(b.prototype,"cellIndex",{get:function(){return this._cellIndex},set:function(a){if(null!==this.atlas){var b=this.atlas.cells[a];void 0!==b?(this._cellIndex=a,this.width=b.w,this.height=b.h):this.game.debug&&console.error("Could not the set the cellIndex of a Entity, to cell that does not exist on its TextureAtlas.")
}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"exists",{get:function(){return this._exists},set:function(a){this._exists=a},enumerable:!0,configurable:!0}),b.prototype.addTag=function(){for(var a=0;a<arguments.length;a++)-1==this._tags.indexOf(arguments[a])&&this._tags.push(arguments[a])},b.prototype.removeTag=function(){for(var a=0;a<arguments.length;a++){var b=this._tags.indexOf(arguments[a]);-1!==b&&this._tags.splice(b,1)}},b.prototype.hasTag=function(a){for(var b=this._tags.length;b--;)if(this._tags[b]===a)return!0;return!1},Object.defineProperty(b.prototype,"active",{get:function(){return this._active},set:function(a){this._active=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"willRender",{get:function(){return this._willRender},set:function(a){this._willRender=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"inputEnabled",{get:function(){return this._inputEnabled},set:function(a){this._inputEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"clock",{get:function(){return this._clock},set:function(a){this._clock=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dirty",{get:function(){return this._dirty},set:function(a){this._dirty=a},enumerable:!0,configurable:!0}),b.prototype.objType=function(){return"Entity"},b.prototype.update=function(){},b.prototype.render=function(){},b.prototype.renderGL=function(a,b,c){"undefined"==typeof c&&(c=null)},b.prototype.destroy=function(a){"undefined"==typeof a&&(a=!1),this._exists=!1,this._active=!1,this._visible=!1,a===!0&&(null!==this.parent&&"undefined"!=typeof this.parent&&this.parent.removeChild(this),this.state&&this.state.removeFromTrackingList(this),delete this._parent,delete this.transform,delete this._clock,delete this.state,delete this.game,delete this.atlas,this.components&&this.components.removeAll(!0),delete this.components)},b}();a.Entity=b}(Kiwi||(Kiwi={}));var Kiwi;!function(a){var b=function(){function a(a,b){this.active=!0,this.dirty=!1,this.owner=a,this.game=this.owner.game,this.name=b,this.active=!0}return a.prototype.objType=function(){return"Component"},a.prototype.preUpdate=function(){},a.prototype.update=function(){},a.prototype.postUpdate=function(){},a.prototype.destroy=function(){this.active=!1,delete this.game,delete this.owner,this.name=""},a}();a.Component=b}(Kiwi||(Kiwi={}));var Kiwi;!function(a){var b=function(){function b(b,c){"undefined"==typeof c&&(c=""),this.name="",this._parent=null,this.game=null,this.state=null,this._dirty=!0,this._tags=[],this._tempRemoveChildren=null,null!==b&&(this.state=b,this.game=this.state.game,this.id=this.game.rnd.uuid(),this.state.addToTrackingList(this)),this.name=c,this.components=new a.ComponentManager(a.GROUP,this),this._exists=!0,this._active=!0,this._visible=!0,this.transform=new a.Geom.Transform,this.members=[]}return b.prototype.objType=function(){return"Group"},b.prototype.childType=function(){return a.GROUP},Object.defineProperty(b.prototype,"parent",{get:function(){return this._parent},set:function(a){this.transform.parent=null!==a?a.transform:null,this._parent=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"x",{get:function(){return this.transform.x},set:function(a){this.transform.x=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this.transform.y},set:function(a){this.transform.y=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"worldX",{get:function(){return this.transform.worldX},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"worldY",{get:function(){return this.transform.worldY},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scaleX",{get:function(){return this.transform.scaleX},set:function(a){this.transform.scaleX=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scaleY",{get:function(){return this.transform.scaleY},set:function(a){this.transform.scaleY=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"scale",{set:function(a){this.transform.scale=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(a){this.transform.rotation=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rotPointX",{get:function(){return this.transform.rotPointX},set:function(a){this.transform.rotPointX=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rotPointY",{get:function(){return this.transform.rotPointY},set:function(a){this.transform.rotPointY=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"anchorPointX",{get:function(){return this.transform.anchorPointX},set:function(a){this.transform.anchorPointX=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"anchorPointY",{get:function(){return this.transform.anchorPointY},set:function(a){this.transform.anchorPointY=a},enumerable:!0,configurable:!0}),b.prototype.numChildren=function(){return this.members.length},Object.defineProperty(b.prototype,"dirty",{get:function(){return this._dirty},set:function(a){if(void 0!==a){this._dirty=a;for(var b=0;b<this.members.length;b++)this.members[b].dirty=a}},enumerable:!0,configurable:!0}),b.prototype.contains=function(a){return-1===this.members.indexOf(a)?!1:!0},b.prototype.containsDescendant=function(b){for(var c=0;c<this.members.length;c++){console.log(c);var d=this.members[c];if(d.id==b.id||d.childType()==a.Group&&d.containsDesendant(b))return!0}return!1},b.prototype.containsAncestor=function(a,b){return null===a.parent||void 0===a.parent?!1:a.parent==b?!0:a.parent.containsAncestor(a.parent,b)},b.prototype.addChild=function(b){return b.childType()!==a.STATE&&b!=this?(null!==b.parent&&b.parent.removeChild(b),this.members.push(b),b.parent=this,b):void 0},b.prototype.addChildAt=function(b,c){return b.childType()!==a.STATE&&b!=this?(null!==b.parent&&b.parent.removeChild(b),this.members.splice(c,0,b),b.parent=this,b):void 0},b.prototype.addChildBefore=function(a,b){if(a.transform.parent!==this.transform&&b.transform.parent===this.transform){var c=this.getChildIndex(b);this.members.splice(c,0,a),a.parent=this}return a},b.prototype.addChildAfter=function(a,b){if(a.transform.parent!==this.transform&&b.transform.parent===this.transform){var c=this.getChildIndex(b)+1;this.members.splice(c,0,a),a.parent=this}return a},b.prototype.removeChild=function(a,b){if("undefined"==typeof b&&(b=!1),a.parent===this){var c=this.getChildIndex(a);c>-1&&(this.members.splice(c,1),a.parent=null,b&&a.destroy())}return a},b.prototype.removeChildAt=function(a){if(this.members[a]){var b=this.members[a];return this.removeChild(b)}return null},b.prototype.removeChildren=function(a,b,c){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=2147483647),"undefined"==typeof c&&(c=!1),b-=a;for(var d=this.members.splice(a,b),e=0;e<d.length;e++)d[e].parent=null,c&&d[e].destroy();return d.length},b.prototype.removeFirstAlive=function(a){return"undefined"==typeof a&&(a=!1),this.removeChild(this.getFirstAlive(),a)},b.prototype.getChildAt=function(a){return this.members[a]?this.members[a]:null},b.prototype.getChildByName=function(a){for(var b=0;b<this.members.length;b++)if(this.members[b].name===a)return this.members[b];return null},b.prototype.getChildByID=function(a){for(var b=0;b<this.members.length;b++)if(this.members[b].id===a)return this.members[b];return null},b.prototype.getChildIndex=function(a){return this.members.indexOf(a)},b.prototype.getFirstAlive=function(){for(var a=0;a<this.members.length;a++)if(this.members[a].exists===!0)return this.members[a];return null},b.prototype.getFirstDead=function(){for(var a=0;a<this.members.length;a++)if(this.members[a].exists===!1)return this.members[a];return null},b.prototype.getRandom=function(a,b){if("undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),0===this.members.length)return null;0===b&&(b=this.members.length),(0>a||a>b)&&(a=0);var c=a+Math.random()*(a+b);return c>this.members.length?this.members[this.members.length-1]:this.members[c]},b.prototype.getChildrenByTag=function(b){for(var c=[],d=0;d<this.members.length;d++)this.members[d].hasTag(b)&&c.push(this.members[d]),this.members[d].childType()==a.GROUP&&(c=c.concat(this.members[d].getChildrenByTag(b)));return c},b.prototype.setChildIndex=function(a,b){return a.parent!==this||this.getChildIndex(a)===b?!1:(this.removeChild(a),this.addChildAt(a,b),!0)},b.prototype.swapChildren=function(a,b){if(a.parent!==this||b.parent!==this)return!1;var c=this.getChildIndex(a),d=this.getChildIndex(b);return-1!==c&&-1!==d&&c!==d?(this.members[c]=b,this.members[d]=a,!0):!1},b.prototype.swapChildrenAt=function(a,b){var c=this.getChildAt(a),d=this.getChildAt(b);return null!==c&&null!==d?c==d||c.parent!==this||d.parent!==this?!1:(this.members[a]=d,this.members[b]=c,!0):!1},b.prototype.replaceChild=function(a,b){if(a===b)return!1;var c=this.getChildIndex(a);return c>-1?(b.parent&&b.parent.removeChild(b),this.removeChildAt(c),this.addChildAt(b,c),b.parent=null,!0):!1},b.prototype.forEach=function(a,b){for(var c=[],d=0;d<arguments.length-2;d++)c[d]=arguments[d+2];this.members.length>0&&this.members.forEach(function(d){return b.apply(a,[d].concat(c))})},b.prototype.forEachAlive=function(a,b){for(var c=[],d=0;d<arguments.length-2;d++)c[d]=arguments[d+2];this.members.length>0&&this.members.forEach(function(d){d.exists&&b.apply(a,[d].concat(c))})},b.prototype.setAll=function(a,b,c){if(null===a)for(var d=0;d<this.members.length;d++)this.members[d][b]=c;else for(var d=0;d<this.members.length;d++)this.members[d][a][b]=c},b.prototype.callAll=function(a,b,c){if(null===a)for(var d=0;d<this.members.length;d++)this.members[d][b].apply(this.members[d],c);else for(var d=0;d<this.members.length;d++)this.members[d][a][b].apply(this.members[d][a],c)},b.prototype.update=function(){if(this.components.preUpdate(),this.components.update(),this.members.length>0)for(var a=0;a<this.members.length;a++)this.members[a].active===!0&&this.members[a].update(),this.members[a].exists===!1&&this.members[a].destroy(!0);this.components.postUpdate()},Object.defineProperty(b.prototype,"exists",{get:function(){return this._exists},set:function(a){this._exists=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"active",{get:function(){return this._active},set:function(a){this._active=a},enumerable:!0,configurable:!0}),b.prototype.render=function(){},b.prototype.countLiving=function(){for(var a=0,b=0;b<this.members.length;b++)this.members[b].exists===!0&&a++;return a},b.prototype.countDead=function(){for(var a=0,b=0;b<this.members.length;b++)this.members[b].exists===!1&&a++;return a},b.prototype.clear=function(){this.members.length=0},Object.defineProperty(b.prototype,"willRender",{get:function(){return this._willRender},set:function(a){this._willRender=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible=a},enumerable:!0,configurable:!0}),b.prototype.addTag=function(){for(var a=0;a<arguments.length;a++)-1==this._tags.indexOf(arguments[a])&&this._tags.push(arguments[a])},b.prototype.removeTag=function(){for(var a=0;a<arguments.length;a++){var b=this._tags.indexOf(arguments[a]);-1!==b&&this._tags.splice(b,1)}},b.prototype.hasTag=function(a){for(var b=this._tags.length;b--;)if(this._tags[b]===a)return!0;return!1},b.prototype.destroy=function(a,b){if("undefined"==typeof a&&(a=!1),"undefined"==typeof b&&(b=!0),this._exists=!1,this._active=!1,this._visible=!1,a===!0){if(null!==this._tempRemoveChildren&&(b=this._tempRemoveChildren),1==b)for(var c=0;c<this.members.length;c++)this.members[c].destroy(!0);else this.removeChildren();null!==this.parent&&this.parent.removeChild(this),this.state&&this.state.removeFromTrackingList(this),delete this.transform,this.components&&this.components.removeAll(),delete this.components,delete this.game,delete this.state}else this._tempRemoveChildren=b},b}();a.Group=b}(Kiwi||(Kiwi={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},Kiwi;!function(a){var b=function(b){function c(c){b.call(this,null,c),this.game=null,this.config=new a.StateConfig(this,c),this.components=new a.ComponentManager(a.STATE,this),this.transform.parent=null,this._trackingList=[]}return __extends(c,b),c.prototype.objType=function(){return"State"},c.prototype.childType=function(){return a.GROUP},c.prototype.boot=function(){this.textureLibrary=new a.Textures.TextureLibrary(this.game),this.textures=this.textureLibrary.textures,this.audioLibrary=new a.Sound.AudioLibrary(this.game),this.audio=this.audioLibrary.audio,this.dataLibrary=new a.Files.DataLibrary(this.game),this.data=this.dataLibrary.data},c.prototype.setType=function(a){this.config.isInitialised===!1&&(this.config.type=a)},c.prototype.init=function(){for(var a=[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0]},c.prototype.preload=function(){},c.prototype.loadProgress=function(){},c.prototype.loadComplete=function(){},c.prototype.loadUpdate=function(){for(var a=0;a<this.members.length;a++)this.members[a].active===!0&&this.members[a].update()},c.prototype.create=function(){for(var a=[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0]},c.prototype.preUpdate=function(){this.components.preUpdate()},c.prototype.update=function(){this.components.update();for(var a=0;a<this.members.length;a++)this.members[a].active===!0&&this.members[a].update(),this.members[a].exists===!1&&this.members[a].destroy(!0)},c.prototype.postUpdate=function(){this.components.postUpdate()},c.prototype.postRender=function(){},c.prototype.shutDown=function(){},c.prototype.addImage=function(a,b,c,d,e,f,g){"undefined"==typeof c&&(c=!0),this.game.loader.addImage(a,b,d,e,f,g,c)},c.prototype.addSpriteSheet=function(a,b,c,d,e,f,g,h,i,j,k,l){"undefined"==typeof e&&(e=!0),this.game.loader.addSpriteSheet(a,b,c,d,f,g,h,i,j,k,l,e)},c.prototype.addTextureAtlas=function(a,b,c,d,e){"undefined"==typeof e&&(e=!0),this.game.loader.addTextureAtlas(a,b,c,d,e)},c.prototype.addJSON=function(a,b,c){"undefined"==typeof c&&(c=!0),this.game.loader.addJSON(a,b,c)},c.prototype.addAudio=function(a,b,c){"undefined"==typeof c&&(c=!0),this.game.loader.addAudio(a,b,c)},c.prototype.addToTrackingList=function(a){-1===this._trackingList.indexOf(a)&&this._trackingList.push(a)},c.prototype.removeFromTrackingList=function(a){var b=this._trackingList.indexOf(a);b>-1&&this._trackingList.splice(b,1)},c.prototype.destroyUnused=function(){for(var a=0,b=0;b<this._trackingList.length;b++)this.containsAncestor(this._trackingList[b],this)===!1&&(this._trackingList[b].destroy(),this._trackingList.splice(b,1),b--,a++);return a},c.prototype.destroy=function(a){if("undefined"==typeof a&&(a=!0),1==a){for(var b=0;b<this._trackingList.length;b++)this._trackingList[b].destroy(!0,!1);this._trackingList=[],this.members=[]}},c.prototype._destroyChildren=function(b){if(b.childType()==a.GROUP)for(var c=0;c<b.members.length;c++)this._destroyChildren(b.members[c]);b.destroy(!0)},c}(a.Group);a.State=b}(Kiwi||(Kiwi={}));var Kiwi;!function(a){var b=function(){function b(b,c,d,e,f,g,h){this.fitToStage=!0,this._game=b,this.id=c,this.name=d,this.width=g,this.height=h,this.transform=new a.Geom.Transform(e,f),this.transform.rotPointX=e+g/2,this.transform.rotPointY=f+h/2,this._game.stage.onResize.add(this._updatedStageSize,this)}return b.prototype.objType=function(){return"Camera"},b.prototype._updatedStageSize=function(a,b){this.width=a,this.height=b},Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dirty",{get:function(){return this._dirty},set:function(a){this._dirty=a},enumerable:!0,configurable:!0}),b.prototype.transformPoint=function(a){var b=a.clone(),c=this.transform.getConcatenatedMatrix();return c.append(1,0,0,1,-this.transform.rotPointX,-this.transform.rotPointY),c.invert(),c.transformPoint(b)},b.prototype.update=function(){},b.prototype.render=function(){this._game.renderer.render(this)},b}();a.Camera=b}(Kiwi||(Kiwi={}));var Kiwi;!function(a){var b=function(){function b(){this._bindings=[],this._prevParams=null,this.memorize=!1,this._shouldPropagate=!0,this.active=!0}return b.prototype.objType=function(){return"Signal"},b.prototype.validateListener=function(a,b){if("function"!=typeof a)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},b.prototype._registerListener=function(b,c,d,e){var f,g=this._indexOfListener(b,d);if(-1!==g){if(f=this._bindings[g],f.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else f=new a.SignalBinding(this,b,c,d,e),this._addBinding(f);return this.memorize&&this._prevParams&&f.execute(this._prevParams),f},b.prototype._addBinding=function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&a.priority<=this._bindings[b].priority);this._bindings.splice(b+1,0,a)},b.prototype._indexOfListener=function(a,b){for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c.getListener()===a&&c.context===b)return d;return-1},b.prototype.has=function(a,b){return"undefined"==typeof b&&(b=null),-1!==this._indexOfListener(a,b)},b.prototype.add=function(a,b,c){return"undefined"==typeof b&&(b=null),"undefined"==typeof c&&(c=0),this.validateListener(a,"add"),this._registerListener(a,!1,b,c)},b.prototype.addOnce=function(a,b,c){return"undefined"==typeof b&&(b=null),"undefined"==typeof c&&(c=0),this.validateListener(a,"addOnce"),this._registerListener(a,!0,b,c)},b.prototype.remove=function(a,b){"undefined"==typeof b&&(b=null),this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},b.prototype.removeAll=function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},b.prototype.getNumListeners=function(){return this._bindings.length},b.prototype.halt=function(){this._shouldPropagate=!1},b.prototype.dispatch=function(){for(var a=[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0];if(this.active){var c,d=this._bindings.length;if(this.memorize&&(this._prevParams=a),d){c=this._bindings.slice(0),this._shouldPropagate=!0;do d--;while(c[d]&&this._shouldPropagate&&c[d].execute(a)!==!1)}}},b.prototype.forget=function(){this._prevParams=null},b.prototype.dispose=function(){this.removeAll(),delete this._bindings,delete this._prevParams},b.VERSION="1.0.0",b}();a.Signal=b}(Kiwi||(Kiwi={}));var Kiwi;!function(a){var b=function(){function a(a,b,c,d,e){"undefined"==typeof e&&(e=0),this.active=!0,this.params=null,this._listener=b,this._isOnce=c,this.context=d,this._signal=a,this.priority=e||0}return a.prototype.objType=function(){return"SignalBinding"},a.prototype.execute=function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,c),this._isOnce&&this.detach()),b},a.prototype.detach=function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},a.prototype.isBound=function(){return!!this._signal&&!!this._listener},a.prototype.isOnce=function(){return this._isOnce},a.prototype.getListener=function(){return this._listener},a.prototype.getSignal=function(){return this._signal},a.prototype._destroy=function(){delete this._signal,delete this._listener,delete this.context},a}();a.SignalBinding=b}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(b){function c(c,d,e,f,g){return"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=0),"undefined"==typeof g&&(g=!1),b.call(this,c,e,f),"undefined"==typeof d?(console.error("A Texture Atlas was not passed when instantiating a new Sprite."),this.visible=!1,void(this.active=!1)):(this.game.renderOption===a.RENDERER_WEBGL&&(this.glRenderer=this.game.renderer.requestSharedRenderer("TextureAtlasRenderer")),this.atlas=d,this.name=this.atlas.name,this.cellIndex=this.atlas.cellIndex,this.width=d.cells[this.cellIndex].w,this.height=d.cells[this.cellIndex].h,this.transform.rotPointX=this.width/2,this.transform.rotPointY=this.height/2,this.box=this.components.add(new a.Components.Box(this,e,f,this.width,this.height)),this.input=this.components.add(new a.Components.Input(this,this.box,g)),void(this.atlas.type===a.Textures.TextureAtlas.SINGLE_IMAGE?(this.animation=null,this._isAnimated=!1):(this.animation=this.components.add(new a.Components.AnimationManager(this)),this._isAnimated=!0)))}return __extends(c,b),c.prototype.objType=function(){return"Sprite"},c.prototype.update=function(){b.prototype.update.call(this),this._isAnimated&&(this.animation.update(),this.width=this.atlas.cells[this.cellIndex].w,this.height=this.atlas.cells[this.cellIndex].h),this.input.update()},c.prototype.render=function(a){if(b.prototype.render.call(this,a),this.alpha>0){var c=this.game.stage.ctx;c.save(),this.alpha>0&&this.alpha<=1&&(c.globalAlpha=this.alpha);var d=this.transform,e=d.getConcatenatedMatrix();c.transform(e.a,e.b,e.c,e.d,e.tx,e.ty);var f=this.atlas.cells[this.cellIndex];c.drawImage(this.atlas.image,f.x,f.y,f.w,f.h,-d.rotPointX,-d.rotPointY,f.w,f.h),c.restore()}},c.prototype.renderGL=function(a,b,c){"undefined"==typeof c&&(c=null),this.glRenderer.addToBatch(a,this,b)},c}(a.Entity);b.Sprite=c}(a.GameObjects||(a.GameObjects={}));a.GameObjects}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(b){function c(c,d,e,f){return"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=0),b.call(this,c,e,f),this.game.renderOption===a.RENDERER_WEBGL&&(this.glRenderer=this.game.renderer.requestSharedRenderer("TextureAtlasRenderer")),"undefined"==typeof d?(console.error("A Texture Atlas was not passed when instantiating a new Static Image."),this.visible=!1,void(this.active=!1)):(this.atlas=d,this.cellIndex=this.atlas.cellIndex,this.width=d.cells[this.cellIndex].w,this.height=d.cells[this.cellIndex].h,this.transform.rotPointX=this.width/2,this.transform.rotPointY=this.height/2,void(this.box=this.components.add(new a.Components.Box(this,e,f,this.width,this.height))))}return __extends(c,b),c.prototype.objType=function(){return"Sprite"},c.prototype.render=function(a){if(b.prototype.render.call(this,a),this.alpha>0){var c=this.game.stage.ctx;c.save(),this.alpha>0&&this.alpha<=1&&(c.globalAlpha=this.alpha);var d=this.transform,e=d.getConcatenatedMatrix();c.transform(e.a,e.b,e.c,e.d,e.tx,e.ty);var f=this.atlas.cells[this.cellIndex];c.drawImage(this.atlas.image,f.x,f.y,f.w,f.h,-d.rotPointX,-d.rotPointY,f.w,f.h),c.restore()}},c.prototype.renderGL=function(a,b,c){"undefined"==typeof c&&(c=null),this.glRenderer.addToBatch(a,this,b)},c}(a.Entity);b.StaticImage=c}(a.GameObjects||(a.GameObjects={}));a.GameObjects}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(b){function c(c,d,e,f,g,h,i,j){"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=0),"undefined"==typeof g&&(g="#000000"),"undefined"==typeof h&&(h=32),"undefined"==typeof i&&(i="normal"),"undefined"==typeof j&&(j="sans-serif"),b.call(this,c,e,f),this._tempDirty=!0,this.game.renderOption===a.RENDERER_WEBGL&&(this.glRenderer=this.game.renderer.requestSharedRenderer("TextureAtlasRenderer")),this._text=d,this._fontWeight=i,this._fontSize=h,this._fontColor=g,this._fontFamily=j,this._textAlign="left",this._baseline="top",this._tempDirty=!0,this._canvas=document.createElement("canvas"),this._canvas.width=2,this._canvas.height=2,this._ctx=this._canvas.getContext("2d"),this.atlas=new a.Textures.SingleImage(this.game.rnd.uuid(),this._canvas),this.state.textureLibrary.add(this.atlas),this.atlas.dirty=!0,this._alignWidth=0}return __extends(c,b),c.prototype.objType=function(){return"Textfield"},Object.defineProperty(c.prototype,"text",{get:function(){return this._text},set:function(a){this._text=a,this._tempDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"color",{get:function(){return this._fontColor},set:function(a){this._fontColor=a,this._tempDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(a){this._fontWeight=a,this._tempDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"fontSize",{get:function(){return this._fontSize},set:function(a){this._fontSize=a,this._tempDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(a){this._fontFamily=a,this._tempDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"textAlign",{get:function(){return this._textAlign},set:function(a){this._textAlign=a,this._tempDirty=!0},enumerable:!0,configurable:!0}),c.prototype._renderText=function(){this._ctx.font=this._fontWeight+" "+this._fontSize+"px "+this._fontFamily;var b=this._ctx.measureText(this._text),c=b.width,d=1.3*this._fontSize;if(this._alignWidth=c,-1==a.Utils.Common.base2Sizes.indexOf(c)){for(var e=0;c>a.Utils.Common.base2Sizes[e];)e++;c=a.Utils.Common.base2Sizes[e]}if(-1==a.Utils.Common.base2Sizes.indexOf(d)){for(var e=0;d>a.Utils.Common.base2Sizes[e];)e++;d=a.Utils.Common.base2Sizes[e]}this._canvas.width=c,this._canvas.height=d,this._ctx.clearRect(0,0,c,d),this._ctx.font=this._fontWeight+" "+this._fontSize+"px "+this._fontFamily,this._ctx.fillStyle=this._fontColor,this._ctx.textBaseline=this._baseline,this._ctx.fillText(this._text,0,0),this.width=this._alignWidth,this.height=this._canvas.height,this.atlas.cells[0]={x:0,y:0,w:this._canvas.width,h:this._canvas.height},this._tempDirty=!1,this.atlas.dirty=!0},c.prototype.render=function(){if(this.alpha>0&&this.visible){var b=this.game.stage.ctx;b.save();var c=this.transform;this.alpha>0&&this.alpha<=1&&(b.globalAlpha=this.alpha),this._tempDirty&&this._renderText();var d=0;switch(this._textAlign){case a.GameObjects.Textfield.TEXT_ALIGN_LEFT:d=0;break;case a.GameObjects.Textfield.TEXT_ALIGN_CENTER:d=.5*this._alignWidth;break;case a.GameObjects.Textfield.TEXT_ALIGN_RIGHT:d=this._alignWidth}var e=c.getConcatenatedMatrix();b.transform(e.a,e.b,e.c,e.d,e.tx-d,e.ty),b.drawImage(this._canvas,0,0,this._canvas.width,this._canvas.height,-c.rotPointX,-c.rotPointY,this._canvas.width,this._canvas.height),b.restore()}},c.prototype.renderGL=function(b,c,d){"undefined"==typeof d&&(d=null),this._tempDirty&&this._renderText();var e=[],f=this.transform,g=f.getConcatenatedMatrix(),h=0;switch(this._textAlign){case a.GameObjects.Textfield.TEXT_ALIGN_LEFT:h=0;break;case a.GameObjects.Textfield.TEXT_ALIGN_CENTER:h=-(.5*this._alignWidth);break;case a.GameObjects.Textfield.TEXT_ALIGN_RIGHT:h=-this._alignWidth}var i=new a.Geom.Point(h-f.rotPointX,0-f.rotPointY),j=new a.Geom.Point(this._canvas.width+h-f.rotPointX,0-f.rotPointY),k=new a.Geom.Point(this._canvas.width+h-f.rotPointX,this._canvas.height-f.rotPointY),l=new a.Geom.Point(h-f.rotPointX,this._canvas.height-f.rotPointY);i=g.transformPoint(i),j=g.transformPoint(j),k=g.transformPoint(k),l=g.transformPoint(l),e.push(i.x,i.y,0,0,this.alpha,j.x,j.y,this._canvas.width,0,this.alpha,k.x,k.y,this._canvas.width,this._canvas.height,this.alpha,l.x,l.y,0,this._canvas.height,this.alpha),this.glRenderer.concatBatch(e)},c.TEXT_ALIGN_CENTER="center",c.TEXT_ALIGN_RIGHT="right",c.TEXT_ALIGN_LEFT="left",c}(a.Entity);b.Textfield=c}(a.GameObjects||(a.GameObjects={}));a.GameObjects}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(){function b(b,c,d){"undefined"==typeof d&&(d=-1),this.allowCollisions=a.Components.ArcadePhysics.NONE,this.properties={},this.tilemap=b,this.index=c,this.cellIndex=d,this.offset=new a.Geom.Point(0,0)}return b.prototype.objType=function(){return"TileType"},b}();b.TileType=c}(b.Tilemap||(b.Tilemap={}));b.Tilemap}(a.GameObjects||(a.GameObjects={}));a.GameObjects}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(){function c(a,b,c,d){"undefined"==typeof d&&(d=0),this.tileWidth=0,this.tileHeight=0,this.width=0,this.height=0,this.properties={},this.tileTypes=[],this.createTileType(-1),this.layers=[],this.state=a,this.game=a.game,void 0!==b&&void 0!==c?this.createFromFileStore(b,c,d):(void 0!==b||void 0!==c)&&console.log("You must pass BOTH the TileMapDataKey and TextureAtlas inorder to create a TileMap from the File Store.")}return Object.defineProperty(c.prototype,"widthInPixels",{get:function(){return this.width*this.tileWidth},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"heightInPixels",{get:function(){return this.height*this.tileHeight},enumerable:!0,configurable:!0}),c.prototype.createFromFileStore=function(a,c,d){"undefined"==typeof d&&(d=0);var e=null;switch(typeof a){case"string":if(0==this.game.fileStore.exists(a))return console.error("The JSON file you have told to use for a TileMap does not exist."),!1;e=JSON.parse(this.game.fileStore.getFile(a).data);break;case"object":e=a;break;default:console.error("The type of TileMapData passed could not be idenified. Please either pass a name of JSON file to use OR an object to be used.")}this.orientation=void 0==e.orientation?b.ORTHOGONAL:e.orientation,this.tileWidth=void 0==e.tilewidth?32:e.tilewidth,this.tileHeight=void 0==e.tileheight?32:e.tileheight,this.width=e.width,this.height=e.height;for(var f in e.properties)this.properties[f]=e.properties[f];"undefined"!==e.tilesets&&-1!==d&&this._generateTypesFromTileset(e.tilesets,c,d);for(var g=0;g<e.layers.length;g++){var h=e.layers[g];switch(e.layers[g].type){case"tilelayer":var i=void 0!==h.width?h.width:this.width,j=void 0!==h.height?h.height:this.height,k=this.createNewLayer(h.name,c,h.data,i,j,h.x*this.tileWidth,h.y*this.tileHeight);k.orientation=this.orientation,k.visible=void 0==h.visible?!0:h.visible,k.alpha=void 0==h.opacity?1:h.opacity,void 0!==h.properties&&(k.properties=h.properties);break;case"objectgroup":this.createNewObjectLayer();break;case"imagelayer":this.createNewImageLayer()}}},c.prototype._generateTypesFromTileset=function(a,b,c){for(var d=0;d<a.length;d++){for(var e=a[d],f=e.margin,g=(e.spacing,e.tilewidth),h=e.tileheight,i=e.imagewidth-f,j=e.imageheight-f,k=void 0==e.tileoffset?{x:0,y:0}:e.tileoffset,l=f;j>l;l+=h)for(var m=f;i>m;m+=g){var n=void 0==b.cells[c]?-1:c,o=this.createTileType(n);o.offset.x=k.x,o.offset.y=k.y,c++}for(var p in e.tileproperties){var o=this.tileTypes[parseInt(e.firstgid)+parseInt(p)];o.properties=e.tileproperties[p]}}},c.prototype.setTo=function(a,b,c,d){this.tileWidth=a,this.tileHeight=b,this.width=c,this.height=d},c.prototype.createTileType=function(a){"undefined"==typeof a&&(a=-1);var c=new b.TileType(this,this.tileTypes.length,a);return this.tileTypes.push(c),c},c.prototype.createTileTypes=function(a){for(var b=[],c=0;c<a.length;c++)b.push(this.createTileType(a[c]));return b},c.prototype.createTileTypesByRange=function(a,b){for(var c=[],d=a;a+b>=d;d++)c.push(this.createTileType(d));return c},c.prototype.setCell=function(a,b){this.tileTypes[a].cellIndex=b},c.prototype.setCellsByRange=function(a,b,c){for(var d=a;a+c>d;d++)this.tileTypes[d].cellIndex=b,b++},c.prototype.createNewLayer=function(b,c,d,e,f,g,h,i,j){if("undefined"==typeof d&&(d=[]),"undefined"==typeof e&&(e=this.width),"undefined"==typeof f&&(f=this.height),"undefined"==typeof g&&(g=0),"undefined"==typeof h&&(h=0),"undefined"==typeof i&&(i=this.tileWidth),"undefined"==typeof j&&(j=this.tileHeight),d.length<e*f)for(var k=d.length-1;++k<e*f;)d.push(0);var l=new a.GameObjects.Tilemap.TileMapLayer(this,b,c,d,i,j,g,h,e,f);return this.layers.push(l),l},c.prototype.createNewObjectLayer=function(){console.log("OBJECT GROUP layers are currently not supported.")},c.prototype.createNewImageLayer=function(){console.log("IMAGE layers are currently not supported.")},c.prototype.getLayerByName=function(a){for(var b=0;b<this.layers.length;b++)if(this.layers[b].name==a)return this.layers[b];
return null},c.prototype.getLayer=function(a){return void 0!==this.layers[a]?this.layers[a]:null},c.prototype.objType=function(){return"TileMap"},c}();b.TileMap=c,b.ISOMETRIC="isometric",b.ORTHOGONAL="orthogonal"}(b.Tilemap||(b.Tilemap={}));b.Tilemap}(a.GameObjects||(a.GameObjects={}));a.GameObjects}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(c){function d(d,e,f,g,h,i,j,k,l,m){"undefined"==typeof j&&(j=0),"undefined"==typeof k&&(k=0),"undefined"==typeof l&&(l=0),"undefined"==typeof m&&(m=0),c.call(this,d.state,j,k),this.properties={},this.orientation=b.ORTHOGONAL,this.game.renderOption===a.RENDERER_WEBGL&&(this.glRenderer=this.game.renderer.requestSharedRenderer("TextureAtlasRenderer")),this.name=e,this.atlas=f,this.tilemap=d,this._data=g,this.tileWidth=h,this.tileHeight=i,this.width=l,this.height=m,this._corner1=new a.Geom.Point(0,0),this._corner2=new a.Geom.Point(0,0),this._corner3=new a.Geom.Point(0,0),this._corner4=new a.Geom.Point(0,0),this.physics=this.components.add(new a.Components.ArcadePhysics(this,null)),this.physics.immovable=!0}return __extends(d,c),d.prototype.childType=function(){return a.TILE_LAYER},d.prototype.objType=function(){return"TileMapLayer"},Object.defineProperty(d.prototype,"widthInPixels",{get:function(){return this.width*this.tilemap.tileWidth},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"heightInPixels",{get:function(){return this.height*this.tilemap.tileHeight},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"cellIndex",{get:function(){return null},set:function(){},enumerable:!0,configurable:!0}),d.prototype.scaleToWidth=function(a){this.scale=a/this.widthInPixels},d.prototype.scaleToHeight=function(a){this.scale=a/this.heightInPixels},d.prototype.centerAnchorPoint=function(){this.anchorPointX=.5*this.widthInPixels,this.anchorPointY=.5*this.heightInPixels},d.prototype.countTiles=function(a){for(var b=0,c=0;c<this._data.length;c++)void 0==a&&0!==this._data[c]?b++:a===this._data[c]&&b++;return b},Object.defineProperty(d.prototype,"tileData",{get:function(){return this._data},enumerable:!0,configurable:!0}),d.prototype.getIndexFromXY=function(a,b){var c=a+b*this.width;return 0>c||c>=this._data.length?-1:c},d.prototype.getTileFromXY=function(a,b){var c=this.getIndexFromXY(a,b);return-1!==c?this.tilemap.tileTypes[this._data[c]]:null},d.prototype.getIndexFromCoords=function(b,c){if(b>this.transform.worldX+this.widthInPixels||c>this.transform.worldY+this.heightInPixels||b<this.transform.worldX||c<this.transform.worldY)return-1;var d=a.Utils.GameMath.snapToFloor(b-this.transform.worldX,this.tileWidth)/this.tileWidth,e=a.Utils.GameMath.snapToFloor(c-this.transform.worldY,this.tileHeight)/this.tileHeight;return this.getIndexFromXY(d,e)},d.prototype.getTileFromCoords=function(a,b){var c=this.getIndexFromCoords(a,b);return-1!==c?this.tilemap.tileTypes[this._data[c]]:null},d.prototype.getIndexesByType=function(a){for(var b=[],c=0;c<this._data.length;c++)this._data[c]==a&&b.push(c);return b},d.prototype.setTile=function(a,b,c){var a=this.getIndexFromXY(a,b);return-1!==a?(this._data[a]=c,!0):!1},d.prototype.setTileByIndex=function(a,b){this._data[a]=b},d.prototype.randomizeTiles=function(a,b,c,d,e){if("undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=this.width),"undefined"==typeof e&&(e=this.height),void 0==a){a=[];for(var f=0;f++<this.tilemap.tileTypes.length;)a.push(f)}for(var g=c;c+e>g;g++)for(var f=b;b+d>f;f++){var h=this.getIndexFromXY(f,g);-1!==h&&(this._data[h]=this.game.rnd.pick(a))}},d.prototype.fill=function(a,b,c,d,e){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=this.width),"undefined"==typeof e&&(e=this.height);for(var f=c;c+e>f;f++)for(var g=b;b+d>g;g++){var h=this.getIndexFromXY(g,f);-1!==h&&(this._data[h]=a)}},d.prototype.replaceTiles=function(a,b,c,d,e,f){"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=this.width),"undefined"==typeof f&&(f=this.height);for(var g=d;d+f>g;g++)for(var h=c;c+e>h;h++){var i=this.getIndexFromXY(h,g);-1!==i&&this._data[i]==a&&(this._data[i]=b)}},d.prototype.swapTiles=function(a,b,c,d,e,f){"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=this.width),"undefined"==typeof f&&(f=this.height);for(var g=d;d+f>g;g++)for(var h=c;c+e>h;h++){var i=this.getIndexFromXY(h,g);-1!==i&&(this._data[i]==a?this._data[i]=b:this._data[i]==b&&(this._data[i]=a))}},d.prototype.getOverlappingTiles=function(b,c){if("undefined"==typeof c&&(c=a.Components.ArcadePhysics.ANY),0==b.components.hasComponent("Box"))return[];var d=b.components.getComponent("Box").worldHitbox;if(d.left>this.transform.worldX+this.widthInPixels||d.right<this.transform.worldX||d.bottom<this.transform.worldY||d.top>this.transform.worldY+this.heightInPixels)return[];for(var e=d.x-this.transform.worldX,f=d.y-this.transform.worldY,g=a.Utils.GameMath.snapToFloor(e,this.tileWidth)/this.tileWidth,h=a.Utils.GameMath.snapToFloor(f,this.tileHeight)/this.tileHeight,i=a.Utils.GameMath.snapToCeil(d.width,this.tileWidth)/this.tileWidth,j=a.Utils.GameMath.snapToCeil(d.height,this.tileHeight)/this.tileHeight,k=this.getCollidableTiles(g,h,i+1,j+1,c),l=0;l<k.length;l++){var m=k[l];(m.x>d.right||m.x+this.tileWidth<d.left||m.y>d.bottom||m.y+this.tileHeight<m.top)&&(k.splice(l,1),l--)}return k},d.prototype.getCollidableTiles=function(b,c,d,e,f){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=this.width),"undefined"==typeof e&&(e=this.height),"undefined"==typeof f&&(f=a.Components.ArcadePhysics.ANY);var g=[];if(!(b>this.width||c>this.height)){0>b&&(b=0),0>c&&(c=0),b+d>this.width&&(d=this.width-b),c+e>this.height&&(e=this.height-c);for(var h=c;c+e>h;h++)for(var i=b;b+d>i;i++){var j=this.getIndexFromXY(i,h);if(-1!==j){var k=this.tileData[j];(this.tilemap.tileTypes[k].allowCollisions&f)!==a.Components.ArcadePhysics.NONE&&g.push({index:j,type:k,x:i*this.tileWidth,y:h*this.tileHeight})}}return g}},d.prototype.update=function(){c.prototype.update.call(this),this.physics.update()},d.prototype._calculateBoundaries=function(c,d){if(this.orientation==b.ORTHOGONAL){this._corner1.setTo(0,0),this._corner2.setTo(this.game.stage.width,0),this._corner3.setTo(this.game.stage.width,this.game.stage.height),this._corner4.setTo(0,this.game.stage.height),this._corner1=c.transformPoint(this._corner1),this._corner2=c.transformPoint(this._corner2),this._corner3=c.transformPoint(this._corner3),this._corner4=c.transformPoint(this._corner4);var e=d.clone();return e.invert(),this._corner1=e.transformPoint(this._corner1),this._corner2=e.transformPoint(this._corner2),this._corner3=e.transformPoint(this._corner3),this._corner4=e.transformPoint(this._corner4),this._startX=Math.min(this._corner1.x,this._corner2.x,this._corner3.x,this._corner4.x),this._startY=Math.min(this._corner1.y,this._corner2.y,this._corner3.y,this._corner4.y),this._maxX=Math.max(this._corner1.x,this._corner2.x,this._corner3.x,this._corner4.x),this._maxY=Math.max(this._corner1.y,this._corner2.y,this._corner3.y,this._corner4.y),this._startX/=this.tileWidth,this._startY/=this.tileHeight,this._maxX/=this.tileWidth,this._maxY/=this.tileHeight,this._startX=Math.floor(this._startX),this._startY=Math.floor(this._startY),this._maxX=Math.ceil(this._maxX),this._maxY=Math.ceil(this._maxY),this._startX=a.Utils.GameMath.clamp(this._startX,this.width),this._startY=a.Utils.GameMath.clamp(this._startY,this.height),this._maxX=a.Utils.GameMath.clamp(this._maxX,this.width),void(this._maxY=a.Utils.GameMath.clamp(this._maxY,this.height))}this.orientation==b.ISOMETRIC&&(this._startX=0,this._startY=0,this._maxX=this.width,this._maxY=this.height)},d.prototype.chartToScreen=function(a,b,c){return{x:a.x*b-a.y*b,y:a.x*c/2+a.y*c/2}},d.prototype.screenToChart=function(a,b,c){var d=Math.floor(a.x/b),e=Math.floor((a.y-d*(c/2))/c);return{x:d+e,y:e}},d.prototype.render=function(a){if(!(this.visible===!1||this.alpha<.1||this.exists===!1)){var c=this.game.stage.ctx;c.save(),this.alpha>0&&this.alpha<=1&&(c.globalAlpha=this.alpha);var d=this.transform,e=d.getConcatenatedMatrix();c.transform(e.a,e.b,e.c,e.d,e.tx,e.ty),this._calculateBoundaries(a,e);for(var f=this._startY;f<this._maxY;f++)for(var g=this._startX;g<this._maxX;g++)if((this._temptype=this.getTileFromXY(g,f))&&-1!==this._temptype.cellIndex){var h,i,j=this.atlas.cells[this._temptype.cellIndex];if(this.orientation==b.ISOMETRIC){var k=(this._temptype.offset.x,this._temptype.offset.y,this.tileWidth*(2*this.width-1),this.tileHeight*this.height,this.tileWidth/2),l=this.chartToScreen({x:g,y:f},this.tileWidth/2,this.tileHeight);h=l.x+this._temptype.offset.x-k,i=l.y-(j.h-this.tileHeight)+this._temptype.offset.y}else h=g*this.tileWidth+this._temptype.offset.x,i=f*this.tileHeight-(j.h-this.tileHeight)+this._temptype.offset.y;c.drawImage(this.atlas.image,j.x,j.y,j.w,j.h,h,i,j.w,j.h)}return c.restore(),!0}},d.prototype.renderGL=function(c,d,e){"undefined"==typeof e&&(e=null);var f=[],g=new a.Geom.Point,h=new a.Geom.Point,i=new a.Geom.Point,j=new a.Geom.Point,k=this.transform,l=k.getConcatenatedMatrix();this._calculateBoundaries(d,l);for(var m=this._startY;m<this._maxY;m++)for(var n=this._startX;n<this._maxX;n++)if(this._temptype=this.getTileFromXY(n,m),-1!=this._temptype.cellIndex){var o,p,q=this.atlas.cells[this._temptype.cellIndex];if(this.orientation==b.ISOMETRIC){var r=(this._temptype.offset.x,this._temptype.offset.y,this.tileWidth*(2*this.width-1),this.tileHeight*this.height,this.tileWidth/2),s=this.chartToScreen({x:n,y:m},this.tileWidth/2,this.tileHeight);o=s.x+this._temptype.offset.x-r,p=s.y+this._temptype.offset.y}else o=n*this.tileWidth+this._temptype.offset.x,p=m*this.tileHeight+this._temptype.offset.y;g.setTo(o-k.rotPointX,p-k.rotPointY-(q.h-this.tileHeight)),h.setTo(o+q.w-k.rotPointX,p-k.rotPointY-(q.h-this.tileHeight)),i.setTo(o+q.w-k.rotPointX,p+q.h-k.rotPointY-(q.h-this.tileHeight)),j.setTo(o-k.rotPointX,p+q.h-k.rotPointY-(q.h-this.tileHeight)),g=l.transformPoint(g),h=l.transformPoint(h),i=l.transformPoint(i),j=l.transformPoint(j),f.push(g.x+k.rotPointX,g.y+k.rotPointY,q.x,q.y,this.alpha,h.x+k.rotPointX,h.y+k.rotPointY,q.x+q.w,q.y,this.alpha,i.x+k.rotPointX,i.y+k.rotPointY,q.x+q.w,q.y+q.h,this.alpha,j.x+k.rotPointX,j.y+k.rotPointY,q.x,q.y+q.h,this.alpha)}this.glRenderer.concatBatch(f)},d}(a.Entity);b.TileMapLayer=c}(b.Tilemap||(b.Tilemap={}));b.Tilemap}(a.GameObjects||(a.GameObjects={}));a.GameObjects}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(b){function c(c,d){if("undefined"==typeof d&&(d=!0),b.call(this,c,"Animation"),this.currentAnimation=null,this.entity=c,this._atlas=this.entity.atlas,this._animations={},1==d)for(var e=0;e<this._atlas.sequences.length;e++)this.createFromSequence(this._atlas.sequences[e],!1);if(this._animations["default"])this.currentAnimation=this._animations["default"];else{for(var f=[],e=0;e<this._atlas.cells.length;e++)f.push(e);this.currentAnimation=this.add("default",f,.1,!0,!1)}this.onChange=new a.Signal,this.onPlay=new a.Signal,this.onStop=new a.Signal,this.onUpdate=new a.Signal}return __extends(c,b),Object.defineProperty(c.prototype,"isPlaying",{get:function(){return this.currentAnimation.isPlaying},enumerable:!0,configurable:!0}),c.prototype.objType=function(){return"AnimationManager"},c.prototype.add=function(b,c,d,e,f,g){"undefined"==typeof e&&(e=!1),"undefined"==typeof f&&(f=!1),"undefined"==typeof g&&(g=!0);var h=new a.Animations.Sequence(b,c,d,e);return 1==g&&this._atlas.sequences.push(h),this.createFromSequence(h,f)},c.prototype.createFromSequence=function(b,c){return"undefined"==typeof c&&(c=!1),this._animations[b.name]=new a.Animations.Animation(b.name,b,this.entity.clock,this),c&&this.play(b.name),this._animations[b.name]},c.prototype.play=function(a,b){return"undefined"==typeof a&&(a=this.currentAnimation.name),"undefined"==typeof b&&(b=!0),0==b&&this.currentAnimation.name===a&&1==this.currentAnimation.isPlaying?this.currentAnimation:this._play(a)},c.prototype.playAt=function(a,b){return"undefined"==typeof b&&(b=this.currentAnimation.name),this._play(b,a)},c.prototype._play=function(a,b){return"undefined"==typeof b&&(b=null),this._setCurrentAnimation(a),null!==b?this.currentAnimation.playAt(b):this.currentAnimation.play(),this.onPlay.dispatch(this.currentAnimation),this.updateCellIndex(),this.currentAnimation},c.prototype.stop=function(){this.isPlaying===!0&&(this.currentAnimation.stop(),this.onStop.dispatch(this.currentAnimation))},c.prototype.pause=function(){this.currentAnimation.pause()},c.prototype.resume=function(){this.currentAnimation.resume()},c.prototype.switchTo=function(a,b){"undefined"==typeof b&&(b=null);var c=!1;switch(typeof a){case"string":this.currentAnimation.name!==a&&(this._setCurrentAnimation(a),c=!0);break;case"number":this.currentAnimation.frameIndex=a,c=!0}(b||null===b&&this.isPlaying&&c)&&this.play(),0==b&&this.isPlaying&&this.stop(),this.updateCellIndex()},c.prototype.nextFrame=function(){this.currentAnimation.nextFrame(),this.updateCellIndex()},c.prototype.prevFrame=function(){this.currentAnimation.prevFrame(),this.updateCellIndex()},c.prototype._setCurrentAnimation=function(a){this.currentAnimation.name!==a&&(null!==this.currentAnimation&&this.currentAnimation.stop(),this._animations[a]&&(this.currentAnimation=this._animations[a],this.onChange.dispatch(a,this.currentAnimation)))},c.prototype.update=function(){this.currentAnimation&&this.currentAnimation.update()},Object.defineProperty(c.prototype,"currentCell",{get:function(){return this.currentAnimation.currentCell},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"frameIndex",{get:function(){return this.currentAnimation.frameIndex},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"length",{get:function(){return this.currentAnimation.length},enumerable:!0,configurable:!0}),c.prototype.getAnimation=function(a){return this._animations[a]},c.prototype.updateCellIndex=function(){"undefined"!=typeof this.currentAnimation&&(this.onUpdate.dispatch(this.currentAnimation),this.entity.cellIndex=this.currentAnimation.currentCell)},c.prototype.destroy=function(){b.prototype.destroy.call(this);for(var a in this._animations)this._animations[a].destroy(),delete this._animations[a];delete this._animations,delete this.currentAnimation,delete this._atlas},c}(a.Component);b.AnimationManager=c}(a.Components||(a.Components={}));a.Components}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(b){function c(c,d,e,f,g){"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=0),"undefined"==typeof g&&(g=0),b.call(this,c,"Box"),this.autoUpdate=!0,this.entity=c,this._rawBounds=new a.Geom.Rectangle(d,e,f,g),this._rawCenter=new a.Geom.Point(d+f/2,e+g/2),this._rawHitbox=new a.Geom.Rectangle,this._hitboxOffset=new a.Geom.Point,this.hitbox=new a.Geom.Rectangle(0,0,f,g),this.autoUpdate=!0}return __extends(c,b),c.prototype.objType=function(){return"Box"},Object.defineProperty(c.prototype,"hitboxOffset",{get:function(){return 1==this.autoUpdate&&null!==this.entity.atlas&&(this._hitboxOffset.x=this.entity.atlas.cells[this.entity.cellIndex].hitboxes[0].x,this._hitboxOffset.y=this.entity.atlas.cells[this.entity.cellIndex].hitboxes[0].y),this._hitboxOffset},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rawHitbox",{get:function(){if(this._rawHitbox.x=this.rawBounds.x+this.hitboxOffset.x,this._rawHitbox.y=this.rawBounds.y+this.hitboxOffset.y,1==this.autoUpdate){var a=this.entity.atlas;null!==a&&(this._rawHitbox.width=a.cells[this.entity.cellIndex].hitboxes[0].w,this._rawHitbox.height=a.cells[this.entity.cellIndex].hitboxes[0].h)}return this._rawHitbox},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"hitbox",{get:function(){return this._transformedHitbox=this._rotateHitbox(this.rawHitbox.clone()),this._transformedHitbox},set:function(a){this._hitboxOffset.x=a.x,this._hitboxOffset.y=a.y,this._rawHitbox=a,this._rawHitbox.x+=this._rawBounds.x,this._rawHitbox.y+=this._rawBounds.y,this.autoUpdate=!1},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"worldHitbox",{get:function(){return this._worldHitbox=this._rotateHitbox(this.rawHitbox.clone(),!0),this._worldHitbox},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rawBounds",{get:function(){return this._rawBounds.x=this.entity.x,this._rawBounds.y=this.entity.y,this._rawBounds.width=this.entity.width,this._rawBounds.height=this.entity.height,this._rawBounds},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rawCenter",{get:function(){return this._rawCenter.x=this.rawBounds.x+this.rawBounds.width/2,this._rawCenter.y=this.rawBounds.y+this.rawBounds.height/2,this._rawCenter},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"center",{get:function(){var b=this.entity.transform,c=b.getConcatenatedMatrix();return c.setTo(c.a,c.b,c.c,c.d,b.x+b.rotPointX,b.y+b.rotPointY),this._transformedCenter=c.transformPoint(new a.Geom.Point(this.entity.width/2-b.rotPointX,this.entity.height/2-b.rotPointY)),this._transformedCenter},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"bounds",{get:function(){return this._transformedBounds=this._rotateRect(this.rawBounds.clone()),this._transformedBounds},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"worldBounds",{get:function(){return this._worldBounds=this._rotateRect(this.rawBounds.clone(),!0),this._worldBounds},enumerable:!0,configurable:!0}),c.prototype._rotateRect=function(b,c){"undefined"==typeof c&&(c=!1);var d=new a.Geom.Rectangle,e=this.entity.transform,f=e.getConcatenatedMatrix();return c||f.setTo(f.a,f.b,f.c,f.d,e.x+e.rotPointX,e.y+e.rotPointY),d=this.extents(f.transformPoint({x:-e.rotPointX,y:-e.rotPointY}),f.transformPoint({x:-e.rotPointX+b.width,y:-e.rotPointY}),f.transformPoint({x:-e.rotPointX+b.width,y:-e.rotPointY+b.height}),f.transformPoint({x:-e.rotPointX,y:-e.rotPointY+b.height}))},c.prototype._rotateHitbox=function(b,c){"undefined"==typeof c&&(c=!1);var d=new a.Geom.Rectangle,e=this.entity.transform,f=e.getConcatenatedMatrix();return c||f.setTo(f.a,f.b,f.c,f.d,e.x+e.rotPointX,e.y+e.rotPointY),d=this.extents(f.transformPoint({x:-e.rotPointX+this._hitboxOffset.x,y:-e.rotPointY+this._hitboxOffset.y}),f.transformPoint({x:-e.rotPointX+b.width+this._hitboxOffset.x,y:-e.rotPointY+this._hitboxOffset.y}),f.transformPoint({x:-e.rotPointX+b.width+this._hitboxOffset.x,y:-e.rotPointY+b.height+this._hitboxOffset.y}),f.transformPoint({x:-e.rotPointX+this._hitboxOffset.x,y:-e.rotPointY+b.height+this._hitboxOffset.y}))},c.prototype.draw=function(a,b){"undefined"==typeof b&&(b=this.game.cameras.defaultCamera);var c=this.entity.transform,d=b.transform;a.strokeStyle="red",a.fillRect(this.rawCenter.x+d.x-1,this.rawCenter.y+d.y-1,3,3),a.strokeRect(c.x+d.x+c.rotPointX-3,c.y+d.y+c.rotPointY-3,7,7),a.strokeStyle="blue",a.strokeRect(this.bounds.x+d.x,this.bounds.y+d.y,this.bounds.width,this.bounds.height),a.strokeStyle="green",a.strokeRect(this.hitbox.x+d.x,this.hitbox.y+d.y,this.hitbox.width,this.hitbox.height),a.strokeStyle="white",a.strokeRect(this.rawHitbox.x+d.x,this.rawHitbox.y+d.y,this.rawHitbox.width,this.rawHitbox.height),a.strokeStyle="purple",a.strokeRect(this.worldBounds.x,this.worldBounds.y,this.worldBounds.width,this.worldBounds.height),a.strokeStyle="cyan",a.strokeRect(this.worldHitbox.x,this.worldHitbox.y,this.worldHitbox.width,this.worldHitbox.height)},c.prototype.extents=function(b,c,d,e){var f=Math.min(b.x,c.x,d.x,e.x),g=Math.max(b.x,c.x,d.x,e.x),h=Math.min(b.y,c.y,d.y,e.y),i=Math.max(b.y,c.y,d.y,e.y);return new a.Geom.Rectangle(f,h,g-f,i-h)},c.prototype.destroy=function(){b.prototype.destroy.call(this),delete this.entity},c}(a.Component);b.Box=c}(a.Components||(a.Components={}));a.Components}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(b){function c(c,d,e){"undefined"==typeof e&&(e=!1),b.call(this,c,"Input"),this._isDragging=null,this._dragEnabled=!1,this._dragSnapToCenter=!1,this._nowDown=null,this._nowUp=null,this._nowEntered=null,this._nowLeft=null,this._nowDragging=null,this._onEntered=new a.Signal,this._onLeft=new a.Signal,this._onDown=new a.Signal,this._onUp=new a.Signal,this._onDragStarted=new a.Signal,this._onDragStopped=new a.Signal,this._box=d,this._distance=new a.Geom.Point,this._withinBounds=null,this._outsideBounds=!0,this._isUp=!0,this._isDown=null,this._isDragging=null,this._justEntered=!1,this._tempDragDisabled=!1,this._tempPoint=new a.Geom.Point,this._tempCircle=new a.Geom.Circle(0,0,0),this.enabled=e}return __extends(c,b),c.prototype.objType=function(){return"Input"},Object.defineProperty(c.prototype,"onEntered",{get:function(){return 0==this.enabled&&(this.enabled=!0),this._onEntered},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onLeft",{get:function(){return 0==this.enabled&&(this.enabled=!0),this._onLeft},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onDown",{get:function(){return 0==this.enabled&&(this.enabled=!0),this._onDown},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onUp",{get:function(){return 0==this.enabled&&(this.enabled=!0),this._onUp},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onDragStarted",{get:function(){return this._onDragStarted},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onDragStopped",{get:function(){return this._onDragStopped},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onRelease",{get:function(){return this.onUp},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onPress",{get:function(){return this.onDown},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isDown",{get:function(){return null!==this._isDown},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isUp",{get:function(){return this._isUp},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"withinBounds",{get:function(){return null!==this._withinBounds},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"outsideBounds",{get:function(){return this._outsideBounds},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isDragging",{get:function(){return null!==this._isDragging},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"dragDistance",{get:function(){return this._dragDistance},set:function(a){this._dragDistance=a},enumerable:!0,configurable:!0}),c.prototype.enableDrag=function(a,b){"undefined"==typeof a&&(a=!1),"undefined"==typeof b&&(b=1),0==this.enabled&&(this.enabled=!0),this._dragEnabled=!0,this._dragSnapToCenter=a,this._dragDistance=b,this._isDragging=null},c.prototype.disableDrag=function(){this._dragEnabled=!1,this._isDragging=null},c.prototype.update=function(){this.enabled!==!1&&this.game&&this.owner.active!==!1&&(this._nowDown=null,this._nowUp=null,this._nowEntered=null,this._nowLeft=null,this._nowDragging=null,a.DEVICE.touch?this._updateTouch():this._updateMouse(),this.isDragging&&(this._tempPoint=this.game.cameras.defaultCamera.transformPoint(this._isDragging.point),this._dragSnapToCenter===!1?(this.owner.transform.x=a.Utils.GameMath.snapTo(this._tempPoint.x-this._box.hitboxOffset.x-this._distance.x,this._dragDistance),this.owner.transform.y=a.Utils.GameMath.snapTo(this._tempPoint.y-this._box.hitboxOffset.y-this._distance.y,this._dragDistance)):(this.owner.transform.x=a.Utils.GameMath.snapTo(this._tempPoint.x-this._box.hitboxOffset.x-this._box.worldHitbox.width/2,this._dragDistance),this.owner.transform.y=a.Utils.GameMath.snapTo(this._tempPoint.y-this._box.hitboxOffset.y-this._box.worldHitbox.height/2,this._dragDistance))))},c.prototype._updateTouch=function(){for(var a=0;a<this.game.input.touch.maximumPointers;a++)this.game.input.touch.fingers[a].active===!0?this._evaluateTouchPointer(this.game.input.touch.fingers[a]):this.isDown===!0&&this._isDown.id===this.game.input.touch.fingers[a].id?this._nowUp=this.game.input.touch.fingers[a]:this.isDown===!1&&null===this._nowUp&&this.withinBounds===!0&&this._withinBounds.id===this.game.input.touch.fingers[a].id&&(this._nowUp=this.game.input.touch.fingers[a]);null!==this._nowEntered&&this.withinBounds===!1&&(this._withinBounds=this._nowEntered,this._outsideBounds=!1,this._onEntered.dispatch(this.owner,this._nowEntered)),null!==this._nowLeft&&this.withinBounds===!0&&(this._withinBounds=null,this._outsideBounds=!0,this._onLeft.dispatch(this.owner,this._nowLeft)),null!==this._nowDown&&this.isDown===!1&&(this._onDown.dispatch(this.owner,this._nowDown),this._isDown=this._nowDown,this._isUp=!1,this._withinBounds=this._nowDown,this._outsideBounds=!1),1==this._dragEnabled&&this.isDragging===!1&&null!==this._nowDragging&&(this._onDragStarted.dispatch(this.owner,this._nowDragging),this._isDragging=this._nowDragging),null!==this._nowUp&&(this._onUp.dispatch(this.owner,this._nowUp),this._isDown=null,this._isUp=!0,this._withinBounds=null,this._outsideBounds=!0,this.isDragging===!0&&this._isDragging.id==this._nowUp.id&&(this._isDragging=null,this._onDragStopped.dispatch(this.owner,this._nowUp)))},c.prototype._evaluateTouchPointer=function(b){(this.isDown===!1||this._isDown.id===b.id)&&(this._tempPoint=this.game.cameras.defaultCamera.transformPoint(b.point),this._tempCircle.setTo(this._tempPoint.x,this._tempPoint.y,b.circle.diameter),a.Geom.Intersect.circleToRectangle(this._tempCircle,this._box.worldHitbox).result?((this.isDown===!0&&this._isDown.id===b.id||this.isDown===!1&&b.duration>1)&&(this._nowEntered=b),this.isDown===!1&&b.frameDuration<2&&(this._nowDown=b),this._dragEnabled&&0==this.isDragging&&1==this.isDown&&(this._distance.x=this._tempPoint.x-this._box.worldHitbox.left,this._distance.y=this._tempPoint.y-this._box.worldHitbox.top,this._nowDragging=b)):this.isDown===!0?this._nowLeft=b:this.withinBounds===!0&&this._withinBounds.id==b.id&&(this._nowLeft=b))},c.prototype._updateMouse=function(){this._evaluateMousePointer(this.game.input.mouse.cursor),null!==this._nowLeft&&this._onLeft.dispatch(this.owner,this._nowLeft),null!==this._nowEntered&&this._onEntered.dispatch(this.owner,this._nowEntered),null!==this._nowDown&&this.isDown===!1&&(this._onDown.dispatch(this.owner,this._nowDown),this._isDown=this._nowDown,this._isUp=!1),1==this._dragEnabled&&this.isDragging===!1&&null!==this._nowDragging&&(this._onDragStarted.dispatch(this.owner,this._nowDragging),this._isDragging=this._nowDragging),this.isDown===!0&&null!==this._nowUp&&this._isDown.id===this._nowUp.id&&(this._onUp.dispatch(this.owner,this._nowUp),this.isDragging===!0&&this._isDragging.id==this._nowUp.id&&(this._isDragging=null,this._onDragStopped.dispatch(this.owner,this._nowUp)),this._isDown=null,this._isUp=!0)},c.prototype._evaluateMousePointer=function(b){this._tempPoint=this.game.cameras.defaultCamera.transformPoint(b.point),a.Geom.Intersect.pointToRectangle(this._tempPoint,this._box.worldHitbox).result?(this._dragEnabled&&this.isDragging===!1&&(this._distance.x=this._tempPoint.x-this._box.worldHitbox.left,this._distance.y=this._tempPoint.y-this._box.worldHitbox.top),this.withinBounds===!1&&(this._nowEntered=b,this._withinBounds=b,this._outsideBounds=!1,this._justEntered=!0)):this.withinBounds===!0&&this.isDragging===!1&&(this._nowLeft=b,this._withinBounds=null,this._outsideBounds=!0),b.isDown===!0?(this._justEntered&&(this._isDown=b,this._isUp=!1,this._tempDragDisabled=!0),this.withinBounds===!0&&this.isDown===!1&&null===this._nowDown&&(this._nowDown=b),this._dragEnabled===!0&&0==this.isDragging&&this._tempDragDisabled===!1&&1==this.isDown&&(this._nowDragging=b)):(this._tempDragDisabled===!0&&(this._tempDragDisabled=!1),this.isDown===!0&&(this._nowUp=b)),this._justEntered&&(this._justEntered=!1)},c.prototype.destroy=function(){b.prototype.destroy.call(this),this.enabled=!1,delete this._box,delete this._isDown,delete this._isUp,delete this._isDragging,delete this._dragEnabled,this._onDown&&this._onDown.dispose(),delete this._onDown,this._onDragStarted&&this._onDragStarted.dispose(),delete this._onDragStarted,this._onUp&&this._onUp.dispose(),delete this._onUp,this._onLeft&&this._onLeft.dispose(),delete this._onLeft,this._onEntered&&this._onEntered.dispose(),delete this._onEntered,this._onDragStopped&&this._onDragStopped.dispose(),delete this._onDragStopped,delete this._dragDistance},c}(a.Component);b.Input=c}(a.Components||(a.Components={}));a.Components}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(a){function b(b){a.call(this,b,"Sound"),this._audio=[]}return __extends(b,a),b.prototype.objType=function(){return"Sound"},b.prototype.addSound=function(a,b,c,d){if("undefined"==typeof c&&(c=1),"undefined"==typeof d&&(d=!1),1!=this._validate(a)){var e=this.game.audio.add(b,c,d);return this._audio[a]=e,e}},b.prototype.removeSound=function(a){0!=this._validate(a)&&(this._audio[a].stop(),this._audio[a].destroy(),delete this._audio[a])},b.prototype.getSound=function(a){return 0!=this._validate(a)?this._audio[a]:void 0},b.prototype._validate=function(a){return void 0===this._audio[a]?!1:!0},b.prototype.play=function(a){0!=this._validate(a)&&this._audio[a].play()},b.prototype.stop=function(a){0!=this._validate(a)&&this._audio[a].stop()},b.prototype.pause=function(a){0!=this._validate(a)&&this._audio[a].pause()},b.prototype.resume=function(a){0!=this._validate(a)&&this._audio[a].resume()},b.prototype.destroy=function(){a.prototype.destroy.call(this);for(var b in this._audio)this._audio[b].stop(),this._audio[b].destroy(),delete this._audio[b];delete this._audio},b}(a.Component);b.Sound=c}(a.Components||(a.Components={}));a.Components}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(b){function c(d,e){b.call(this,d,"ArcadePhysics"),this._callbackFunction=null,this._callbackContext=null,this.parent=d,this.box=e,this.transform=this.parent.transform,this.last=new a.Geom.Point(this.transform.worldX,this.transform.worldY),this.mass=1,this.elasticity=0,this.immovable=!1,this.moves=!0,this.touching=c.NONE,this.wasTouching=c.NONE,this.allowCollisions=c.ANY,this.velocity=new a.Geom.Point,this.acceleration=new a.Geom.Point,this.drag=new a.Geom.Point,this.maxVelocity=new a.Geom.Point(1e4,1e4),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e4}return __extends(c,b),c.prototype.isTouching=function(a){return(this.touching&a)==a},c.prototype.solid=function(a){return void 0!==a&&(this.allowCollisions=a?c.ANY:c.NONE),(this.allowCollisions&c.ANY)>c.NONE},c.prototype.setCallback=function(a,b){this._callbackFunction=a,this._callbackContext=b},c.separate=function(a,b){var c=this.separateX(a,b),d=this.separateY(a,b);return c||d},c.separateX=function(b,d){var e=b.components.getComponent("ArcadePhysics"),f=d.components.getComponent("ArcadePhysics");if(e.immovable&&f.immovable)return!1;var g=0,h=e.transform.worldX-e.last.x,i=f.transform.worldX-f.last.x;if(h==i)return!1;var j=h>0?h:-h,k=i>0?i:-i,l=e.box.worldHitbox,m=f.box.worldHitbox,n=new a.Geom.Rectangle(l.x-(h>0?h:0),e.last.y+e.box.hitboxOffset.y,l.width+(h>0?h:-h),l.height),o=new a.Geom.Rectangle(m.x-(i>0?i:0),f.last.y+f.box.hitboxOffset.y,m.width+(i>0?i:-i),m.height);if(n.x+n.width>o.x&&n.x<o.x+o.width&&n.y+n.height>o.y&&n.y<o.y+o.height){var p=j+k+c.OVERLAP_BIAS;h>i?(g=l.x+l.width-m.x,!(g>p)&&e.allowCollisions&c.RIGHT&&f.allowCollisions&c.LEFT?(e.touching|=c.RIGHT,f.touching|=c.LEFT):g=0):(g=l.x-m.width-m.x,!(-g>p)&&e.allowCollisions&c.LEFT&&f.allowCollisions&c.RIGHT?(e.touching|=c.LEFT,f.touching|=c.RIGHT):g=0)}if(0!=g){var q=e.velocity.x,r=f.velocity.x;if(e.immovable||f.immovable)e.immovable?f.immovable||(f.transform.x=f.transform.x+g,f.velocity.x=q-r*f.elasticity):(e.transform.x=e.transform.x-g,e.velocity.x=r-q*e.elasticity);else{g*=.5,e.transform.x=e.transform.x-g,f.transform.x=f.transform.x+g;
var s=Math.sqrt(r*r*f.mass/e.mass)*(r>0?1:-1),t=Math.sqrt(q*q*e.mass/f.mass)*(q>0?1:-1),u=.5*(s+t);s-=u,t-=u,e.velocity.x=u+s*e.elasticity,f.velocity.x=u+t*f.elasticity}return!0}return!1},c.separateY=function(b,d){var e=b.components.getComponent("ArcadePhysics"),f=d.components.getComponent("ArcadePhysics");if(e.immovable&&f.immovable)return!1;var g=0,h=e.transform.worldY-e.last.y,i=f.transform.worldY-f.last.y;if(h==i)return!1;var j=h>0?h:-h,k=i>0?i:-i,l=e.box.worldHitbox,m=f.box.worldHitbox,n=new a.Geom.Rectangle(l.x,l.y-(h>0?h:0),l.width,l.height+j),o=new a.Geom.Rectangle(m.x,m.y-(i>0?i:0),m.width,m.height+k);if(n.x+n.width>o.x&&n.x<o.x+o.width&&n.y+n.height>o.y&&n.y<o.y+o.height){var p=j+k+c.OVERLAP_BIAS;if(h>i?(g=l.y+l.height-m.y,!(g>p)&&e.allowCollisions&c.DOWN&&f.allowCollisions&c.UP?(e.touching|=c.DOWN,f.touching|=c.UP):g=0):(g=l.y-m.height-m.y,!(-g>p)&&e.allowCollisions&c.UP&&f.allowCollisions&c.DOWN?(e.touching|=c.UP,f.touching|=c.DOWN):g=0),0!=g){var q=e.velocity.y,r=f.velocity.y;if(e.immovable||f.immovable)e.immovable?f.immovable||(f.transform.y=f.transform.y+g,f.velocity.y=q-r*f.elasticity,b.active&&e.moves&&i>h&&(f.transform.x=f.transform.worldX+b.transform.worldX-e.last.x)):(e.transform.y=e.transform.y-g,e.velocity.y=r-q*e.elasticity,d.active&&f.moves&&h>i&&(e.transform.x=e.transform.worldX+d.transform.worldX-f.last.x));else{g*=.5,e.transform.y=e.transform.y-g,f.transform.y=f.transform.y+g;var s=Math.sqrt(r*r*f.mass/e.mass)*(r>0?1:-1),t=Math.sqrt(q*q*e.mass/f.mass)*(q>0?1:-1),u=.5*(s+t);s-=u,t-=u,e.velocity.y=u+s*e.elasticity,f.velocity.y=u+t*f.elasticity}return!0}}return!1},c.separateTiles=function(a,b,c){if(0==a.components.hasComponent("ArcadePhysics"))return!1;if(a.components.getComponent("ArcadePhysics").immovable)return!1;for(var d=!1,e=!1,f=0;f<c.length;f++){var g=c[f];d||(d=this.separateTilesX(a,b,g)),e||(e=this.separateTilesY(a,b,g))}return d||e},c.separateTilesX=function(b,d,e){var f=b.components.getComponent("ArcadePhysics"),g=d.components.getComponent("ArcadePhysics"),h=f.transform.worldX-f.last.x,i=g.transform.worldX-g.last.x;if(h==i)return!1;var j=h>0?h:-h,k=i>0?i:-i,l=0,m=j+k+c.OVERLAP_BIAS,n=f.box.worldHitbox,o=d.tilemap.tileTypes,p=d.tileData,q=g.transform.worldX+e.x,r=new a.Geom.Rectangle(n.x-(h>0?h:0),f.last.y+f.box.hitboxOffset.y,n.width+(h>0?h:-h),n.height),s=new a.Geom.Rectangle(q-(i>0?i:0),g.last.y+e.y,d.tileWidth+(i>0?i:-i),d.tileHeight);if(r.x+r.width>s.x&&r.x<s.x+s.width&&r.y+r.height>s.y&&r.y<s.y+s.height&&(h>i?(l=n.x+n.width-q,!(l>m)&&f.allowCollisions&c.RIGHT&&o[p[e.index]].allowCollisions&c.LEFT?f.touching|=c.RIGHT:l=0):(l=n.x-d.tileWidth-q,!(-l>m)&&f.allowCollisions&c.LEFT&&o[p[e.index]].allowCollisions&c.RIGHT?f.touching|=c.LEFT:l=0),0!=l)){var t=f.velocity.x,u=g.velocity.x;return f.transform.x=f.transform.x-l,f.velocity.x=u-t*f.elasticity,!0}return!1},c.separateTilesY=function(b,d,e){var f=b.components.getComponent("ArcadePhysics"),g=d.components.getComponent("ArcadePhysics"),h=f.transform.worldY-f.last.y,i=g.transform.worldY-g.last.y;if(h==i)return!1;var j=h>0?h:-h,k=i>0?i:-i,l=0,m=j+k+c.OVERLAP_BIAS,n=f.box.worldHitbox,o=d.tilemap.tileTypes,p=d.tileData,q=d.transform.worldY+e.y,r=new a.Geom.Rectangle(n.x,n.y-(h>0?h:0),n.width,n.height+j),s=new a.Geom.Rectangle(g.transform.worldX+e.x,q-(i>0?i:0),d.tileWidth,d.tileHeight+k);if(r.x+r.width>s.x&&r.x<s.x+s.width&&r.y+r.height>s.y&&r.y<s.y+s.height&&(h>i?(l=n.y+n.height-q,!(l>m)&&f.allowCollisions&c.DOWN&&o[p[e.index]].allowCollisions&c.UP?f.touching|=c.DOWN:l=0):(l=n.y-d.tileHeight-q,!(-l>m)&&f.allowCollisions&c.UP&&o[p[e.index]].allowCollisions&c.DOWN?f.touching|=c.UP:l=0),0!=l)){var t=f.velocity.y,u=g.velocity.y;return f.transform.y=f.transform.y-l,f.velocity.y=u-t*f.elasticity,!0}return!1},c.prototype.overlapsTiles=function(b,d,e){if("undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=a.Components.ArcadePhysics.ANY),this.parent.childType()!==a.TILE_LAYER)return!1;var f=this.parent.getOverlappingTiles(b,e);return f.length>0?(d&&c.separateTiles(b,this.parent,f),!0):!1},c.prototype.overlaps=function(a,b){if("undefined"==typeof b&&(b=!1),0!=a.components.hasComponent("Box")){var d=a.components.getComponent("Box"),e=d.worldHitbox.x+d.worldHitbox.width>this.box.worldHitbox.x&&d.worldHitbox.x<this.box.worldHitbox.x+this.box.worldHitbox.width&&d.worldHitbox.y+d.worldHitbox.height>this.box.worldHitbox.y&&d.worldHitbox.y<this.box.worldHitbox.y+this.box.worldHitbox.height;return e&&(b&&c.separate(this.owner,a),null!==this._callbackFunction&&null!==this._callbackContext&&this._callbackFunction.call(this._callbackContext,this.owner,a)),e}},c.prototype.overlapsGroup=function(b,c){"undefined"==typeof c&&(c=!1);for(var d=!1,e=0;e<b.members.length;e++)b.members[e].childType()===a.GROUP?this.overlapsGroup(b.members[e],c):this.overlaps(b.members[e],c)&&(null!==this._callbackContext&&null!==this._callbackFunction&&this._callbackFunction.call(this._callbackContext,this.owner,b.members[e]),d=!0);return d},c.prototype.overlapsArray=function(b,c){"undefined"==typeof c&&(c=!1);for(var d=!1,e=0;e<b.length;e++)"undefined"!=typeof b[e].childType&&(b[e].childType()==a.GROUP?this.overlapsGroup(b[e],c):this.overlaps(b[e],c)&&(null!==this._callbackFunction&&null!==this._callbackContext&&this._callbackFunction.call(this._callbackContext,this.owner,b[e]),d=!0));return d},c.computeVelocity=function(a,b,d,e){return"undefined"==typeof b&&(b=0),"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=1e4),0!=b?a+=b*c.updateInterval:0!=d&&(d*=c.updateInterval,a-d>0?a-=d:0>a+d?a+=d:a=0),0!=a&&1e4!=e&&(a>e?a=e:-e>a&&(a=-e)),a},c.prototype.updateMotion=function(){var a,b;b=(c.computeVelocity(this.angularVelocity,this.angularAcceleration,this.angularDrag,this.maxAngular)-this.angularVelocity)/2,this.angularVelocity+=b,this.transform.rotation+=this.angularVelocity*c.updateInterval,this.angularVelocity+=b,b=(c.computeVelocity(this.velocity.x,this.acceleration.x,this.drag.x,this.maxVelocity.x)-this.velocity.x)/2,this.velocity.x+=b,a=this.velocity.x*c.updateInterval,this.velocity.x+=b,this.transform.x=this.transform.x+a,b=(c.computeVelocity(this.velocity.y,this.acceleration.y,this.drag.y,this.maxVelocity.y)-this.velocity.y)/2,this.velocity.y+=b,a=this.velocity.y*c.updateInterval,this.velocity.y+=b,this.transform.y=this.transform.y+a},c.prototype.update=function(){this.last.x=this.transform.worldX,this.last.y=this.transform.worldY,this.moves&&this.updateMotion(),this.wasTouching=this.touching,this.touching=c.NONE},c.prototype.destroy=function(){b.prototype.destroy.call(this),delete this.transform,delete this.owner,delete this._callbackContext,delete this._callbackFunction},c.prototype.objType=function(){return"ArcadePhysics"},c.collide=function(a,b,d){return"undefined"==typeof d&&(d=!0),c.overlaps(a,b,d)},c.collideGroup=function(a,b,d){return"undefined"==typeof d&&(d=!0),c.overlapsObjectGroup(a,b,d)},c.collideGroupGroup=function(a,b,d){return"undefined"==typeof d&&(d=!0),c.overlapsGroupGroup(a,b,d)},c.overlaps=function(a,b,c){"undefined"==typeof c&&(c=!0);var d=a.components.getComponent("ArcadePhysics");return d.overlaps(b,c)},c.overlapsObjectGroup=function(a,b,c){"undefined"==typeof c&&(c=!0);var d=a.components.getComponent("ArcadePhysics");return d.overlapsGroup(b,c)},c.overlapsGroupGroup=function(b,d,e){"undefined"==typeof e&&(e=!0);for(var f=!1,g=b.members,h=0;h<b.members.length;)g[h].childType()==a.GROUP?c.overlapsGroupGroup(g[h++],d,e)&&(f=!0):c.overlapsObjectGroup(g[h++],d,e)&&(f=!0);return f},c.overlapsArrayGroup=function(b,d,e){"undefined"==typeof e&&(e=!0);for(var f=!1,g=0;g<b.length;g++)"undefined"!=typeof b[g].childType&&(b[g].childType()===a.GROUP?c.overlapsGroupGroup(b[g],d,e)&&(f=!0):c.overlapsObjectGroup(b[g],d,e)&&(f=!0));return f},c.updateInterval=.1,c.LEFT=1,c.RIGHT=16,c.UP=256,c.DOWN=4096,c.NONE=0,c.CEILING=c.UP,c.FLOOR=c.DOWN,c.WALL=c.LEFT|c.RIGHT,c.ANY=c.LEFT|c.RIGHT|c.UP|c.DOWN,c.OVERLAP_BIAS=4,c}(a.Component);b.ArcadePhysics=c}(a.Components||(a.Components={}));a.Components}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a){this._calculateBytes=!0,this._fileTotal=0,this._currentFile=0,this._bytesTotal=0,this._bytesLoaded=0,this._bytesCurrent=0,this._fileChunk=0,this._percentLoaded=0,this._complete=!1,this._game=a}return b.prototype.objType=function(){return"Loader"},b.prototype.boot=function(){this._fileList=[],this._loadList=[]},b.prototype.init=function(a,b,c){"undefined"==typeof a&&(a=null),"undefined"==typeof b&&(b=null),"undefined"==typeof c&&(c=!1),this._fileList.length=0,this._loadList.length=0,this._calculateBytes=c,this._complete=!1,null!==a&&(this._onProgressCallback=a),null!==b&&(this._onCompleteCallback=b)},b.prototype.addImage=function(b,c,d,e,f,g,h){"undefined"==typeof h&&(h=!0);var i=new a.Files.File(this._game,a.Files.File.IMAGE,c,b,!0,h);i.metadata={width:d,height:e,offsetX:f,offsetY:g},this._fileList.push(i)},b.prototype.addSpriteSheet=function(b,c,d,e,f,g,h,i,j,k,l,m){"undefined"==typeof m&&(m=!0);var n=new a.Files.File(this._game,a.Files.File.SPRITE_SHEET,c,b,!0,m);n.metadata={frameWidth:d,frameHeight:e,numCells:f,rows:g,cols:h,sheetOffsetX:i,sheetOffsetY:j,cellOffsetX:k,cellOffsetY:l},this._fileList.push(n)},b.prototype.addTextureAtlas=function(b,c,d,e,f){"undefined"==typeof f&&(f=!0);var g=new a.Files.File(this._game,a.Files.File.TEXTURE_ATLAS,c,b,!0,f),h=new a.Files.File(this._game,a.Files.File.JSON,e,d,!0,f);g.metadata={jsonID:d},h.metadata={imageID:b},this._fileList.push(g,h)},b.prototype.addAudio=function(b,c,d,e){if("undefined"==typeof d&&(d=!0),"undefined"==typeof e&&(e=!0),a.Utils.Common.isString(c))this.attemptToAddAudio(b,c,d,e);else if(a.Utils.Common.isArray(c))for(var f=0;f<c.length&&(0==a.Utils.Common.isString(c[f])||1!=this.attemptToAddAudio(b,c[f],d,e));f++);},b.prototype.attemptToAddAudio=function(b,c,d,e){var f=new a.Files.File(this._game,a.Files.File.AUDIO,c,b,!0,d),g=!1;switch(f.fileExtension){case"mp3":g=a.DEVICE.mp3;break;case"ogg":case"oga":g=a.DEVICE.ogg;break;case"m4a":g=a.DEVICE.m4a;break;case"wav":case"wave":g=a.DEVICE.wav}return 1==g||0==e?(this._fileList.push(f),!0):(this._game.debug&&console.error("Kiwi.Loader: Audio Format not supported on this Device/Browser."),!1)},b.prototype.addJSON=function(b,c,d){"undefined"==typeof d&&(d=!0),this._fileList.push(new a.Files.File(this._game,a.Files.File.JSON,c,b,!0,d))},b.prototype.addXML=function(b,c,d){"undefined"==typeof d&&(d=!0),this._fileList.push(new a.Files.File(this._game,a.Files.File.XML,c,b,!0,d))},b.prototype.addBinaryFile=function(b,c,d){"undefined"==typeof d&&(d=!0),this._fileList.push(new a.Files.File(this._game,a.Files.File.BINARY_DATA,c,b,!0,d))},b.prototype.addTextFile=function(b,c,d){"undefined"==typeof d&&(d=!0),this._fileList.push(new a.Files.File(this._game,a.Files.File.TEXT_DATA,c,b,!0,d))},b.prototype.startLoad=function(){0===this._fileList.length?this._onCompleteCallback():(this._onProgressCallback(0,0,null),this._fileTotal=this._fileList.length,this._bytesLoaded=0,this._bytesTotal=0,this._bytesCurrent=0,this._currentFile=0,this._fileChunk=0,this._percentLoaded=0,this._calculateBytes===!0?this.getNextFileSize():(this._fileChunk=Math.floor(100/this._fileTotal),this._loadList=this._fileList,this.nextFile()))},b.prototype.getNextFileSize=function(){var a=this;if(0===this._fileList.length){var b=this._fileList.shift();b.getFileDetails(function(b){return a.addToBytesTotal(b)})}else this.nextFile()},b.prototype.addToBytesTotal=function(a){this._bytesTotal+=a.fileSize,this._loadList.push(a),this.getNextFileSize()},b.prototype.nextFile=function(){var a=this;this._currentFile++;var b=this._loadList.shift();b.load(function(b){return a.fileLoadComplete(b)},function(b){return a.fileLoadProgress(b)})},b.prototype.fileLoadProgress=function(a){this._calculateBytes===!0&&(this._bytesCurrent=a.bytesLoaded,this._onProgressCallback&&this._onProgressCallback(this.getPercentLoaded(),this.getBytesLoaded(),a))},b.prototype.fileLoadComplete=function(a){this._calculateBytes===!0?(this._bytesLoaded+=a.bytesTotal,this._bytesCurrent=0,this._onProgressCallback&&this._onProgressCallback(this.getPercentLoaded(),this._bytesLoaded,a)):this._onProgressCallback&&this._onProgressCallback(this.getPercentLoaded(),0,a),0===this._loadList.length?(this._complete=!0,this._game.debug&&console.log("All files have loaded"),this._onCompleteCallback&&this._onCompleteCallback()):this.nextFile()},b.prototype.getBytesLoaded=function(){return this._bytesLoaded+this._bytesCurrent},b.prototype.getPercentLoaded=function(){return Math.round(this._calculateBytes===!0?this.getBytesLoaded()/this._bytesTotal*100:this._currentFile/this._fileTotal*100)},b.prototype.calculateBytes=function(a){return a&&(this._calculateBytes=a),this._calculateBytes},b.prototype.complete=function(){return this._complete},b}();b.Loader=c}(a.Files||(a.Files={}));a.Files}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a){this._game=a,this.data={}}return b.prototype.objType=function(){return"DataLibrary"},b.prototype.clear=function(){for(var a in this.data)delete this.data[a]},b.prototype.add=function(b){switch(b.dataType){case a.Files.File.JSON:case a.Files.File.XML:case a.Files.File.BINARY_DATA:case a.Files.File.TEXT_DATA:this.data[b.key]=b}},b.prototype.rebuild=function(a,b){this.clear(),this._game.debug&&console.log("Kiwi.DataLibrary: Rebuilding Data Library");for(var c=a.keys,d=0;d<c.length;d++){var e=this._game.fileStore.getFile(c[d]);e.isData&&(this._game.debug&&console.log("  Kiwi.DataLibrary: Adding Data: "+e.fileName),b.dataLibrary.add(e))}},b}();b.DataLibrary=c}(a.Files||(a.Files={}));a.Files}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(b,c,d,e,f,g){"undefined"==typeof e&&(e=""),"undefined"==typeof f&&(f=!0),"undefined"==typeof g&&(g=!0),this._xhr=null,this._saveToFileStore=!0,this._useTagLoader=!0,this.fileSize=0,this.ETag="",this.lastModified="",this.timeStarted=0,this.timeFinished=0,this.duration=0,this.hasError=!1,this.success=!1,this.onCompleteCallback=null,this.onProgressCallback=null,this.lastProgress=0,this.percentLoaded=0,this.status=0,this.statusText="",this.bytesLoaded=0,this.bytesTotal=0,this.readyState=0,this.timeOutDelay=4e3,this.hasTimedOut=!1,this.timedOut=0,this.attemptCounter=0,this.maxLoadAttempts=2,this.maxHeadLoadAttempts=1,this._game=b,this.dataType=c,this.fileURL=d,d.lastIndexOf("/")>-1?(this.fileName=d.substr(d.lastIndexOf("/")+1),this.filePath=d.substr(0,d.lastIndexOf("/")+1)):(this.filePath="",this.fileName=d),this.fileExtension=d.substr(d.lastIndexOf(".")+1).toLowerCase(),this._useTagLoader=a.DEVICE.blob?!0:!0,this.dataType===a.Files.File.AUDIO&&(this._useTagLoader=this._game.audio.usingAudioTag===!0?!0:!1),this.dataType===a.Files.File.JSON&&(this._useTagLoader=!1),this._saveToFileStore=f,this._fileStore=this._game.fileStore,this.ownerState=this._game.states.current&&!g?this._game.states.current:null,this.key=""===this.key?this.fileName:e}return b.prototype.objType=function(){return"File"},b.prototype.addTag=function(a){-1==this._tags.indexOf(a)&&this._tags.push(a)},b.prototype.removeTag=function(a){var b=this._tags.indexOf(a);-1!=b&&this._tags.splice(b,1)},b.prototype.hasTag=function(a){return-1==this._tags.indexOf(a)?!1:!0},Object.defineProperty(b.prototype,"isTexture",{get:function(){return this.dataType===b.IMAGE||this.dataType===b.SPRITE_SHEET||this.dataType===b.TEXTURE_ATLAS?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isAudio",{get:function(){return this.dataType===b.AUDIO?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isData",{get:function(){return this.dataType===b.XML||this.dataType===b.JSON||this.dataType===b.TEXT_DATA||this.dataType===b.BINARY_DATA?!0:!1},enumerable:!0,configurable:!0}),b.prototype.load=function(a,b,c,d,e){"undefined"==typeof a&&(a=null),"undefined"==typeof b&&(b=null),"undefined"==typeof c&&(c=null),this._game.debug&&console.log("Kiwi.File: Attempting to load: "+this.fileName),this.onCompleteCallback=a,this.onProgressCallback=b,void 0!=d&&(this.maxLoadAttempts=d),void 0!=e&&(this.timeOutDelay=e),null!==c&&(this._fileStore=c,this._saveToFileStore=!0),this.start(),this._useTagLoader===!0?this.tagLoader():this.xhrLoader()},b.prototype.start=function(){this.timeStarted=Date.now(),this.lastProgress=Date.now(),this.percentLoaded=0,this.attemptCounter=0},b.prototype.stop=function(){this.percentLoaded=100,this.timeFinished=Date.now(),this.duration=this.timeFinished-this.timeStarted},b.prototype.tagLoader=function(){var b=this;this.dataType===a.Files.File.IMAGE||this.dataType===a.Files.File.SPRITE_SHEET||this.dataType===a.Files.File.TEXTURE_ATLAS?(this.data=new Image,this.data.src=this.fileURL,this.data.onload=function(a){return b.tagLoaderOnLoad(a)},this.data.onerror=function(a){return b.tagLoaderOnError(a)},this.data.onreadystatechange=function(a){return b.tagLoaderOnReadyStateChange(a)}):this.dataType===a.Files.File.AUDIO&&(this.data=document.createElement("audio"),this.data.src=this.fileURL,this.data.preload="auto",this._game.audio.locked?this.tagLoaderAudioLocked():(this.data.addEventListener("canplaythrough",function(){return b.tagLoaderProgressThrough(null)},!1),this._game.deviceTargetOption==a.TARGET_COCOON?this.data.load():(this.data.volume=0,this.data.play())))},b.prototype.tagLoaderOnReadyStateChange=function(){},b.prototype.tagLoaderOnError=function(a){this.hasError=!0,this.error=a,this.onCompleteCallback&&this.onCompleteCallback(this)},b.prototype.tagLoaderProgressThrough=function(){var b=this;100!==this.percentLoaded&&(this.dataType===a.Files.File.AUDIO&&(this.data.removeEventListener("canplaythrough",function(){return b.tagLoaderProgressThrough(null)}),this.data.pause(),this.data.currentTime=0,this.data.volume=1),this.tagLoaderOnLoad(null))},b.prototype.tagLoaderAudioLocked=function(){this.percentLoaded=100,this.tagLoaderOnLoad(null)},b.prototype.tagLoaderOnLoad=function(){this.stop(),this._game.debug&&console.log("Kiwi.File: Successfully Loaded: "+this.fileName),this._saveToFileStore===!0&&this._fileStore.addFile(this.key,this),this.onCompleteCallback&&this.onCompleteCallback(this)},b.prototype.xhrLoader=function(){var a=this;this.attemptCounter++,this._xhr=new XMLHttpRequest,this._xhr.open("GET",this.fileURL,!0),null!==this.timeOutDelay&&(this._xhr.timeout=this.timeOutDelay),this._xhr.responseType="arraybuffer",this._xhr.onloadstart=function(b){return a.xhrOnLoadStart(b)},this._xhr.onprogress=function(b){return a.xhrOnProgress(b)},this._xhr.ontimeout=function(b){return a.xhrOnTimeout(b)},this._xhr.onabort=function(b){return a.xhrOnAbort(b)},this._xhr.onload=function(b){return a.xhrOnLoad(b)},this._xhr.onreadystatechange=function(b){return a.xhrOnReadyStateChange(b)},this._xhr.send()},b.prototype.xhrOnReadyStateChange=function(a){this.readyState=a.target.readyState,4===this.readyState&&this.xhrOnLoad(a)},b.prototype.xhrOnLoadStart=function(a){this.timeStarted=a.timeStamp,this.lastProgress=a.timeStamp},b.prototype.xhrOnAbort=function(a){this._game.debug&&console.log("Kiwi.File: "+this.fileName+" loading was aborted."),this.error=a},b.prototype.xhrOnError=function(a){this._game.debug&&console.log("Kiwi.File: Error during load: "+this.fileName),this.error=a},b.prototype.xhrOnTimeout=function(a){this._game.debug&&console.log("Kiwi.File: Timed out: "+this.fileName),this.hasTimedOut=!0,this.timedOut=Date.now(),this.error=a},b.prototype.xhrOnProgress=function(a){this.bytesLoaded=parseInt(a.loaded),this.bytesTotal=parseInt(a.totalSize),this.percentLoaded=Math.round(this.bytesLoaded/this.bytesTotal*100),this.onProgressCallback&&this.onProgressCallback(this)},b.prototype.xhrOnLoad=function(){this.timeFinished>0||(this.status=this._xhr.status,this.statusText=this._xhr.statusText,200===this._xhr.status?(this.stop(),this.success=!0,this.hasError=!1,this._game.debug&&console.log("Kiwi.File: Successfully Loaded: "+this.fileName),this.fileType=this._xhr.getResponseHeader("Content-Type"),this.bytesTotal=parseInt(this._xhr.getResponseHeader("Content-Length")),this.lastModified=this._xhr.getResponseHeader("Last-Modified"),this.ETag=this._xhr.getResponseHeader("ETag"),this.buffer=this._xhr.response,this.processFile()):this.attemptCounter>=this.maxLoadAttempts?(this.success=!1,this.hasError=!0,this._game.debug&&console.error("Kiwi.File: "+this.fileName+" wasn't loaded."),this.parseComplete()):(this._game.debug&&console.log("Kiwi.File: Retrying to load: "+this.fileName),this.xhrLoader()))},b.prototype.processFile=function(){switch(this.dataType){case a.Files.File.IMAGE:case a.Files.File.SPRITE_SHEET:case a.Files.File.TEXTURE_ATLAS:this.createBlob();break;case a.Files.File.JSON:this.data="";for(var b=new Uint8Array(this.buffer),c=0;c<b.length;c++)this.data+=String.fromCharCode(b[c]);this.parseComplete();break;case a.Files.File.AUDIO:if(this._game.audio.usingWebAudio){this.data={raw:this._xhr.response,decoded:!1,buffer:null};var d=this;this._game.audio.context.decodeAudioData(this.data.raw,function(a){a&&(d.data.buffer=a,d.data.decoded=!0,d.parseComplete())})}break;default:this.parseComplete()}},b.prototype.createBlob=function(){var a=this;this.data=document.createElement("img"),this.data.onload=function(){return a.revoke()};var b="";"jpg"===this.fileExtension||"jpeg"===this.fileExtension?b="image/jpeg":"png"===this.fileExtension?b="image/png":"gif"===this.fileExtension&&(b="image/gif");var c=new window.Blob([this.buffer],{type:b});window.URL?this.data.src=window.URL.createObjectURL(c):window.webkitURL&&(this.data.src=window.webkitURL.createObjectURL(c))},b.prototype.revoke=function(){window.URL?window.URL.revokeObjectURL(this.data.src):window.webkitURL&&window.webkitURL.revokeObjectURL(this.data.src),this.parseComplete()},b.prototype.parseComplete=function(){this._saveToFileStore===!0&&this._fileStore.addFile(this.key,this),this.onCompleteCallback&&this.onCompleteCallback(this)},b.prototype.getFileDetails=function(a,b,c){"undefined"==typeof a&&(a=null),"undefined"==typeof c&&(c=this.timeOutDelay),this.onCompleteCallback=a,void 0!==this.maxHeadLoadAttempts&&(this.maxHeadLoadAttempts=b),this.attemptCounter=0,this.sendXHRHeadRequest(c)},b.prototype.sendXHRHeadRequest=function(a){var b=this;this.attemptCounter++,this._xhr=new XMLHttpRequest,this._xhr.open("HEAD",this.fileURL,!1),this._xhr.onload=function(a){return b.getXHRResponseHeaders(a)},this._xhr.ontimeout=function(a){return b.xhrHeadOnTimeout(a)},this._xhr.onerror=function(a){return b.xhrHeadOnError(a)},null!==this.timeOutDelay&&(this._xhr.timeout=a),this._xhr.send()},b.prototype.xhrHeadOnTimeout=function(a){this.hasTimedOut=!0,this.timedOut=Date.now(),this.error=a},b.prototype.xhrHeadOnError=function(a){this.hasError=!0,this.error=a,this.status=this._xhr.status,this.statusText=this._xhr.statusText},b.prototype.getXHRResponseHeaders=function(){this.status=this._xhr.status,this.statusText=this._xhr.statusText,200===this._xhr.status?(this.fileType=this._xhr.getResponseHeader("Content-Type"),this.fileSize=parseInt(this._xhr.getResponseHeader("Content-Length")),this.lastModified=this._xhr.getResponseHeader("Last-Modified"),this.ETag=this._xhr.getResponseHeader("ETag"),this.completeXHRHeadRequest(!0)):this.completeXHRHeadRequest(!1)},b.prototype.completeXHRHeadRequest=function(a){return 0==a&&this.attemptCounter<this.maxLoadAttempts?void this.sendXHRHeadRequest(this.timeOutDelay):void(this.onCompleteCallback&&(this.attemptCounter=0,this.onCompleteCallback(this)))},b.IMAGE=0,b.SPRITE_SHEET=1,b.TEXTURE_ATLAS=2,b.AUDIO=3,b.JSON=4,b.XML=5,b.BINARY_DATA=6,b.TEXT_DATA=7,b}();b.File=c}(a.Files||(a.Files={}));a.Files}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(a){this._size=0,this._game=a,this._files={}}return a.prototype.objType=function(){return"FileStore"},a.prototype.boot=function(){},a.prototype.getFile=function(a){return this._files[a]},a.prototype.getFilesByTag=function(a){var b={};for(var c in this._files)this._files[c].hasTag(a)&&(b[c]=this._files[c]);return b},a.prototype.removeFilesByTag=function(a){var b=0;for(var c in this._files)this._files[c].hasTag(a)&&(this.removeFile(c),b++);return b},Object.defineProperty(a.prototype,"keys",{get:function(){var a=new Array;for(var b in this._files)a.push(b);return a},enumerable:!0,configurable:!0}),a.prototype.size=function(){return this._size},a.prototype.addFile=function(a,b){return this._files[a]?!1:(this._files[a]=b,this._size++,!0)},a.prototype.exists=function(a){return this._files[a]?!0:!1},a.prototype.removeStateFiles=function(a){for(var b in this._files)this._files[b].ownerState===a&&this.removeFile(b)},a.prototype.removeFile=function(a){return this._files[a]?(this._files[a]=null,delete this._files[a],!0):!1},a}();a.FileStore=b}(a.Files||(a.Files={}));a.Files}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(){this.isReady=!1,this.container=null,this.input=null}return b.prototype.objType=function(){return"Bootstrap"},b.prototype.boot=function(a,b,c){var d=this;"undefined"==typeof b&&(b=null),"undefined"==typeof c&&(c=!0),this._callback=b,this._domParent=a,this._createContainer=c,"complete"===document.readyState||"interactive"===document.readyState?this.ready():(document.addEventListener("DOMContentLoaded",function(){return d.ready()},!1),window.addEventListener("load",function(){return d.ready()},!1))},b.prototype.ready=function(){var a=this;this.isReady!==!0&&(document.body?(this.isReady=!0,this._createContainer===!0&&(""===this._domParent?(this.container=document.createElement("div"),this._setupContainer("KiwiGame"+Date.now().toString()),document.body.appendChild(this.container)):document.getElementById(this._domParent)?(this.container=document.getElementById(this._domParent),this._setupContainer()):(this.container=document.createElement("div"),this._setupContainer(this._domParent),document.body.appendChild(this.container))),null!==this._callback&&this._callback()):window.setTimeout(function(){return a.ready()},13))},b.prototype._setupContainer=function(b){"undefined"==typeof b&&(b=""),b&&(this.container.id=b),this.container.style.width=a.Stage.DEFAULT_WIDTH+"px",this.container.style.height=a.Stage.DEFAULT_HEIGHT+"px",this.container.style.position="relative",this.container.style.overflow="hidden"},b}();b.Bootstrap=c}(a.System||(a.System={}));a.System}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(){this.iOS=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.webGL=!1,this.worker=!1,this.blob=!1,this.touch=!1,this.pointerEnabled=!1,this.arora=!1,this.chrome=!1,this.epiphany=!1,this.firefox=!1,this.ie=!1,this.ieVersion=0,this.ieMobile=!1,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.audioData=!1,this.webaudio=!1,this.ogg=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this._checkAudio(),this._checkBrowser(),this._checkDevice(),this._checkFeatures(),this._checkOS()}return a.prototype.objType=function(){return"Device"},a.prototype._checkOS=function(){var a=navigator.userAgent;/Android/.test(a)?this.android=!0:/CrOS/.test(a)?this.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?this.iOS=!0:/Linux/.test(a)?this.linux=!0:/Mac OS/.test(a)?this.macOS=!0:/Windows Phone/.test(a)?this.windowsPhone=!0:/Windows/.test(a)&&(this.windows=!0)},a.prototype._checkFeatures=function(){"undefined"!=typeof window.Blob&&(this.blob=!0),this.canvas=!!window.CanvasRenderingContext2D,this.webGL=!!window.WebGLRenderingContext;try{this.localStorage=!!localStorage.getItem}catch(a){this.localStorage=!1}this.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),this.fileSystem=!!window.requestFileSystem,this.worker=!!window.Worker,("ontouchstart"in document.documentElement||window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>0||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>0)&&(this.touch=!0),(window.navigator.pointerEnabled||window.navigator.msPointerEnabled)&&(this.pointerEnabled=!0)},a.prototype._checkBrowser=function(){{var a=navigator.userAgent;navigator.appName}/Arora/.test(a)?this.arora=!0:/Chrome/.test(a)?this.chrome=!0:/Epiphany/.test(a)?this.epiphany=!0:/Firefox/.test(a)?this.firefox=!0:/Mobile Safari/.test(a)?this.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(this.ie=!0,this.ieVersion=parseInt(RegExp.$1),/IEMobile/.test(a)&&(this.ieMobile=!0)):/Trident/.test(a)?(this.ie=!0,/rv:(\d+\.\d+)\)/.test(a),this.ieVersion=parseInt(RegExp.$1)):/Midori/.test(a)?this.midori=!0:/Opera/.test(a)?this.opera=!0:/Safari/.test(a)&&(this.safari=!0),navigator.standalone&&(this.webApp=!0)},a.prototype._checkAudio=function(){this.audioData=!!window.Audio,this.webaudio=!(!window.webkitAudioContext&&!window.AudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.ogg=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(this.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(this.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(this.m4a=!0))}catch(c){}},a.prototype._checkDevice=function(){this.pixelRatio=window.devicePixelRatio||1,this.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),this.iPhone4=2==this.pixelRatio&&this.iPhone,this.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad")},a.prototype.getAll=function(){var a="";return a=a.concat("Device\n"),a=a.concat("iPhone : "+this.iPhone+"\n"),a=a.concat("iPhone4 : "+this.iPhone4+"\n"),a=a.concat("iPad : "+this.iPad+"\n"),a=a.concat("\n"),a=a.concat("Operating System\n"),a=a.concat("iOS: "+this.iOS+"\n"),a=a.concat("Android: "+this.android+"\n"),a=a.concat("ChromeOS: "+this.chromeOS+"\n"),a=a.concat("Linux: "+this.linux+"\n"),a=a.concat("MacOS: "+this.macOS+"\n"),a=a.concat("Windows: "+this.windows+"\n"),a=a.concat("\n"),a=a.concat("Browser\n"),a=a.concat("Arora: "+this.arora+"\n"),a=a.concat("Chrome: "+this.chrome+"\n"),a=a.concat("Epiphany: "+this.epiphany+"\n"),a=a.concat("Firefox: "+this.firefox+"\n"),a=a.concat("Internet Explorer: "+this.ie+" ("+this.ieVersion+")\n"),a=a.concat("Mobile Safari: "+this.mobileSafari+"\n"),a=a.concat("Midori: "+this.midori+"\n"),a=a.concat("Opera: "+this.opera+"\n"),a=a.concat("Safari: "+this.safari+"\n"),a=a.concat("\n"),a=a.concat("Features\n"),a=a.concat("Blob: "+this.blob+"\n"),a=a.concat("Canvas: "+this.canvas+"\n"),a=a.concat("File: "+this.file+"\n"),a=a.concat("FileSystem: "+this.fileSystem+"\n"),a=a.concat("LocalStorage: "+this.localStorage+"\n"),a=a.concat("WebGL: "+this.webGL+"\n"),a=a.concat("Worker: "+this.worker+"\n"),a=a.concat("Touch: "+this.touch+"\n"),a=a.concat("\n"),a=a.concat("Audio\n"),a=a.concat("Audio Data: "+this.canvas+"\n"),a=a.concat("Web Audio: "+this.canvas+"\n"),a=a.concat("Can play OGG: "+this.canvas+"\n"),a=a.concat("Can play MP3: "+this.canvas+"\n"),a=a.concat("Can play M4A: "+this.canvas+"\n"),a=a.concat("Can play WAV: "+this.canvas+"\n")},a}();a.Device=b}(a.System||(a.System={}));a.System}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a,b,c,d,e){this.dirty=!1,this.cellIndex=0,this.name=a,this.cells=c||new Array,this.sequences=e||new Array,this.image=d,this._type=b}return b.prototype.objType=function(){return"TextureAtlas"},Object.defineProperty(b.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),b.prototype.refreshTextureGL=function(a){this.glTextureWrapper&&this.glTextureWrapper.refreshTexture(a),this.dirty=!1},b.prototype.readJSON=function(b){var c=JSON.parse(b);void 0!==c.name&&(this.name=c.name);for(var d=0;d<c.cells.length;d++)this.cells.push(c.cells[d]),void 0===c.cells[d].hitboxes&&(this.cells[d].hitboxes=new Array,this.cells[d].hitboxes.push({x:0,y:0,w:this.cells[d].w,h:this.cells[d].h}));if(c.sequences)for(var d=0;d<c.sequences.length;d++){var e=new a.Animations.Sequence(c.sequences[d].name,c.sequences[d].cells);
void 0!==c.sequences[d].speed&&(e.speed=c.sequences[d].speed),void 0!==c.sequences[d].loop&&(e.loop=c.sequences[d].loop),this.sequences.push(e)}},b.SINGLE_IMAGE=0,b.SPRITE_SHEET=1,b.TEXTURE_ATLAS=2,b}();b.TextureAtlas=c}(a.Textures||(a.Textures={}));a.Textures}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a){this._game=a,this.textures=new Object}return b.prototype.objType=function(){return"TextureLibrary"},b.prototype.clear=function(){for(var a in this.textures)delete this.textures[a]},b.prototype.add=function(b){if(this.textures[b.name]=b,this._game.renderOption===a.RENDERER_WEBGL){(-1==a.Utils.Common.base2Sizes.indexOf(b.image.width)||-1==a.Utils.Common.base2Sizes.indexOf(b.image.height))&&console.log("Kiwi.TextureLibrary: Warning:Image is not of base2 size and may not render correctly.");var c=this._game.renderer;c.addTexture(this._game.stage.gl,b)}},b.prototype.addFromFile=function(b){switch(this._game.renderOption===a.RENDERER_WEBGL&&this._game.deviceTargetOption!=a.TARGET_COCOON&&(b=this._rebuildImage(b)),b.dataType){case a.Files.File.SPRITE_SHEET:this.textures[b.key]=this._buildSpriteSheet(b);break;case a.Files.File.IMAGE:this.textures[b.key]=this._buildImage(b);break;case a.Files.File.TEXTURE_ATLAS:this.textures[b.key]=this._buildTextureAtlas(b)}},b.prototype._rebuildImage=function(b){var c=a.Utils.Common.convertToBase2(b.data);return(b.data.width!==c.width||b.data.height!==c.height)&&(b.dataType===a.Files.File.SPRITE_SHEET?(b.metadata.rows||(b.metadata.rows=b.data.height/b.metadata.frameHeight),b.metadata.cols||(b.metadata.cols=b.data.width/b.metadata.frameWidth)):b.dataType===a.Files.File.IMAGE&&(b.metadata.width||(b.metadata.width=b.data.width),b.metadata.height||(b.metadata.height=b.data.height)),this._game.debug&&console.log("Kiwi.TextureLibrary: "+b.fileName+" has been rebuilt to be base2."),b.data=c),b},b.prototype._buildTextureAtlas=function(b){var c=new a.Textures.TextureAtlas(b.key,a.Textures.TextureAtlas.TEXTURE_ATLAS,null,b.data),d=b.metadata,e=this._game.fileStore.getFile(d.jsonID).data;return e.trim(),c.readJSON(e),c},b.prototype._buildSpriteSheet=function(b){var c=b.metadata,d=new a.Textures.SpriteSheet(b.key,b.data,c.frameWidth,c.frameHeight,c.numCells,c.rows,c.cols,c.sheetOffsetX,c.sheetOffsetY,c.cellOffsetX,c.cellOffsetY);return d},b.prototype._buildImage=function(b){var c=b.metadata;return new a.Textures.SingleImage(b.key,b.data,c.width,c.height,c.offsetX,c.offsetY)},b.prototype.rebuild=function(a,b){this.clear(),this._game.debug&&console.log("Kiwi.TextureLibrary: Rebuilding Texture Library");for(var c=a.keys,d=0;d<c.length;d++){var e=this._game.fileStore.getFile(c[d]);e.isTexture&&(this._game.debug&&console.log("  Kiwi.TextureLibrary: Adding Texture: "+e.fileName),b.textureLibrary.addFromFile(e))}},b}();b.TextureLibrary=c}(a.Textures||(a.Textures={}));a.Textures}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(b){function c(c,d,e,f,g,h,i,j,k,l,m){this.cellWidth=e,this.cellHeight=f,this._cols=i||d.width/e,this._rows=h||d.height/f,this.numCells=g||this.cols*this.rows,this.sheetOffsetX=j||0,this.sheetOffsetY=k||0,this.cellOffsetX=l||0,this.cellOffsetY=m||0,b.call(this,c,a.Textures.TextureAtlas.SPRITE_SHEET,this.generateAtlasCells(),d,this.sequences)}return __extends(c,b),c.prototype.objType=function(){return"SpriteSheet"},Object.defineProperty(c.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"cols",{get:function(){return this._cols},enumerable:!0,configurable:!0}),c.prototype.generateAtlasCells=function(){for(var b=new Array,c=new Array,d=this.sheetOffsetX,e=this.sheetOffsetY,f=0,g=0;g<this.rows;g++){for(var h=0;h<this.cols;h++)b.push({x:d,y:e,w:this.cellWidth,h:this.cellHeight,hitboxes:[{x:0,y:0,w:this.cellWidth,h:this.cellHeight}]}),c.push(f++),d+=this.cellOffsetX+this.cellWidth;d=this.sheetOffsetX,e+=this.cellOffsetY+this.cellHeight}return this.sequences=new Array,this.sequences.push(new a.Animations.Sequence("default",c)),b},c}(b.TextureAtlas);b.SpriteSheet=c}(a.Textures||(a.Textures={}));a.Textures}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(b){function c(c,d,e,f,g,h){this.width=e||d.width,this.height=f||d.height,this.offsetX=g||0,this.offsetY=h||0,b.call(this,c,a.Textures.TextureAtlas.SINGLE_IMAGE,this.generateAtlasCells(),d)}return __extends(c,b),c.prototype.objType=function(){return"SingleImage"},c.prototype.generateAtlasCells=function(){return[{x:this.offsetX,y:this.offsetY,w:this.width,h:this.height,hitboxes:[{x:0,y:0,w:this.width,h:this.height}]}]},c}(b.TextureAtlas);b.SingleImage=c}(a.Textures||(a.Textures={}));a.Textures}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){}return a.prototype.objType=function(){return"Back"},a.In=function(a){var b=1.70158;return a*a*((b+1)*a-b)},a.Out=function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},a.InOut=function(a){var b=2.5949095;return(a*=2)<1?.5*a*a*((b+1)*a-b):.5*((a-=2)*a*((b+1)*a+b)+2)},a}();a.Back=b}(a.Easing||(a.Easing={}));a.Easing}(a.Tweens||(a.Tweens={}));a.Tweens}(a.Animations||(a.Animations={}));a.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){!function(b){var c=function(){function b(){}return b.prototype.objType=function(){return"Bounce"},b.In=function(b){return 1-a.Animations.Tweens.Easing.Bounce.Out(1-b)},b.Out=function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},b.InOut=function(b){return.5>b?.5*a.Animations.Tweens.Easing.Bounce.In(2*b):.5*a.Animations.Tweens.Easing.Bounce.Out(2*b-1)+.5},b}();b.Bounce=c}(b.Easing||(b.Easing={}));b.Easing}(b.Tweens||(b.Tweens={}));b.Tweens}(a.Animations||(a.Animations={}));a.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){}return a.prototype.objType=function(){return"Circular"},a.In=function(a){return 1-Math.sqrt(1-a*a)},a.Out=function(a){return Math.sqrt(1- --a*a)},a.InOut=function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},a}();a.Circular=b}(a.Easing||(a.Easing={}));a.Easing}(a.Tweens||(a.Tweens={}));a.Tweens}(a.Animations||(a.Animations={}));a.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){}return a.prototype.objType=function(){return"Cubic"},a.In=function(a){return a*a*a},a.Out=function(a){return--a*a*a+1},a.InOut=function(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)},a}();a.Cubic=b}(a.Easing||(a.Easing={}));a.Easing}(a.Tweens||(a.Tweens={}));a.Tweens}(a.Animations||(a.Animations={}));a.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){}return a.prototype.objType=function(){return"Elastic"},a.In=function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),-(c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)))},a.Out=function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/d)+1)},a.InOut=function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),(a*=2)<1?-.5*c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d):c*Math.pow(2,-10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)*.5+1)},a}();a.Elastic=b}(a.Easing||(a.Easing={}));a.Easing}(a.Tweens||(a.Tweens={}));a.Tweens}(a.Animations||(a.Animations={}));a.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){}return a.prototype.objType=function(){return"Exponential"},a.In=function(a){return 0===a?0:Math.pow(1024,a-1)},a.Out=function(a){return 1===a?1:1-Math.pow(2,-10*a)},a.InOut=function(a){return 0===a?0:1===a?1:(a*=2)<1?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)},a}();a.Exponential=b}(a.Easing||(a.Easing={}));a.Easing}(a.Tweens||(a.Tweens={}));a.Tweens}(a.Animations||(a.Animations={}));a.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){}return a.prototype.objType=function(){return"Linear"},a.None=function(a){return a},a}();a.Linear=b}(a.Easing||(a.Easing={}));a.Easing}(a.Tweens||(a.Tweens={}));a.Tweens}(a.Animations||(a.Animations={}));a.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){}return a.prototype.objType=function(){return"Quadratic"},a.In=function(a){return a*a},a.Out=function(a){return a*(2-a)},a.InOut=function(a){return(a*=2)<1?.5*a*a:-.5*(--a*(a-2)-1)},a}();a.Quadratic=b}(a.Easing||(a.Easing={}));a.Easing}(a.Tweens||(a.Tweens={}));a.Tweens}(a.Animations||(a.Animations={}));a.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){}return a.prototype.objType=function(){return"Quartic"},a.In=function(a){return a*a*a*a},a.Out=function(a){return 1- --a*a*a*a},a.InOut=function(a){return(a*=2)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)},a}();a.Quartic=b}(a.Easing||(a.Easing={}));a.Easing}(a.Tweens||(a.Tweens={}));a.Tweens}(a.Animations||(a.Animations={}));a.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){}return a.prototype.objType=function(){return"Quintic"},a.In=function(a){return a*a*a*a*a},a.Out=function(a){return--a*a*a*a*a+1},a.InOut=function(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)},a}();a.Quintic=b}(a.Easing||(a.Easing={}));a.Easing}(a.Tweens||(a.Tweens={}));a.Tweens}(a.Animations||(a.Animations={}));a.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){!function(a){!function(a){var b=function(){function a(){}return a.prototype.objType=function(){return"Sinusoidal"},a.In=function(a){return 1-Math.cos(a*Math.PI/2)},a.Out=function(a){return Math.sin(a*Math.PI/2)},a.InOut=function(a){return.5*(1-Math.cos(Math.PI*a))},a}();a.Sinusoidal=b}(a.Easing||(a.Easing={}));a.Easing}(a.Tweens||(a.Tweens={}));a.Tweens}(a.Animations||(a.Animations={}));a.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(){function b(a){this._game=a,this._tweens=[]}return b.prototype.objType=function(){return"TweenManager"},b.prototype.getAll=function(){return this._tweens},b.prototype.removeAll=function(){this._tweens.length=0},b.prototype.create=function(b){return new a.Animations.Tween(b,this._game)},b.prototype.add=function(a){return a.setParent(this._game),this._tweens.push(a),a},b.prototype.remove=function(a){var b=this._tweens.indexOf(a);-1!==b&&this._tweens.splice(b,1)},b.prototype.update=function(){if(0===this._tweens.length)return!1;for(var a=0,b=this._tweens.length;b>a;)this._tweens[a].update(this._game.time.now())?a++:(this._tweens.splice(a,1),b--);return!0},b}();b.TweenManager=c}(b.Tweens||(b.Tweens={}));b.Tweens}(a.Animations||(a.Animations={}));a.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(b,c){"undefined"==typeof c&&(c=null),this._game=null,this._manager=null,this._object=null,this._valuesStart={},this._valuesEnd={},this._duration=1e3,this._delayTime=0,this._startTime=null,this._easingFunction=a.Animations.Tweens.Easing.Linear.None,this._interpolationFunction=a.Utils.GameMath.linearInterpolation,this._chainedTweens=[],this._onStartCallback=null,this._onStartContext=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onUpdateContext=null,this._onCompleteCallback=null,this._onCompleteCalled=!1,this._onCompleteContext=null,this.isRunning=!1,this._object=b,null!==c&&(this._game=c,this._manager=this._game.tweens),this.isRunning=!1}return b.prototype.objType=function(){return"Tween"},b.prototype.to=function(a,b,c,d){return"undefined"==typeof b&&(b=1e3),"undefined"==typeof c&&(c=null),"undefined"==typeof d&&(d=!1),this._duration=b,this._valuesEnd=a,null!==c&&(this._easingFunction=c),d===!0?this.start():this},b.prototype.start=function(){if(null!==this._game&&null!==this._object){this.isRunning=!0,this._manager.add(this),this._onStartCallbackFired=!1,this._onCompleteCalled=!1,this._startTime=this._game.time.now()+this._delayTime;for(var a in this._valuesEnd)if(null!==this._object[a]&&a in this._object){if(this._valuesEnd[a]instanceof Array){if(0===this._valuesEnd[a].length)continue;this._valuesEnd[a]=[this._object[a]].concat(this._valuesEnd[a])}this._valuesStart[a]="function"==typeof this._object[a]?this._object[a]():this._object[a]}return this}},b.prototype.stop=function(){return null!==this._manager&&this._manager.remove(this),this.isRunning=!1,this},b.prototype.setParent=function(a){this._game=a,this._manager=this._game.tweens},b.prototype.delay=function(a){return this._delayTime=a,this},b.prototype.easing=function(a){return this._easingFunction=a,this},b.prototype.interpolation=function(a){return this._interpolationFunction=a,this},b.prototype.chain=function(a){return this._chainedTweens.push(a),this},b.prototype.onStart=function(a,b){return this._onStartCallback=a,this._onStartContext=b,this},b.prototype.onUpdate=function(a,b){return this._onUpdateCallback=a,this._onUpdateContext=b,this},b.prototype.onComplete=function(a,b){return this._onCompleteCallback=a,this._onCompleteContext=b,this},b.prototype.update=function(a){if(a<this._startTime)return!0;this._onStartCallbackFired===!1&&(null!==this._onStartCallback&&this._onStartCallback.call(this._onStartContext,this._object),this._onStartCallbackFired=!0);var b=(a-this._startTime)/this._duration;b=b>1?1:b;var c=this._easingFunction(b);for(var d in this._valuesStart){var e=this._valuesStart[d],f=this._valuesEnd[d];f instanceof Array?this._object[d]=this._interpolationFunction(f,c):"function"==typeof this._object[d]?this._object[d](e+(f-e)*c):this._object[d]=e+(f-e)*c}if(null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._onUpdateContext,this._object,c),1==b){this.isRunning=!1,null!==this._onCompleteCallback&&0==this._onCompleteCalled&&(this._onCompleteCalled=!0,this._onCompleteCallback.call(this._onCompleteContext,this._object));for(var g=0;g<this._chainedTweens.length;g++)this._chainedTweens[g].start();return!1}return!0},b}();b.Tween=c}(a.Animations||(a.Animations={}));a.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a){this.numDrawCalls=0,this._game=a}return b.prototype.boot=function(){},b.prototype.objType=function(){return"CanvasRenderer"},b.prototype._recurse=function(b){if(b.visible)if(b.childType()===a.GROUP)for(var c=0;c<b.members.length;c++)this._recurse(b.members[c]);else this.numDrawCalls++,b.render(this._currentCamera)},b.prototype.requestRendererInstance=function(a,b){return"undefined"==typeof b&&(b=null),null},b.prototype.requestSharedRenderer=function(a,b){return"undefined"==typeof b&&(b=null),null},b.prototype.initState=function(){},b.prototype.endState=function(){},b.prototype.render=function(a){var b=this._game.states.current.members,c=this._game.stage.rgbaColor;if(c.a<255&&this._game.stage.ctx.clearRect(0,0,this._game.stage.canvas.width,this._game.stage.canvas.height),this._game.stage.ctx.fillStyle="rgba("+c.r+","+c.g+","+c.b+","+c.a/255+")",this._game.stage.ctx.fillRect(0,0,this._game.stage.canvas.width,this._game.stage.canvas.height),0==b.length)return void console.log("nothing to render");this.numDrawCalls=0,this._currentCamera=a;var d=a.transform.getConcatenatedMatrix(),e=a.transform;this._game.stage.ctx.save(),this._game.stage.ctx.setTransform(d.a,d.b,d.c,d.d,d.tx,d.ty),this._game.stage.ctx.transform(1,0,0,1,-e.rotPointX,-e.rotPointY);for(var f=0;f<b.length;f++)this._recurse(b[f]);this._game.stage.ctx.restore()},b}();b.CanvasRenderer=c}(a.Renderers||(a.Renderers={}));a.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function c(b){if(this._currentRenderer=null,this._entityCount=0,this.numDrawCalls=0,this._maxItems=1e3,this._currentTextureAtlas=null,this._sharedRenderers={},this._game=b,"undefined"==typeof mat4)throw"ERROR: gl-matrix.js is missing";this._currentBlendMode=new a.Renderers.GLBlendMode(this._game.stage.gl,{mode:"DEFAULT"})}return c.prototype.boot=function(){this._textureManager=new b.GLTextureManager,this._shaderManager=new a.Shaders.ShaderManager,this._init()},c.prototype.objType=function(){return"GLRenderManager"},c.prototype.addTexture=function(a,b){this._textureManager.uploadTexture(a,b)},c.prototype.addSharedRenderer=function(b,c){return"undefined"==typeof c&&(c=null),!a.Renderers[b]||b in this._sharedRenderers?!1:(this._sharedRenderers[b]=new a.Renderers[b](this._game.stage.gl,this._shaderManager,c),!0)},c.prototype.addSharedRendererClone=function(b,c,d){return"undefined"==typeof d&&(d=null),"undefined"==typeof d&&(d=null),!a.Renderers[b]||c in this._sharedRenderers?!1:(this._sharedRenderers[c]=new a.Renderers[b](this._game.stage.gl,this._shaderManager,d),!0)},c.prototype.requestSharedRenderer=function(a,b){"undefined"==typeof b&&(b=null);var c=this._sharedRenderers[a];return c?c:this.addSharedRenderer(a,b)?this._sharedRenderers[a]:(console.log("no renderer called "+a),null)},c.prototype.requestRendererInstance=function(b,c){if("undefined"==typeof c&&(c=null),b in a.Renderers){var d=new a.Renderers[b](this._game.stage.gl,this._shaderManager,c);return d}return console.log("No renderer with id "+b+" exists"),null},c.prototype._init=function(){console.log("Intialising WebGL");var a=this._game.stage.gl;this._stageResolution=new Float32Array([this._game.stage.width,this._game.stage.height]),a.viewport(0,0,this._game.stage.width,this._game.stage.height),a.enable(a.BLEND),this._switchBlendMode(a,this._currentBlendMode),this._shaderManager.init(a,"TextureAtlasShader"),this.camMatrix=mat3.create(),this._game.stage.onResize.add(function(b,c){this._stageResolution=new Float32Array([b,c]),this.currentRenderer&&this._currentRenderer.updateStageResolution(a,this._stageResolution),a.viewport(0,0,b,c)},this)},c.prototype.initState=function(a){this._textureManager.clearTextures(this._game.stage.gl),this._textureManager.uploadTextureLibrary(this._game.stage.gl,a.textureLibrary)},c.prototype.endState=function(){this._textureManager.clearTextures(this._game.stage.gl),console.log("ending WebGL on State")},c.prototype.render=function(a){var b=this._game.stage.gl,c=this._game.stage.normalizedColor;if(b.clearColor(c.r*c.a,c.g*c.a,c.b*c.a,c.a),b.clear(b.COLOR_BUFFER_BIT),0==this._game.states.current.members.length)return void console.log("nothing to render");this.numDrawCalls=0,this._textureManager.numTextureWrites=0,this._entityCount=0;var d=a.transform.getConcatenatedMatrix(),e=a.transform,f=vec2.create(),g=vec2.create(),h=vec2.create();vec2.set(g,e.scaleX,e.scaleY),vec2.set(f,-e.rotPointX,-e.rotPointY),vec2.set(h,d.tx,d.ty),mat3.identity(this.camMatrix),mat3.translate(this.camMatrix,this.camMatrix,h),mat3.rotate(this.camMatrix,this.camMatrix,e.rotation),mat3.scale(this.camMatrix,this.camMatrix,g),mat3.translate(this.camMatrix,this.camMatrix,f),this.collateRenderSequence(),this.collateBatches(),this.renderBatches(b,a)},c.prototype.collateRenderSequence=function(){this._sequence=[];var a=this._game.states.current;this.collateChild(a)},c.prototype.collateChild=function(b){if(b.visible)if(b.childType()===a.GROUP)for(var c=0;c<b.members.length;c++)this.collateChild(b.members[c]);else{var d=b;this._sequence.push({entity:d,renderer:d.glRenderer,shader:d.glRenderer.shaderPair,isBatchRenderer:d.glRenderer.isBatchRenderer,texture:d.atlas})}},c.prototype.collateBatches=function(){var a=null,b=null,c=null;this._batches=[];for(var d,e=0;e<this._sequence.length;e++){if(!this._sequence[e].isBatchRenderer||this._sequence[e].renderer!==a||this._sequence[e].shader!==b||this._sequence[e].texture!==c){var d=this._batches.push(new Array)-1;a=this._sequence[e].renderer,b=this._sequence[e].shader,c=this._sequence[e].texture}this._batches[d].push(this._sequence[e])}},c.prototype.renderBatches=function(a,b){for(var c=0;c<this._batches.length;c++)this.renderBatch(a,this._batches[c],b)},c.prototype.renderBatch=function(a,b,c){var d=!1;b[0].entity.glRenderer!==this._currentRenderer&&(d=!0,this._switchRenderer(a,b[0].entity)),this._currentRenderer.clear(a,{camMatrix:this.camMatrix});for(var e=0;e<b.length;e++)b[e].entity.renderGL(a,c);(b[0].entity.atlas!==this._currentTextureAtlas||b[0].entity.atlas.dirty||d&&b[0].entity.atlas==this._currentTextureAtlas)&&this._switchTexture(a,b[0].entity),(!this._currentBlendMode.isIdentical(b[0].entity.glRenderer.blendMode)||this._currentBlendMode.dirty)&&this._switchBlendMode(a,b[0].entity.glRenderer.blendMode),this._currentRenderer.draw(a)},c.prototype.renderEntity=function(a,b,c){this.renderBatch(a,[b],c)},c.prototype.setupGLState=function(a,b){b.atlas!==this._currentTextureAtlas&&this._switchTexture(a,b),b.glRenderer!==this._currentRenderer&&this._switchRenderer(a,b)},c.prototype._switchRenderer=function(a,b){this._currentRenderer&&this._currentRenderer.disable(a),this._currentRenderer=b.glRenderer,this._currentRenderer.enable(a,{camMatrix:this.camMatrix,stageResolution:this._stageResolution})},c.prototype._switchTexture=function(a,b){this._currentTextureAtlas=b.atlas,this._currentRenderer&&this._currentRenderer.updateTextureSize(a,new Float32Array([this._currentTextureAtlas.glTextureWrapper.image.width,this._currentTextureAtlas.glTextureWrapper.image.height])),this._textureManager.useTexture(a,b.atlas.glTextureWrapper),this._currentTextureAtlas.refreshTextureGL(a)},c.prototype._switchBlendMode=function(a,b){this._currentBlendMode=b,this._currentBlendMode.apply(a)},c}();b.GLRenderManager=c}(a.Renderers||(a.Renderers={}));a.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(){this._shaderPairs={}}return Object.defineProperty(b.prototype,"currentShader",{get:function(){return this._currentShader},enumerable:!0,configurable:!0}),b.prototype.init=function(a,b){this._currentShader=this.requestShader(a,b)},b.prototype.requestShader=function(a,b,c){"undefined"==typeof c&&(c=!0);var d;return b in this._shaderPairs?(d=this._shaderPairs[b],d.loaded||this._loadShader(a,d),c&&this._useShader(a,d),d):this.shaderExists(a,b)?(d=this._addShader(a,b),this._loadShader(a,d),c&&this._useShader(a,d),d):(console.log("Shader "+b+" does not exist"),null)},b.prototype.shaderExists=function(b,c){return c in a.Shaders},b.prototype._addShader=function(b,c){return this._shaderPairs[c]=new a.Shaders[c],this._shaderPairs[c]},b.prototype._loadShader=function(a,b){b.init(a)},b.prototype._useShader=function(a,b){b!==this._currentShader&&(this._currentShader=b),a.useProgram(b.shaderProgram)},b}();b.ShaderManager=c}(a.Shaders||(a.Shaders={}));a.Shaders}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(a,b,c){"undefined"==typeof c&&(c=!1),this._created=!1,this._uploaded=!1,this.textureAtlas=b,this.image=b.image,this._numBytes=this.image.width*this.image.height*4,this.createTexture(a),c&&this.uploadTexture(a)}return Object.defineProperty(a.prototype,"numBytes",{get:function(){return this._numBytes},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"created",{get:function(){return this._created},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"uploaded",{get:function(){return this._uploaded},enumerable:!0,configurable:!0}),a.prototype.createTexture=function(a){return this.texture=a.createTexture(),this._created=!0,!0},a.prototype.uploadTexture=function(a){var b=!1;return this.created||this.createTexture(a),this.uploaded?console.log("...not uploading:the image is already uploaded"):(a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.image),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindTexture(a.TEXTURE_2D,null),this._uploaded=!0,b=!0),b},a.prototype.refreshTexture=function(a){this.numBytes=this.image.width*this.image.height*4,a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.image)},a.prototype.deleteTexture=function(a){return a.deleteTexture(this.texture),this._uploaded=!1,this._created=!1,!0},a}();a.GLTextureWrapper=b}(a.Renderers||(a.Renderers={}));a.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function b(){this.numTextureWrites=0,this._numTexturesUsed=0,this._usedTextureMem=0,this.maxTextureMem=1024*b.DEFAULT_MAX_TEX_MEM_MB*1024,this._textureWrapperCache=new Array}return Object.defineProperty(b.prototype,"usedTextureMem",{get:function(){return this._usedTextureMem},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"numTexturesUsed",{get:function(){return this._numTexturesUsed},enumerable:!0,configurable:!0}),b.prototype._addTextureToCache=function(a){this._textureWrapperCache.push(a)},b.prototype._deleteTexture=function(a,b){this._textureWrapperCache[b].deleteTexture(a),this._usedTextureMem-=this._textureWrapperCache[b].numBytes,this._numTexturesUsed--},b.prototype._uploadTexture=function(a,b){return b.numBytes+this._usedTextureMem<=this.maxTextureMem?(b.uploadTexture(a),this._usedTextureMem+=b.numBytes,this._numTexturesUsed++,!0):!1},b.prototype.uploadTextureLibrary=function(a,b){this._textureWrapperCache=new Array;for(var c in b.textures)this.uploadTexture(a,b.textures[c])},b.prototype.uploadTexture=function(b,c){var d=new a.GLTextureWrapper(b,c);this._addTextureToCache(d),c.glTextureWrapper=d,this._uploadTexture(b,d)||console.log("...skipped uploading texture due to allocated texture memory exceeded")},b.prototype.clearTextures=function(a){for(var b=0;b<this._textureWrapperCache.length;b++)this._deleteTexture(a,b),this._textureWrapperCache[b].textureAtlas.glTextureWrapper=null;this._textureWrapperCache=new Array},b.prototype.useTexture=function(a,b){return b.created&&b.uploaded||(this._uploadTexture(a,b)||(this._freeSpace(a,b.numBytes),this._uploadTexture(a,b)),this.numTextureWrites++),b.created&&b.uploaded?(a.bindTexture(a.TEXTURE_2D,b.texture),!0):!1},b.prototype._freeSpace=function(a,b){for(var c=99999999999,d=-1,e=0;e<this._textureWrapperCache.length;e++){var f=this._textureWrapperCache[e].numBytes;if(f===b&&this._textureWrapperCache[e].uploaded)return this._deleteTexture(a,e),!0;f>b&&c>f&&(c=f,d=e)}return!0},b.DEFAULT_MAX_TEX_MEM_MB=1024,b}();a.GLTextureManager=b}(a.Renderers||(a.Renderers={}));a.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(b,c,d,e){"undefined"==typeof e&&(e=!0),this._created=!1,this._uploaded=!1,this.items=d||a.squareVertices,this.itemSize=c||2,this.numItems=this.items.length/this.itemSize,this.createBuffer(b),e&&this.uploadBuffer(b,this.items)}return Object.defineProperty(a.prototype,"created",{get:function(){return this._created},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"uploaded",{get:function(){return this._uploaded},enumerable:!0,configurable:!0}),a.prototype.clear=function(){this.items=new Array},a.prototype.createBuffer=function(a){return this.buffer=a.createBuffer(),this._created=!0,!0},a.prototype.uploadBuffer=function(a,b){this.items=b,this.numItems=this.items.length/this.itemSize;var c=new Float32Array(this.items);return a.bindBuffer(a.ARRAY_BUFFER,this.buffer),a.bufferData(a.ARRAY_BUFFER,c,a.DYNAMIC_DRAW),this._uploaded=!0,!0},a.prototype.deleteBuffer=function(a){return a.bindBuffer(a.ARRAY_BUFFER,this.buffer),a.deleteBuffer(this.buffer),this.uploaded=!1,this.created=!1,!0},a.squareVertices=[0,0,100,0,100,100,0,100],a.squareUVs=[0,0,.1,0,.1,.1,0,.1],a.squareCols=[1,1,1,1],a}();a.GLArrayBuffer=b}(a.Renderers||(a.Renderers={}));a.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(a,b){this.gl=a,this.dirty=!0,this._srcRGB=a.SRC_ALPHA,this._dstRGB=a.ONE_MINUS_SRC_ALPHA,this._srcAlpha=a.ONE,this._dstAlpha=a.ONE,this._modeRGB=a.FUNC_ADD,this._modeAlpha=a.FUNC_ADD,"undefined"==typeof b&&(b=null),b&&this.readConfig(b)}return a.prototype.readConfig=function(a){void 0!==a.mode?this.setMode(a.mode):(a.srcRGB=this.makeConstant(a.srcRGB),"undefined"!=typeof a.srcRGB&&(this._srcRGB=a.srcRGB),a.dstRGB=this.makeConstant(a.dstRGB),"undefined"!=typeof a.dstRGB&&(this._dstRGB=a.dstRGB),a.srcAlpha=this.makeConstant(a.srcAlpha),"undefined"!=typeof a.srcAlpha&&(this._srcAlpha=a.srcAlpha),a.dstAlpha=this.makeConstant(a.dstAlpha),"undefined"!=typeof a.dstAlpha&&(this._dstAlpha=a.dstAlpha),a.modeRGB=this.makeConstant(a.modeRGB),"undefined"!=typeof a.modeRGB&&(this._modeRGB=a.modeRGB),a.modeAlpha=this.makeConstant(a.modeAlpha),"undefined"!=typeof a.modeAlpha&&(this._modeAlpha=a.modeAlpha)),this.dirty=!0},a.prototype.makeConstant=function(a){if("number"==typeof a)return a;switch("string"==typeof a&&(a=a.toUpperCase()),a){case"ZERO":a=this.gl.ZERO;break;case"ONE":a=this.gl.ONE;break;case"SRC_COLOR":case"SRC_COLOUR":a=this.gl.SRC_COLOR;break;case"ONE_MINUS_SRC_COLOR":case"ONE_MINUS_SRC_COLOUR":a=this.gl.ONE_MINUS_SRC_COLOR;break;case"DST_COLOR":case"DST_COLOUR":a=this.gl.DST_COLOR;break;case"ONE_MINUS_DST_COLOR":case"ONE_MINUS_DST_COLOUR":a=this.gl.ONE_MINUS_DST_COLOR;break;case"SRC_ALPHA":a=this.gl.SRC_ALPHA;break;case"ONE_MINUS_SRC_ALPHA":a=this.gl.ONE_MINUS_SRC_ALPHA;break;case"DST_ALPHA":a=this.gl.DST_ALPHA;break;case"ONE_MINUS_DST_ALPHA":a=this.gl.ONE_MINUS_DST_ALPHA;break;case"SRC_ALPHA_SATURATE":a=this.gl.SRC_ALPHA_SATURATE;break;case"CONSTANT_COLOR":case"CONSTANT_COLOUR":a=this.gl.CONSTANT_COLOR;break;case"ONE_MINUS_CONSTANT_COLOR":case"ONE_MINUS_CONSTANT_COLOUR":a=this.gl.ONE_MINUS_CONSTANT_COLOR;break;case"CONSTANT_ALPHA":a=this.gl.CONSTANT_ALPHA;break;case"ONE_MINUS_CONSTANT_ALPHA":a=this.gl.ONE_MINUS_CONSTANT_ALPHA;break;case"FUNC_ADD":a=this.gl.FUNC_ADD;break;case"FUNC_SUBTRACT":a=this.gl.FUNC_SUBTRACT;break;case"FUNC_REVERSE_SUBTRACT":a=this.gl.FUNC_REVERSE_SUBTRACT;break;default:a=void 0}return a},a.prototype.setMode=function(a){switch(a=a.toUpperCase()){case"ADDITIVE":case"ADD":this._srcRGB=this.gl.SRC_ALPHA,this._dstRGB=this.gl.ONE,this._srcAlpha=this.gl.ONE,this._dstAlpha=this.gl.ONE,this._modeRGB=this.gl.FUNC_ADD,this._modeAlpha=this.gl.FUNC_ADD;break;case"SUBTRACT":case"SUBTRACTIVE":this._srcRGB=this.gl.SRC_ALPHA,this._dstRGB=this.gl.ONE,this._srcAlpha=this.gl.ONE,this._dstAlpha=this.gl.ONE,this._modeRGB=this.gl.FUNC_REVERSE_SUBTRACT,this._modeAlpha=this.gl.FUNC_ADD;break;case"ERASE":case"ERASER":this._srcRGB=this.gl.SRC_ALPHA,this._dstRGB=this.gl.ONE_MINUS_SRC_ALPHA,this._srcAlpha=this.gl.ONE,this._dstAlpha=this.gl.ONE,this._modeRGB=this.gl.FUNC_REVERSE_SUBTRACT,this._modeAlpha=this.gl.FUNC_REVERSE_SUBTRACT;break;case"BLACK":case"BLACKEN":this._srcRGB=this.gl.ZERO,this._dstRGB=this.gl.ONE_MINUS_SRC_ALPHA,this._srcAlpha=this.gl.ONE,this._dstAlpha=this.gl.ONE,this._modeRGB=this.gl.FUNC_ADD,this._modeAlpha=this.gl.FUNC_ADD;break;case"NORMAL":default:this._srcRGB=this.gl.SRC_ALPHA,this._dstRGB=this.gl.ONE_MINUS_SRC_ALPHA,this._srcAlpha=this.gl.ONE,this._dstAlpha=this.gl.ONE,this._modeRGB=this.gl.FUNC_ADD,this._modeAlpha=this.gl.FUNC_ADD}this.dirty=!0},a.prototype.isIdentical=function(a){return this==a?!0:this._srcRGB==a._srcRGB&&this._dstRGB==a._dstRGB&&this._srcAlpha==a._srcAlpha&&this._dstAlpha==a._dstAlpha&&this._modeRGB==a._modeRGB&&this._modeAlpha==a._modeAlpha?!0:!1},a.prototype.apply=function(a){a.blendEquationSeparate(this._modeRGB,this._modeAlpha),a.blendFuncSeparate(this._srcRGB,this._dstRGB,this._srcAlpha,this._dstAlpha),this.dirty=!1},a}();a.GLBlendMode=b}(a.Renderers||(a.Renderers={}));a.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(b,c,d,e){"undefined"==typeof e&&(e=!0),this.indices=d||a.square,this.itemSize=c||1,this.numItems=this.indices.length/this.itemSize,e&&(this.buffer=this.init(b))
}return a.prototype.clear=function(){this.indices=new Array},a.prototype.init=function(a){var b=a.createBuffer();return a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),a.STATIC_DRAW),b},a.prototype.refresh=function(a){return this.numItems=this.indices.length/this.itemSize,a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.buffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),a.STATIC_DRAW),this.buffer},a.square=[0,1,2,0,2,3],a}();a.GLElementArrayBuffer=b}(a.Renderers||(a.Renderers={}));a.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(b,c,d){"undefined"==typeof d&&(d=!1),this.loaded=!1,this._isBatchRenderer=!1,this.shaderManager=c,this._isBatchRenderer=d,this.loaded=!0,this.blendMode=new a.Renderers.GLBlendMode(b,{mode:"NORMAL"})}return b.prototype.enable=function(a,b){"undefined"==typeof b&&(b=null)},b.prototype.disable=function(){},b.prototype.clear=function(){},b.prototype.draw=function(){},b.prototype.updateStageResolution=function(){},b.prototype.updateTextureSize=function(){},Object.defineProperty(b.prototype,"isBatchRenderer",{get:function(){return this._isBatchRenderer},enumerable:!0,configurable:!0}),b.RENDERER_ID="Renderer",b}();b.Renderer=c}(a.Renderers||(a.Renderers={}));a.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(c){function d(a,d,e){"undefined"==typeof e&&(e=null),c.call(this,a,d,!0),this._shaderPairName="TextureAtlasShader",this._maxItems=1e3,this.setShaderPair=function(a){"string"==typeof a&&(this._shaderPairName=a)};var f=5;this._vertexBuffer=new b.GLArrayBuffer(a,f);var g=6;this._indexBuffer=new b.GLElementArrayBuffer(a,1,this._generateIndices(this._maxItems*g)),this.shaderPair=this.shaderManager.requestShader(a,this._shaderPairName)}return __extends(d,c),d.prototype.enable=function(a,b){"undefined"==typeof b&&(b=null),this.shaderPair=this.shaderManager.requestShader(a,this._shaderPairName,!0),a.uniform1i(this.shaderPair.uniforms.uSampler.location,0),a.uniform2fv(this.shaderPair.uniforms.uResolution.location,b.stageResolution),a.uniformMatrix3fv(this.shaderPair.uniforms.uCamMatrix.location,!1,b.camMatrix)},d.prototype.disable=function(a){a.disableVertexAttribArray(this.shaderPair.attributes.aXYUV),a.disableVertexAttribArray(this.shaderPair.attributes.aAlpha)},d.prototype.clear=function(a,b){this._vertexBuffer.clear(),a.uniformMatrix3fv(this.shaderPair.uniforms.uCamMatrix.location,!1,b.camMatrix)},d.prototype.draw=function(a){this._vertexBuffer.uploadBuffer(a,this._vertexBuffer.items),a.enableVertexAttribArray(this.shaderPair.attributes.aXYUV),a.vertexAttribPointer(this.shaderPair.attributes.aXYUV,4,a.FLOAT,!1,20,0),a.enableVertexAttribArray(this.shaderPair.attributes.aAlpha),a.vertexAttribPointer(this.shaderPair.attributes.aAlpha,1,a.FLOAT,!1,20,16),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._indexBuffer.buffer),a.drawElements(a.TRIANGLES,this._vertexBuffer.items.length/20*6,a.UNSIGNED_SHORT,0)},d.prototype._generateIndices=function(a){for(var b=new Array,c=0;a>c;c++)b.push(4*c+0,4*c+1,4*c+2,4*c+0,4*c+2,4*c+3);return b},d.prototype.updateStageResolution=function(a,b){a.uniform2fv(this.shaderPair.uniforms.uResolution.location,b)},d.prototype.updateTextureSize=function(a,b){a.uniform2fv(this.shaderPair.uniforms.uTextureSize.location,b)},d.prototype.addToBatch=function(b,c){if(!(c.alpha<=0)){var d=c.transform,e=d.getConcatenatedMatrix(),f=c.atlas.cells[c.cellIndex],g=new a.Geom.Point(0-d.rotPointX,0-d.rotPointY),h=new a.Geom.Point(f.w-d.rotPointX,0-d.rotPointY),i=new a.Geom.Point(f.w-d.rotPointX,f.h-d.rotPointY),j=new a.Geom.Point(0-d.rotPointX,f.h-d.rotPointY);g=e.transformPoint(g),h=e.transformPoint(h),i=e.transformPoint(i),j=e.transformPoint(j),this._vertexBuffer.items.push(g.x,g.y,f.x,f.y,c.alpha,h.x,h.y,f.x+f.w,f.y,c.alpha,i.x,i.y,f.x+f.w,f.y+f.h,c.alpha,j.x,j.y,f.x,f.y+f.h,c.alpha)}},d.prototype.concatBatch=function(a){this._vertexBuffer.items=this._vertexBuffer.items.concat(a)},d.RENDERER_ID="TextureAtlasRenderer",d}(b.Renderer);b.TextureAtlasRenderer=c}(a.Renderers||(a.Renderers={}));a.Renderers}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(){this.loaded=!1}return a.prototype.init=function(a){this.vertShader=this.compile(a,this.vertSource.join("\n"),a.VERTEX_SHADER),this.fragShader=this.compile(a,this.fragSource.join("\n"),a.FRAGMENT_SHADER),this.shaderProgram=this.attach(a,this.vertShader,this.fragShader),this.loaded=!0},a.prototype.attach=function(a,b,c){var d=a.createProgram();return a.attachShader(d,c),a.attachShader(d,b),a.linkProgram(d),d},a.prototype.compile=function(a,b,c){var d=a.createShader(c);return a.shaderSource(d,b),a.compileShader(d),a.getShaderParameter(d,a.COMPILE_STATUS)?d:null},a.prototype.setParam=function(a,b){this.uniforms[a].value=b,this.uniforms[a].dirty=!0},a.prototype.applyUniforms=function(a){for(var b in this.uniforms)this.applyUniform(a,b)},a.prototype.applyUniform=function(a,b){var c=this.uniforms[b];this.uniforms[b].dirty&&(console.log(b),a["uniform"+c.type](c.location,c.value),this.uniforms[b].dirty=!1)},a.prototype.initUniforms=function(a){for(var b in this.uniforms){var c=this.uniforms[b];c.location=a.getUniformLocation(this.shaderProgram,b),c.dirty=!0,c.value=null}},a.RENDERER_ID="ShaderPair",a}();a.ShaderPair=b}(a.Shaders||(a.Shaders={}));a.Shaders}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(a){function b(){a.call(this),this.attributes={aXYUV:null,aAlpha:null},this.uniforms={uCamMatrix:{type:"mat3"},uResolution:{type:"2fv"},uTextureSize:{type:"2fv"},uSampler:{type:"1i"}},this.fragSource=["precision mediump float;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor.a *= vAlpha;","}"],this.vertSource=["attribute vec4 aXYUV;","attribute float aAlpha;","uniform mat3 uCamMatrix;","uniform vec2 uResolution;","uniform vec2 uTextureSize;","varying vec2 vTextureCoord;","varying float vAlpha;","void main(void) {","   vec2 pos = (uCamMatrix * vec3(aXYUV.xy,1)).xy; ","   gl_Position = vec4((pos / uResolution * 2.0 - 1.0) * vec2(1, -1), 0, 1);","   vTextureCoord = aXYUV.zw / uTextureSize;","   vAlpha = aAlpha;","}"]}return __extends(b,a),b.prototype.init=function(b){a.prototype.init.call(this,b),this.attributes.aXYUV=b.getAttribLocation(this.shaderProgram,"aXYUV"),this.attributes.aAlpha=b.getAttribLocation(this.shaderProgram,"aAlpha"),this.initUniforms(b)},b}(a.ShaderPair);a.TextureAtlasShader=b}(a.Shaders||(a.Shaders={}));a.Shaders}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a,b,c,d){this._frameIndex=0,this._startTime=null,this._reverse=!1,this._isPlaying=!1,this._onStop=null,this._onPlay=null,this._onUpdate=null,this._onLoop=null,this.name=a,this._sequence=b,this._speed=b.speed,this._loop=b.loop,this._clock=c,this._parent=d}return b.prototype.objType=function(){return"Animation"},Object.defineProperty(b.prototype,"loop",{get:function(){return this._loop},set:function(a){this._loop=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"frameIndex",{get:function(){return this._frameIndex},set:function(a){this._validateFrame(a)&&(this._frameIndex=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"currentCell",{get:function(){return this._sequence.cells[this.frameIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"speed",{get:function(){return this._speed},set:function(a){this._speed=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"reverse",{get:function(){return this._reverse},set:function(a){this._reverse=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isPlaying",{get:function(){return this._isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onStop",{get:function(){return null==this._onStop&&(this._onStop=new a.Signal),this._onStop},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onPlay",{get:function(){return null==this._onPlay&&(this._onPlay=new a.Signal),this._onPlay},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onUpdate",{get:function(){return null==this._onUpdate&&(this._onUpdate=new a.Signal),this._onUpdate},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onLoop",{get:function(){return null==this._onLoop&&(this._onLoop=new a.Signal),this._onLoop},enumerable:!0,configurable:!0}),b.prototype._start=function(a){"undefined"==typeof a&&(a=null),null!==a&&(this.frameIndex=a),this._isPlaying=!0,this._startTime=this._clock.elapsed(),this._tick=this._startTime+this._speed,null!==this._onPlay&&this._onPlay.dispatch()},b.prototype.play=function(){this._frameIndex===this.length-1&&(this.frameIndex=0),this.playAt(this._frameIndex)},b.prototype.playAt=function(a){this._start(a)},b.prototype.pause=function(){this.stop()},b.prototype.resume=function(){null!==this._startTime&&(this._isPlaying=!0)},b.prototype.stop=function(){this._isPlaying&&(this._isPlaying=!1,null!==this._onStop&&this._onStop.dispatch())},b.prototype.nextFrame=function(){this._frameIndex++,this._frameIndex>=this.length&&(this.frameIndex=0)},b.prototype.prevFrame=function(){this._frameIndex--,this._frameIndex<0&&(this.frameIndex=this.length-1)},b.prototype.update=function(){this._isPlaying&&this._clock.elapsed()>=this._tick&&(this._tick=this._clock.elapsed()+this._speed,this._validateFrame(this._frameIndex+(1==this._reverse?-1:1))?(this._frameIndex+=1==this._reverse?-1:1,this._parent.updateCellIndex(),null!==this._onUpdate&&this._onUpdate.dispatch()):this._loop?(this._frameIndex=this._reverse?this.length-1:0,this._parent.updateCellIndex(),null!==this._onLoop&&this._onLoop.dispatch()):this._parent.stop())},b.prototype._validateFrame=function(a){return a<this.length&&a>=0},Object.defineProperty(b.prototype,"length",{get:function(){return this._sequence.cells.length},enumerable:!0,configurable:!0}),b.prototype.destroy=function(){this._isPlaying=!1,delete this._clock,delete this._sequence,delete this._parent,this._onLoop&&this._onLoop.dispose(),this._onStop&&this._onStop.dispose(),this._onPlay&&this._onPlay.dispose(),this._onUpdate&&this._onUpdate.dispose(),delete this._onLoop,delete this._onStop,delete this._onPlay,delete this._onUpdate,delete this.frameIndex,delete this.loop,delete this._reverse,delete this._tick},b}();b.Animation=c}(a.Animations||(a.Animations={}));a.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(a,b,c,d){"undefined"==typeof c&&(c=.1),"undefined"==typeof d&&(d=!0),this.name=a,this.cells=b,this.speed=c,this.loop=d}return a}();a.Sequence=b}(a.Animations||(a.Animations={}));a.Animations}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(a,b,c){this.preventDefault=!1,this.isDown=!1,this.isUp=!0,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.timeDown=0,this.timeUp=0,this.repeats=0,this._manager=a,this.game=this._manager.game,this.keyCode=b,c&&this.update(c)}return a.prototype.objType=function(){return"Key"},Object.defineProperty(a.prototype,"duration",{get:function(){return this.isDown&&(this.timeDown=this.game.time.now()),this.timeDown<this.timeUp?0:this.timeDown-this.timeUp},enumerable:!0,configurable:!0}),a.prototype.update=function(a){this.keyCode=a.keyCode,this.preventDefault&&a.preventDefault(),"keydown"===a.type?(this.altKey=a.altKey,this.ctrlKey=a.ctrlKey,this.shiftKey=a.shiftKey,this.isDown===!0?(this.repeats++,this.timeDown=this.game.time.now()):(this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.now(),this.repeats=0)):"keyup"===a.type&&(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.now())},a.prototype.justPressed=function(a){return"undefined"==typeof a&&(a=this._manager.justPressedRate),this.isDown===!0&&this.timeDown+a>this.game.time.now()?!0:!1},a.prototype.justReleased=function(a){return"undefined"==typeof a&&(a=this._manager.justReleasedRate),this.isUp===!0&&this.timeUp+a>this.game.time.now()?!0:!1},a.prototype.reset=function(){this.isDown=!1,this.isUp=!0,this.timeUp=0,this.timeDown=0,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1},a}();a.Key=b}(a.Input||(a.Input={}));a.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a){this._keys=[],this.justPressedRate=200,this.justReleasedRate=200,this.game=a}return b.prototype.objType=function(){return"Keyboard"},Object.defineProperty(b.prototype,"keys",{get:function(){return this._keys},enumerable:!0,configurable:!0}),b.prototype.boot=function(){this.onKeyUp=new a.Signal,this.onKeyDown=new a.Signal,this.onKeyDownOnce=new a.Signal,this.start()},b.prototype.update=function(){},b.prototype.start=function(){var b=this;this.game.deviceTargetOption===a.TARGET_BROWSER&&(document.body.addEventListener("keydown",function(a){return b._keyPressed(a)},!1),document.body.addEventListener("keyup",function(a){return b._keyReleased(a)},!1))},b.prototype.stop=function(){var b=this;this.game.deviceTargetOption===a.TARGET_BROWSER&&(document.body.removeEventListener("keydown",function(a){return b._keyPressed(a)},!1),document.body.removeEventListener("keyup",function(a){return b._keyReleased(a)},!1))},b.prototype._keyPressed=function(b){this._keys[b.keyCode]?this._keys[b.keyCode].update(b):this._keys[b.keyCode]=new a.Input.Key(this,b.keyCode,b),0==this._keys[b.keyCode].repeats&&this.onKeyDownOnce.dispatch(b.keyCode,this._keys[b.keyCode]),this.onKeyDown.dispatch(b.keyCode,this._keys[b.keyCode])},b.prototype._keyReleased=function(b){this._keys[b.keyCode]?this._keys[b.keyCode].update(b):this._keys[b.keyCode]=new a.Input.Key(this,b.keyCode,b),this.onKeyUp.dispatch(b.keyCode,this._keys[b.keyCode])},b.prototype.addKey=function(b,c){"undefined"==typeof c&&(c=!1);var d=new a.Input.Key(this,b);return d.preventDefault=c,this._keys[b]=d},b.prototype.justPressed=function(a,b){return"undefined"==typeof b&&(b=this.justPressedRate),this._keys[a]?this._keys[a].justPressed(b):!1},b.prototype.justReleased=function(a,b){return"undefined"==typeof b&&(b=this.justReleasedRate),this._keys[a]?this._keys[a].justReleased(b):!1},b.prototype.isDown=function(a){return this._keys[a]?this._keys[a].isDown:!1},b.prototype.isUp=function(a){return this._keys[a]?this._keys[a].isUp:!1},b.prototype.reset=function(){for(var a in this._keys)this._keys[a].reset()},b}();b.Keyboard=c}(a.Input||(a.Input={}));a.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(){}return a.prototype.objType=function(){return"Keycodes"},a.A="A".charCodeAt(0),a.B="B".charCodeAt(0),a.C="C".charCodeAt(0),a.D="D".charCodeAt(0),a.E="E".charCodeAt(0),a.F="F".charCodeAt(0),a.G="G".charCodeAt(0),a.H="H".charCodeAt(0),a.I="I".charCodeAt(0),a.J="J".charCodeAt(0),a.K="K".charCodeAt(0),a.L="L".charCodeAt(0),a.M="M".charCodeAt(0),a.N="N".charCodeAt(0),a.O="O".charCodeAt(0),a.P="P".charCodeAt(0),a.Q="Q".charCodeAt(0),a.R="R".charCodeAt(0),a.S="S".charCodeAt(0),a.T="T".charCodeAt(0),a.U="U".charCodeAt(0),a.V="V".charCodeAt(0),a.W="W".charCodeAt(0),a.X="X".charCodeAt(0),a.Y="Y".charCodeAt(0),a.Z="Z".charCodeAt(0),a.ZERO="0".charCodeAt(0),a.ONE="1".charCodeAt(0),a.TWO="2".charCodeAt(0),a.THREE="3".charCodeAt(0),a.FOUR="4".charCodeAt(0),a.FIVE="5".charCodeAt(0),a.SIX="6".charCodeAt(0),a.SEVEN="7".charCodeAt(0),a.EIGHT="8".charCodeAt(0),a.NINE="9".charCodeAt(0),a.NUMPAD_0=96,a.NUMPAD_1=97,a.NUMPAD_2=98,a.NUMPAD_3=99,a.NUMPAD_4=100,a.NUMPAD_5=101,a.NUMPAD_6=102,a.NUMPAD_7=103,a.NUMPAD_8=104,a.NUMPAD_9=105,a.NUMPAD_MULTIPLY=106,a.NUMPAD_ADD=107,a.NUMPAD_ENTER=108,a.NUMPAD_SUBTRACT=109,a.NUMPAD_DECIMAL=110,a.NUMPAD_DIVIDE=111,a.F1=112,a.F2=113,a.F3=114,a.F4=115,a.F5=116,a.F6=117,a.F7=118,a.F8=119,a.F9=120,a.F10=121,a.F11=122,a.F12=123,a.F13=124,a.F14=125,a.F15=126,a.COLON=186,a.EQUALS=187,a.UNDERSCORE=189,a.QUESTION_MARK=191,a.TILDE=192,a.OPEN_BRACKET=219,a.BACKWARD_SLASH=220,a.CLOSED_BRACKET=221,a.QUOTES=222,a.BACKSPACE=8,a.TAB=9,a.CLEAR=12,a.ENTER=13,a.SHIFT=16,a.CONTROL=17,a.ALT=18,a.CAPS_LOCK=20,a.ESC=27,a.SPACEBAR=32,a.PAGE_UP=33,a.PAGE_DOWN=34,a.END=35,a.HOME=36,a.LEFT=37,a.UP=38,a.RIGHT=39,a.DOWN=40,a.INSERT=45,a.DELETE=46,a.HELP=47,a.NUM_LOCK=144,a}();a.Keycodes=b}(a.Input||(a.Input={}));a.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a){this.game=a}return b.prototype.objType=function(){return"InputManager"},Object.defineProperty(b.prototype,"pointers",{get:function(){return this._pointers},enumerable:!0,configurable:!0}),b.prototype.boot=function(){this._pointers=[],this.mouse=new a.Input.Mouse(this.game),this.mouse.boot(),this.mouse.onDown.add(this._onDownEvent,this),this.mouse.onUp.add(this._onUpEvent,this),this.keyboard=new a.Input.Keyboard(this.game),this.keyboard.boot(),this.touch=new a.Input.Touch(this.game),this.touch.boot(),this.touch.touchDown.add(this._onDownEvent,this),this.touch.touchUp.add(this._onUpEvent,this),this._pointers=this.touch.fingers.slice(),this._pointers.push(this.mouse.cursor),this.isDown=!1,this.position=new a.Geom.Point,this.onDown=new a.Signal,this.onUp=new a.Signal},b.prototype._onDownEvent=function(a,b,c,d,e,f){this.onDown.dispatch(a,b,c,d,e,f)},b.prototype._onUpEvent=function(a,b,c,d,e,f){this.onUp.dispatch(a,b,c,d,e,f)},Object.defineProperty(b.prototype,"onPressed",{get:function(){return this.onDown},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onReleased",{get:function(){return this.onUp},enumerable:!0,configurable:!0}),b.prototype.update=function(){this.mouse.update(),this.keyboard.update(),this.touch.update(),this.touch.touchEnabled?this.position.setTo(this.touch.x,this.touch.y):this.position.setTo(this.mouse.x,this.mouse.y),this.isDown=this.mouse.isDown||this.touch.isDown},b.prototype.reset=function(){this.mouse.reset(),this.keyboard.reset(),this.touch.reset()},Object.defineProperty(b.prototype,"x",{get:function(){return this.position.x},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this.position.y},enumerable:!0,configurable:!0}),b}();b.InputManager=c}(a.Input||(a.Input={}));a.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a){this._domElement=null,this._game=a}return b.prototype.objType=function(){return"Mouse"},Object.defineProperty(b.prototype,"cursor",{get:function(){return this._cursor},enumerable:!0,configurable:!0}),b.prototype.boot=function(){this._domElement=this._game.stage.container,this._cursor=new a.Input.MouseCursor(this._game),this._cursor.active=!0,this._cursor.id=1,this.onDown=new a.Signal,this.onUp=new a.Signal,this.onWheel=new a.Signal,this.start()},Object.defineProperty(b.prototype,"isDown",{get:function(){return this._cursor.isDown},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isUp",{get:function(){return this._cursor.isUp},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"duration",{get:function(){return this._cursor.duration},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"x",{get:function(){return this._cursor.x},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this._cursor.y},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"wheelDeltaX",{get:function(){return this._cursor.wheelDeltaX},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"wheelDeltaY",{get:function(){return this._cursor.wheelDeltaY},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ctrlKey",{get:function(){return this._cursor.ctrlKey},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"shiftKey",{get:function(){return this._cursor.shiftKey},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"altKey",{get:function(){return this._cursor.altKey},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"button",{get:function(){return this._cursor.button},enumerable:!0,configurable:!0}),b.prototype.update=function(){this._cursor.update()},b.prototype.start=function(){var b=this;this._game.deviceTargetOption===a.TARGET_BROWSER?a.DEVICE.ie&&a.DEVICE.ieVersion<9?(this._domElement.attachEvent("onmousedown",function(a){return b.onMouseDown(a)}),this._domElement.attachEvent("onmousemove",function(a){return b.onMouseMove(a)}),this._domElement.attachEvent("onmouseup",function(a){return b.onMouseUp(a)}),this._domElement.attachEvent("onmousewheel",function(a){return b.onMouseWheel(a)})):(this._domElement.addEventListener("mousedown",function(a){return b.onMouseDown(a)},!0),this._domElement.addEventListener("mousemove",function(a){return b.onMouseMove(a)},!0),this._domElement.addEventListener("mouseup",function(a){return b.onMouseUp(a)},!0),this._domElement.addEventListener("mousewheel",function(a){return b.onMouseWheel(a)},!0),this._domElement.addEventListener("DOMMouseScroll",function(a){return b.onMouseWheel(a)},!0)):this._game.deviceTargetOption===a.TARGET_COCOON&&(this._game.stage.canvas.addEventListener("mousedown",function(a){return b.onMouseDown(a)},!0),this._game.stage.canvas.addEventListener("mousemove",function(a){return b.onMouseMove(a)},!0),this._game.stage.canvas.addEventListener("mouseup",function(a){return b.onMouseUp(a)},!0),this._game.stage.canvas.addEventListener("mousewheel",function(a){return b.onMouseWheel(a)},!0),this._game.stage.canvas.addEventListener("DOMMouseScroll",function(a){return b.onMouseWheel(a)},!0))},b.prototype.stop=function(){var b=this;this._game.deviceTargetOption===a.TARGET_BROWSER&&(this._domElement.removeEventListener("mousedown",function(a){return b.onMouseDown(a)},!1),this._domElement.removeEventListener("mousedown",this.onMouseDown,!1),this._domElement.removeEventListener("mousemove",this.onMouseMove,!1),this._domElement.removeEventListener("mouseup",this.onMouseUp,!1),this._domElement.removeEventListener("mousewheel",this.onMouseWheel,!1),this._domElement.removeEventListener("DOMMouseScroll",this.onMouseWheel,!1))},b.prototype.onMouseDown=function(a){this._cursor.start(a),this.onDown.dispatch(this._cursor.x,this._cursor.y,this._cursor.timeDown,this._cursor.timeUp,this.duration,this._cursor)},b.prototype.onMouseMove=function(a){this._cursor.move(a)},b.prototype.onMouseUp=function(a){this._cursor.stop(a),this.onUp.dispatch(this._cursor.x,this._cursor.y,this._cursor.timeDown,this._cursor.timeUp,this.duration,this._cursor)},b.prototype.onMouseWheel=function(a){this._cursor.wheel(a),this.onWheel.dispatch(this._cursor.wheelDeltaX,this._cursor.wheelDeltaY,this._cursor)},b.prototype.justPressed=function(a){return"undefined"==typeof a&&(a=this._cursor.justPressedRate),this._cursor.justPressed(a)},b.prototype.justReleased=function(a){return"undefined"==typeof a&&(a=this._cursor.justReleasedRate),this._cursor.justReleased(a)},b.prototype.reset=function(){this._cursor.reset()},b.LEFT_BUTTON=0,b.MIDDLE_BUTTON=1,b.RIGHT_BUTTON=2,b}();b.Mouse=c}(a.Input||(a.Input={}));a.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a){this._domElement=null,this.isDown=!1,this.isUp=!0,this._maxPointers=10,this._game=a}return b.prototype.objType=function(){return"TouchManager"},Object.defineProperty(b.prototype,"fingers",{get:function(){return this._fingers},enumerable:!0,configurable:!0}),b.prototype.boot=function(){this._domElement=this._game.stage.container,this.finger1=new a.Input.Finger(this._game),this.finger2=new a.Input.Finger(this._game),this.finger3=new a.Input.Finger(this._game),this.finger4=new a.Input.Finger(this._game),this.finger5=new a.Input.Finger(this._game),this.finger6=new a.Input.Finger(this._game),this.finger7=new a.Input.Finger(this._game),this.finger8=new a.Input.Finger(this._game),this.finger9=new a.Input.Finger(this._game),this.finger10=new a.Input.Finger(this._game),this._fingers=[this.finger1,this.finger2,this.finger3,this.finger4,this.finger5,this.finger6,this.finger7,this.finger8,this.finger9,this.finger10],this.latestFinger=this.finger1,this.touchDown=new a.Signal,this.touchUp=new a.Signal,this.touchCancel=new a.Signal,this.start()},b.prototype.start=function(){var b=this;if(a.DEVICE.touch)if(this.touchEnabled=!0,this._game.deviceTargetOption===a.TARGET_BROWSER)if(a.DEVICE.pointerEnabled){var c="pointerup",d="pointerdown",e="pointerenter",f="pointerleave",g="pointercancel",h="pointermove";if(window.navigator.msPointerEnabled)var c="MSPointerUp",d="MSPointerDown",e="MSPointerEnter",f="MSPointerLeave",g="MSPointerCancel",h="MSPointerMove";this._domElement.addEventListener(c,function(a){return b.onPointerStart(a)},!1),this._domElement.addEventListener(d,function(a){return b.onPointerEnd(a)},!1),this._domElement.addEventListener(e,function(a){return b.onPointerEnter(a)},!1),this._domElement.addEventListener(f,function(a){return b.onPointerLeave(a)},!1),this._domElement.addEventListener(g,function(a){return b.onPointerCancel(a)},!1),this._domElement.addEventListener(h,function(a){return b.onPointerMove(a)},!1)}else this._domElement.addEventListener("touchstart",function(a){return b.onTouchStart(a)},!1),this._domElement.addEventListener("touchmove",function(a){return b.onTouchMove(a)},!1),this._domElement.addEventListener("touchend",function(a){return b.onTouchEnd(a)},!1),this._domElement.addEventListener("touchenter",function(a){return b.onTouchEnter(a)},!1),this._domElement.addEventListener("touchleave",function(a){return b.onTouchLeave(a)},!1),this._domElement.addEventListener("touchcancel",function(a){return b.onTouchCancel(a)},!1),document.addEventListener("touchmove",function(a){return b.consumeTouchMove(a)},!1);else this._game.deviceTargetOption===a.TARGET_COCOON&&(this._game.stage.canvas.addEventListener("touchstart",function(a){return b.onTouchStart(a)},!1),this._game.stage.canvas.addEventListener("touchmove",function(a){return b.onTouchMove(a)},!1),this._game.stage.canvas.addEventListener("touchend",function(a){return b.onTouchEnd(a)},!1),this._game.stage.canvas.addEventListener("touchenter",function(a){return b.onTouchEnter(a)},!1),this._game.stage.canvas.addEventListener("touchleave",function(a){return b.onTouchLeave(a)},!1),this._game.stage.canvas.addEventListener("touchcancel",function(a){return b.onTouchCancel(a)},!1));else this.touchEnabled=!1},b.prototype.consumeTouchMove=function(a){a.preventDefault()},Object.defineProperty(b.prototype,"x",{get:function(){return this.latestFinger.x},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this.latestFinger.y},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"maximumPointers",{get:function(){return this._maxPointers},set:function(a){0>a&&(a=1),a>this._fingers.length&&(a=this._fingers.length),this._maxPointers=a},enumerable:!0,configurable:!0}),b.prototype._registerFinger=function(a,b){for(var c=0;c<this._maxPointers;c++)if(this._fingers[c].active===!1){this._fingers[c].id=b,this._fingers[c].start(a),this.latestFinger=this._fingers[c],this.touchDown.dispatch(this._fingers[c].x,this._fingers[c].y,this._fingers[c].timeDown,this._fingers[c].timeUp,this._fingers[c].duration,this._fingers[c]),this.isDown=!0,this.isUp=!1;break}},b.prototype._deregisterFinger=function(a,b){for(var c=null,d=0;d<this._fingers.length;d++)if(this._fingers[d].active&&this._fingers[d].id===b){this._fingers[d].stop(a),this.latestFinger=this._fingers[d],c=this._fingers[d],this.isDown=!1,this.isUp=!0;break}for(var e=0;e<this._fingers.length;e++)this._fingers[e].active===!0&&(this.isDown=!0,this.isUp=!1);null!==c&&this.touchUp.dispatch(c.x,c.y,c.timeDown,c.timeUp,c.duration,c),console.log("Down?"+this.isDown)},b.prototype._cancelFinger=function(a,b){for(var c=0;c<this._fingers.length;c++)if(this._fingers[c].active&&this._fingers[c].id===b){this._fingers[c].stop(a),this.touchCancel.dispatch(this._fingers[c].x,this._fingers[c].y,this._fingers[c].timeDown,this._fingers[c].timeUp,this._fingers[c].duration,this._fingers[c]);break}for(var d=0;d<this._fingers.length;d++)this._fingers[d].active&&(this.isDown=!0,this.isUp=!1)},b.prototype._enterFinger=function(a,b){for(var c=0;c<this._maxPointers;c++)if(this._fingers[c].active===!1){this._fingers[c].id=b,this._fingers[c].start(a),this.latestFinger=this._fingers[c],this.isDown=!0,this.isUp=!1;break}},b.prototype._leaveFinger=function(a,b){for(var c=0;c<this._fingers.length;c++)if(this._fingers[c].active&&this._fingers[c].id===b){this._fingers[c].leave(a);break}},b.prototype._moveFinger=function(a,b){for(var c=0;c<this._fingers.length;c++)if(this._fingers[c].active&&this._fingers[c].id===b){this._fingers[c].move(a),this.latestFinger=this._fingers[c];break}},b.prototype.onTouchStart=function(a){for(var b=0;b<a.changedTouches.length;b++)this._registerFinger(a.changedTouches[b],a.changedTouches[b].identifier)},b.prototype.onTouchCancel=function(a){for(var b=0;b<a.changedTouches.length;b++)this._cancelFinger(a.changedTouches[b],a.changedTouches[b].identifier)},b.prototype.onTouchEnter=function(a){for(var b=0;b<a.changedTouches.length;b++)this._enterFinger(a.changedTouches[b],a.changedTouches[b].identifier)},b.prototype.onTouchLeave=function(a){for(var b=0;b<a.changedTouches.length;b++)this._leaveFinger(a.changedTouches[b],a.changedTouches[b].identifier)},b.prototype.onTouchMove=function(a){for(var b=0;b<a.changedTouches.length;b++)this._moveFinger(a.changedTouches[b],a.changedTouches[b].identifier)},b.prototype.onTouchEnd=function(a){for(var b=0;b<a.changedTouches.length;b++)this._deregisterFinger(a.changedTouches[b],a.changedTouches[b].identifier)},b.prototype.onPointerStart=function(a){"touch"===a.type&&this._registerFinger(a,a.pointerId)},b.prototype.onPointerCancel=function(a){"touch"===a.type&&this._cancelFinger(a,a.pointerId)},b.prototype.onPointerEnter=function(a){"touch"===a.type&&this._enterFinger(a,a.pointerId)},b.prototype.onPointerLeave=function(a){"touch"===a.type&&this._leaveFinger(a,a.pointerId)},b.prototype.onPointerMove=function(a){"touch"===a.type&&this._moveFinger(a,a.pointerId)},b.prototype.onPointerEnd=function(a){"touch"===a.type&&this._deregisterFinger(a,a.pointerId)},b.prototype.update=function(){if(this.touchEnabled&&this.isDown)for(var a=0;a<this._fingers.length;a++)this._fingers[a].active&&this._fingers[a].update()},b.prototype.stop=function(){var b=this;this.touchEnabled&&(this._game.deviceTargetOption===a.TARGET_BROWSER?(this._domElement.removeEventListener("touchstart",function(a){return b.onTouchStart(a)},!1),this._domElement.removeEventListener("touchmove",function(a){return b.onTouchMove(a)},!1),this._domElement.removeEventListener("touchend",function(a){return b.onTouchEnd(a)},!1),this._domElement.removeEventListener("touchenter",function(a){return b.onTouchEnter(a)},!1),this._domElement.removeEventListener("touchleave",function(a){return b.onTouchLeave(a)},!1),this._domElement.removeEventListener("touchcancel",function(a){return b.onTouchCancel(a)},!1)):this._game.deviceTargetOption===a.TARGET_COCOON&&(this._game.stage.canvas.removeEventListener("touchstart",function(a){return b.onTouchStart(a)},!1),this._game.stage.canvas.removeEventListener("touchmove",function(a){return b.onTouchMove(a)},!1),this._game.stage.canvas.removeEventListener("touchend",function(a){return b.onTouchEnd(a)},!1),this._game.stage.canvas.removeEventListener("touchenter",function(a){return b.onTouchEnter(a)},!1),this._game.stage.canvas.removeEventListener("touchleave",function(a){return b.onTouchLeave(a)},!1),this._game.stage.canvas.removeEventListener("touchcancel",function(a){return b.onTouchCancel(a)},!1)))},b.prototype.reset=function(){for(var a=0;a<this._fingers.length;a++)this._fingers[a].reset()},b}();b.Touch=c}(a.Input||(a.Input={}));a.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(b){this.x=-1,this.y=-1,this.clientX=-1,this.clientY=-1,this.pageX=-1,this.pageY=-1,this.screenX=-1,this.screenY=-1,this.isDown=!1,this.isUp=!0,this.withinGame=!1,this.active=!1,this.timeDown=0,this.timeUp=0,this.duration=0,this.frameDuration=0,this.justPressedRate=200,this.justReleasedRate=200,this._game=b,this.point=new a.Geom.Point,this.circle=new a.Geom.Circle(0,0,1),this.startPoint=new a.Geom.Point,this.endPoint=new a.Geom.Point
}return b.prototype.objType=function(){return"Pointer"},Object.defineProperty(b.prototype,"game",{get:function(){return this._game},enumerable:!0,configurable:!0}),b.prototype.start=function(a){this.move(a),this.startPoint.setTo(this.x,this.y),this.frameDuration=0,this.withinGame=!0,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.now()},b.prototype.stop=function(){this.withinGame=!1,this.endPoint.setTo(this.x,this.y),this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.now(),this.duration=this.timeUp-this.timeDown},b.prototype.move=function(a){this.clientX=a.clientX,this.clientY=a.clientY,this.pageX=a.pageX,this.pageY=a.pageY,this.screenX=a.screenX,this.screenY=a.screenY,this.x=(this.pageX-this.game.stage.offset.x)*this.game.stage.scaleX,this.y=(this.pageY-this.game.stage.offset.y)*this.game.stage.scaleY,this.point.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,this.duration=this.game.time.now()-this.timeDown},b.prototype.justPressed=function(a){return"undefined"==typeof a&&(a=this.justPressedRate),this.isDown===!0&&this.timeDown+a>this._game.time.now()?!0:!1},b.prototype.justReleased=function(a){return"undefined"==typeof a&&(a=this.justReleasedRate),this.isUp===!0&&this.timeUp+a>this._game.time.now()?!0:!1},b.prototype.reset=function(){this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.duration=0,this.frameDuration=0},b.prototype.update=function(){this.isDown===!0&&(this.frameDuration++,this.duration=this._game.time.now()-this.timeDown)},b}();b.Pointer=c}(a.Input||(a.Input={}));a.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(a){function b(){a.apply(this,arguments),this.wheelDeltaX=0,this.wheelDeltaY=0}return __extends(b,a),b.prototype.objType=function(){return"MouseCursor"},b.prototype.start=function(b){this.ctrlKey=b.ctrlKey,this.shiftKey=b.shiftKey,this.altKey=b.altKey,this.button-b.button,a.prototype.start.call(this,b)},b.prototype.stop=function(b){this.move(b),a.prototype.stop.call(this,b)},b.prototype.wheel=function(a){this.wheelDeltaX=a.wheelDeltaX?a.wheelDeltaX:a.deltaX,this.wheelDeltaY=a.wheelDeltaY?a.wheelDeltaY:a.deltaY},b}(a.Pointer);a.MouseCursor=b}(a.Input||(a.Input={}));a.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(a){function b(b){a.call(this,b),this.circle.diameter=44}return __extends(b,a),b.prototype.objType=function(){return"Finger"},b.prototype.start=function(b){this.active=!0,a.prototype.start.call(this,b)},b.prototype.stop=function(b){this.active=!1,a.prototype.stop.call(this,b)},b.prototype.leave=function(a){this.withinGame=!1,this.move(a)},b.prototype.reset=function(){this.active=!1,a.prototype.reset.call(this)},b}(a.Pointer);a.Finger=b}(a.Input||(a.Input={}));a.Input}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function b(a,b,c,d){this.cx=0,this.cy=0,this.halfWidth=0,this.halfHeight=0,this.cx=a||0,this.cy=b||0,this.halfWidth=c/2||0,this.halfHeight=d/2||0}return b.prototype.objType=function(){return"AABB"},Object.defineProperty(b.prototype,"height",{get:function(){return 2*this.halfHeight},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"width",{get:function(){return 2*this.halfWidth},enumerable:!0,configurable:!0}),b.prototype.draw=function(a){return a.beginPath(),a.moveTo(this.cx-this.halfWidth,this.cy),a.lineTo(this.cx+this.halfWidth,this.cy),a.moveTo(this.cx,this.cy-this.halfHeight),a.lineTo(this.cx,this.cy+this.halfHeight),a.stroke(),this},b.prototype.setPosition=function(a,b){return this.cx=a,this.cy=b,this},b.prototype.setPositionPoint=function(a){return this.cx=a.x,this.cy=a.y,this},b.prototype.toRect=function(){return new a.Rectangle(this.cx-this.halfWidth,this.cy-this.halfHeight,2*this.halfWidth,2*this.halfHeight)},b.prototype.fromRect=function(a){return this.halfWidth=a.width/2,this.halfHeight=a.height/2,this.cx=a.x+this.halfWidth,this.cy=a.y+this.halfHeight,this},b}();a.AABB=b}(a.Geom||(a.Geom={}));a.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function b(a,b,c){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),this._diameter=0,this._radius=0,this.x=0,this.y=0,this.setTo(a,b,c)}return b.prototype.objType=function(){return"Circle"},Object.defineProperty(b.prototype,"diameter",{get:function(){return this._diameter},set:function(a){a>0&&(this._diameter=a,this._radius=.5*a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"radius",{get:function(){return this._radius},set:function(a){a>0&&(this._radius=a,this._diameter=2*a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"circumference",{get:function(){return 2*Math.PI*this._radius},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(a){isNaN(a)||(a<this.y?(this._radius=0,this._diameter=0):this.radius=a-this.y)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"left",{get:function(){return this.x-this._radius},set:function(a){isNaN(a)||(a<this.x?this.radius=this.x-a:(this._radius=0,this._diameter=0))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"right",{get:function(){return this.x+this._radius},set:function(a){a&&!isNaN(a)&&(a>this.x?this.radius=a-this.x:(this._radius=0,this._diameter=0))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"top",{get:function(){return this.y-this._radius},set:function(a){a&&!isNaN(a)&&(a>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"area",{get:function(){return this._radius>0?Math.PI*this._radius*this._radius:0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isEmpty",{get:function(){return this._diameter<=0?!0:!1},enumerable:!0,configurable:!0}),b.prototype.clone=function(a){return"undefined"==typeof a&&(a=new b),a.setTo(this.x,this.y,this._diameter)},b.prototype.copyFrom=function(a){return this.setTo(a.x,a.y,a.diameter)},b.prototype.copyTo=function(a){return a.copyFrom(this)},b.prototype.distanceTo=function(a,b){"undefined"==typeof b&&(b=!1);var c=this.x-a.x,d=this.y-a.y;return b===!0?Math.round(Math.sqrt(c*c+d*d)):Math.sqrt(c*c+d*d)},b.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.diameter===a.diameter?!0:!1},b.prototype.intersects=function(a){return this.distanceTo(a,!1)<this._radius+a._radius?!0:!1},b.prototype.circumferencePoint=function(b,c,d){return"undefined"==typeof c&&(c=!1),"undefined"==typeof d&&(d=new a.Point),c===!0&&(b*=Math.PI/180),d.x=this.x+this._radius*Math.cos(b),d.y=this.y+this._radius*Math.sin(b),d},b.prototype.offset=function(a,b){return isNaN(a)||isNaN(b)||(this.x+=a,this.y+=b),this},b.prototype.offsetPoint=function(a){return this.offset(a.x,a.y)},b.prototype.setTo=function(a,b,c){return this.x=a,this.y=b,this._diameter=c,this._radius=.5*c,this},b.prototype.toString=function(){return"[{Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"},b}();a.Circle=b}(a.Geom||(a.Geom={}));a.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(a,b,c,d){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.setTo(a,b,c,d)}return a.prototype.objType=function(){return"Ray"},a.prototype.clone=function(b){return"undefined"==typeof b&&(b=new a),b.setTo(this.x1,this.y1,this.x2,this.y2)},a.prototype.copyFrom=function(a){return this.setTo(a.x1,a.y1,a.x2,a.y2)},a.prototype.copyTo=function(a){return a.copyFrom(this)},a.prototype.setTo=function(a,b,c,d){return"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),this.x1=a,this.y1=b,this.x2=c,this.y2=d,this},Object.defineProperty(a.prototype,"angle",{get:function(){return Math.atan2(this.y2-this.y1,this.x2-this.x1)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"slope",{get:function(){return(this.y2-this.y1)/(this.x2-this.x1)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"yIntercept",{get:function(){return this.y1-this.slope*this.x1},enumerable:!0,configurable:!0}),a.prototype.isPointOnRay=function(a,b){return(a-this.x1)*(this.y2-this.y1)===(this.x2-this.x1)*(b-this.y1)&&Math.atan2(b-this.y1,a-this.x1)==Math.atan2(this.y2-this.y1,this.x2-this.x1)?!0:!1},a.prototype.toString=function(){return"[{Ray (x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" y2="+this.y2+")}]"},a}();a.Ray=b}(a.Geom||(a.Geom={}));a.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function b(){}return b.prototype.objType=function(){return"Intersect"},b.distance=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))},b.distanceSquared=function(a,b,c,d){return(c-a)*(c-a)+(d-b)*(d-b)},b.lineToLine=function(b,c,d){"undefined"==typeof d&&(d=new a.IntersectResult);var e=(b.x1-b.x2)*(c.y1-c.y2)-(b.y1-b.y2)*(c.x1-c.x2);return 0!==e&&(d.result=!0,d.x=((b.x1*b.y2-b.y1*b.x2)*(c.x1-c.x2)-(b.x1-b.x2)*(c.x1*c.y2-c.y1*c.x2))/e,d.y=((b.x1*b.y2-b.y1*b.x2)*(c.y1-c.y2)-(b.y1-b.y2)*(c.x1*c.y2-c.y1*c.x2))/e),d},b.lineToLineSegment=function(b,c,d){"undefined"==typeof d&&(d=new a.IntersectResult);var e=(b.x1-b.x2)*(c.y1-c.y2)-(b.y1-b.y2)*(c.x1-c.x2);if(0!==e){d.x=((b.x1*b.y2-b.y1*b.x2)*(c.x1-c.x2)-(b.x1-b.x2)*(c.x1*c.y2-c.y1*c.x2))/e,d.y=((b.x1*b.y2-b.y1*b.x2)*(c.y1-c.y2)-(b.y1-b.y2)*(c.x1*c.y2-c.y1*c.x2))/e;var f=Math.max(c.x1,c.x2),g=Math.min(c.x1,c.x2),h=Math.max(c.y1,c.y2),i=Math.min(c.y1,c.y2);((d.x<=f&&d.x>=g)==!0||(d.y<=h&&d.y>=i)==!0)&&(d.result=!0)}return d},b.lineToRawSegment=function(b,c,d,e,f,g){"undefined"==typeof g&&(g=new a.IntersectResult);var h=(b.x1-b.x2)*(d-f)-(b.y1-b.y2)*(c-e);if(0!==h){g.x=((b.x1*b.y2-b.y1*b.x2)*(c-e)-(b.x1-b.x2)*(c*f-d*e))/h,g.y=((b.x1*b.y2-b.y1*b.x2)*(d-f)-(b.y1-b.y2)*(c*f-d*e))/h;var i=Math.max(c,e),j=Math.min(c,e),k=Math.max(d,f),l=Math.min(d,f);((g.x<=i&&g.x>=j)==!0||(g.y<=k&&g.y>=l)==!0)&&(g.result=!0)}return g},b.lineToRay=function(b,c,d){"undefined"==typeof d&&(d=new a.IntersectResult);var e=(b.x1-b.x2)*(c.y1-c.y2)-(b.y1-b.y2)*(c.x1-c.x2);return 0!==e&&(d.x=((b.x1*b.y2-b.y1*b.x2)*(c.x1-c.x2)-(b.x1-b.x2)*(c.x1*c.y2-c.y1*c.x2))/e,d.y=((b.x1*b.y2-b.y1*b.x2)*(c.y1-c.y2)-(b.y1-b.y2)*(c.x1*c.y2-c.y1*c.x2))/e,d.result=!0,!(c.x1>=c.x2)&&d.x<c.x1&&(d.result=!1),!(c.y1>=c.y2)&&d.y<c.y1&&(d.result=!1)),d},b.lineToCircle=function(b,c,d){return"undefined"==typeof d&&(d=new a.IntersectResult),b.perp(c.x,c.y).length<=c.radius&&(d.result=!0),d},b.lineToRectangle=function(c,d,e){return"undefined"==typeof e&&(e=new a.IntersectResult),b.lineToRawSegment(c,d.x,d.y,d.right,d.y,e),e.result===!0?e:(b.lineToRawSegment(c,d.x,d.y,d.x,d.bottom,e),e.result===!0?e:(b.lineToRawSegment(c,d.x,d.bottom,d.right,d.bottom,e),e.result===!0?e:(b.lineToRawSegment(c,d.right,d.y,d.right,d.bottom,e),e)))},b.lineSegmentToLineSegment=function(c,d,e){return"undefined"==typeof e&&(e=new a.IntersectResult),b.lineToLineSegment(c,d,e),e.result===!0&&(e.x>=Math.min(c.x1,c.x2)&&e.x<=Math.max(c.x1,c.x2)&&e.y>=Math.min(c.y1,c.y2)&&e.y<=Math.max(c.y1,c.y2)||(e.result=!1)),e},b.lineSegmentToRay=function(c,d,e){return"undefined"==typeof e&&(e=new a.IntersectResult),b.lineToRay(c,d,e),e.result===!0&&(e.x>=Math.min(c.x1,c.x2)&&e.x<=Math.max(c.x1,c.x2)&&e.y>=Math.min(c.y1,c.y2)&&e.y<=Math.max(c.y1,c.y2)||(e.result=!1)),e},b.lineSegmentToCircle=function(c,d,e){"undefined"==typeof e&&(e=new a.IntersectResult);var f=c.perp(d.x,d.y);if(f.length<=d.radius){var g=Math.max(c.x1,c.x2),h=Math.min(c.x1,c.x2),i=Math.max(c.y1,c.y2),j=Math.min(c.y1,c.y2);f.x2<=g&&f.x2>=h&&f.y2<=i&&f.y2>=j?e.result=!0:(b.circleContainsPoint(d,{x:c.x1,y:c.y1})||b.circleContainsPoint(d,{x:c.x2,y:c.y2}))&&(e.result=!0)}return e},b.lineSegmentToRectangle=function(c,d,e){return"undefined"==typeof e&&(e=new a.IntersectResult),d.contains(c.x1,c.y1)&&d.contains(c.x2,c.y2)?(e.result=!0,e):(b.lineToRawSegment(c,d.x,d.y,d.right,d.bottom,e),e.result===!0?e:(b.lineToRawSegment(c,d.x,d.y,d.x,d.bottom,e),e.result===!0?e:(b.lineToRawSegment(c,d.x,d.bottom,d.right,d.bottom,e),e.result===!0?e:(b.lineToRawSegment(c,d.right,d.y,d.right,d.bottom,e),e))))},b.rayToRectangle=function(c,d,e){return"undefined"==typeof e&&(e=new a.IntersectResult),b.lineToRectangle(c,d,e),e},b.rayToLineSegment=function(b,c,d,e,f,g,h,i,j){"undefined"==typeof j&&(j=new a.IntersectResult);var k,l,m;return(e-c)/(d-b)!=(i-g)/(h-f)&&(m=(d-b)*(i-g)-(e-c)*(h-f),0!=m&&(k=((c-g)*(h-f)-(b-f)*(i-g))/m,l=((c-g)*(d-b)-(b-f)*(e-c))/m,k>=0&&l>=0&&1>=l&&(j.result=!0,j.x=b+k*(d-b),c+k*(e-c)))),j},b.circleToCircle=function(c,d,e){return"undefined"==typeof e&&(e=new a.IntersectResult),e.result=(c.radius+d.radius)*(c.radius+d.radius)>=b.distanceSquared(c.x,c.y,d.x,d.y),e},b.circleToRectangle=function(b,c,d){"undefined"==typeof d&&(d=new a.IntersectResult);var e=c.clone();return e.inflate(b.radius,b.radius),d.result=e.contains(b.x,b.y),d},b.circleContainsPoint=function(c,d,e){return"undefined"==typeof e&&(e=new a.IntersectResult),e.result=c.radius*c.radius>=b.distanceSquared(c.x,c.y,d.x,d.y),e},b.pointToRectangle=function(b,c,d){return"undefined"==typeof d&&(d=new a.IntersectResult),d.setTo(b.x,b.y),d.result=c.containsPoint(b),d},b.rectangleToRectangle=function(b,c,d){"undefined"==typeof d&&(d=new a.IntersectResult);var e=Math.max(b.x,c.x),f=Math.min(b.right,c.right),g=Math.max(b.y,c.y),h=Math.min(b.bottom,c.bottom);d.setTo(e,g,f-e,h-g,f-e,h-g);var i=d.x+.5*d.width,j=d.y+.5*d.height;return i>b.x&&i<b.right&&j>b.y&&j<b.bottom&&(d.result=!0),d},b}();a.Intersect=b}(a.Geom||(a.Geom={}));a.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(){this.result=!1}return a.prototype.objType=function(){return"IntersectResult"},a.prototype.setTo=function(a,b,c,d,e,f){"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=0),this.x=a,this.y=b,this.x1=a,this.y1=b,this.x2=c,this.y2=d,this.width=e,this.height=f},a}();a.IntersectResult=b}(a.Geom||(a.Geom={}));a.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a,b,c,d){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.setTo(a,b,c,d)}return b.prototype.objType=function(){return"Line"},b.prototype.clone=function(a){return"undefined"==typeof a&&(a=new b),a.setTo(this.x1,this.y1,this.x2,this.y2)},b.prototype.copyFrom=function(a){return this.setTo(a.x1,a.y1,a.x2,a.y2)},b.prototype.copyTo=function(a){return a.copyFrom(this)},b.prototype.setTo=function(a,b,c,d){return"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),this.x1=a,this.y1=b,this.x2=c,this.y2=d,this},Object.defineProperty(b.prototype,"length",{get:function(){return Math.sqrt((this.x2-this.x1)*(this.x2-this.x1)+(this.y2-this.y1)*(this.y2-this.y1))},enumerable:!0,configurable:!0}),b.prototype.getY=function(a){return this.x1==this.x2?null:this.slope*a+this.yIntercept},Object.defineProperty(b.prototype,"angle",{get:function(){return Math.atan2(this.y2-this.y1,this.x2-this.x1)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"slope",{get:function(){return(this.y2-this.y1)/(this.x2-this.x1)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"perpSlope",{get:function(){return-((this.x2-this.x1)/(this.y2-this.y1))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"yIntercept",{get:function(){return this.y1-this.slope*this.x1},enumerable:!0,configurable:!0}),b.prototype.isPointOnLine=function(a,b){return(a-this.x1)*(this.y2-this.y1)===(this.x2-this.x1)*(b-this.y1)?!0:!1},b.prototype.isPointOnLineSegment=function(a,b){var c=Math.min(this.x1,this.x2),d=Math.max(this.x1,this.x2),e=Math.min(this.y1,this.y2),f=Math.max(this.y1,this.y2);return this.isPointOnLine(a,b)&&a>=c&&d>=a&&b>=e&&f>=b?!0:!1},b.prototype.intersectLineLine=function(b){return a.Geom.Intersect.lineToLine(this,b)},b.prototype.perp=function(a,c,d){if(this.y1===this.y2){if(!d)return new b(a,c,a,this.y1);d.setTo(a,c,a,this.y1)}var e=c-this.perpSlope*a,f=this.intersectLineLine({x1:a,y1:c,x2:0,y2:e});return d?void d.setTo(a,c,f.x,f.y):new b(a,c,f.x,f.y)},b.prototype.toString=function(){return"[{Line (x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" y2="+this.y2+")}]"},b}();b.Line=c}(a.Geom||(a.Geom={}));a.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a,b,c,d,e,f){"undefined"==typeof a&&(a=1),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=1),"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=0),this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this.setTo(a,b,c,d,e,f)}return b.prototype.objType=function(){return"Matrix"},b.prototype.setTo=function(a,b,c,d,e,f){return"undefined"==typeof a&&(a=1),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=1),"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=0),this.a=a,this.b=b,this.c=c,this.d=d,this.tx=e,this.ty=f,this},b.prototype.setFromTransform=function(a,b,c,d,e){this.identity();var f=Math.cos(e),g=Math.sin(e);return this.append(f*c,g*c,-g*d,f*d,a,b),this},b.prototype.setFromOffsetTransform=function(a,b,c,d,e,f,g){this.identity();var h=Math.cos(e),i=Math.sin(e);return this.append(h*c,i*c,-i*d,h*d,a+f,b+g),this},b.prototype.prepend=function(a,b,c,d,e,f){"undefined"==typeof a&&(a=1),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=1),"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=0);var g=this.tx,h=this.a,i=this.c;return this.a=h*a+this.b*c,this.b=h*b+this.b*d,this.c=i*a+this.d*c,this.d=i*b+this.d*d,this.tx=g*a+this.ty*c+e,this.ty=g*b+this.ty*d+f,this},b.prototype.prependMatrix=function(a){var b=this.tx,c=this.a,d=this.c;return this.a=c*a.a+this.b*a.c,this.b=c*a.b+this.b*a.d,this.c=d*a.a+this.d*a.c,this.d=d*a.b+this.d*a.d,this.tx=b*a.a+this.ty*a.c+a.tx,this.ty=b*a.b+this.ty*a.d+a.ty,this},b.prototype.append=function(a,b,c,d,e,f){"undefined"==typeof a&&(a=1),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=1),"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=0);var g=this.a,h=this.b,i=this.c,j=this.d;return this.a=a*g+b*i,this.b=a*h+b*j,this.c=c*g+d*i,this.d=c*h+d*j,this.tx=e*g+f*i+this.tx,this.ty=e*h+f*j+this.ty,this},b.prototype.appendMatrix=function(a){var b=this.a,c=this.b,d=this.c,e=this.d;return this.a=a.a*b+a.b*d,this.b=a.a*c+a.b*e,this.c=a.c*b+a.d*d,this.d=a.c*c+a.d*e,this.tx=a.tx*b+a.ty*d+this.tx,this.ty=a.tx*c+a.ty*e+this.ty,this},b.prototype.setPosition=function(a,b){return this.tx=a,this.ty=b,this},b.prototype.setPositionPoint=function(a){return this.tx=a.x,this.ty=a.y,this},b.prototype.getPosition=function(b){return"undefined"==typeof b&&(b=new a.Geom.Point),b.setTo(this.tx,this.ty)},b.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},b.prototype.rotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=this.a,e=this.c,f=this.tx;return this.a=d*b-this.b*c,this.b=d*c+this.b*b,this.c=e*b-this.d*c,this.d=e*c+this.d*b,this.tx=f*b-this.ty*c,this.ty=f*c+this.ty*b,this},b.prototype.translate=function(a,b){return this.tx+=a,this.ty+=b,this},b.prototype.scale=function(a,b){return this.a*=a,this.d*=b,this},b.prototype.transformPoint=function(a){var b=a.x,c=a.y;return a.x=this.a*b+this.c*c+this.tx,a.y=this.b*b+this.d*c+this.ty,a},b.prototype.invert=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=a*d-b*c;return this.a=d/f,this.b=-b/f,this.c=-c/f,this.d=a/f,this.tx=(c*this.ty-d*e)/f,this.ty=-(a*this.ty-b*e)/f,this},b.prototype.copyFrom=function(a){return this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d,this.tx=a.tx,this.ty=a.ty,this},b.prototype.copyTo=function(a){return a.a=this.a,a.b=this.b,a.c=this.c,a.d=this.d,a.tx=this.tx,a.ty=this.ty,this},b.prototype.clone=function(){return new a.Geom.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)},Object.defineProperty(b.prototype,"toString",{get:function(){return"[{Matrix (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")}]"},enumerable:!0,configurable:!0}),b}();b.Matrix=c}(a.Geom||(a.Geom={}));a.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(a,b){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),this.setTo(a,b)}return a.prototype.objType=function(){return"Point"},a.prototype.polar=function(a,b){return this.x=a*Math.cos(b*Math.PI/180),this.y=a*Math.sin(b*Math.PI/180),this},a.prototype.add=function(b,c){return"undefined"==typeof c&&(c=new a),c.setTo(this.x+b.x,this.y+b.y)},a.prototype.addTo=function(a,b){return"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),this.setTo(this.x+a,this.y+b)},a.prototype.subtractFrom=function(a,b){return"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),this.setTo(this.x-a,this.y-b)},a.prototype.invert=function(){return this.setTo(this.y,this.x)},a.prototype.clamp=function(a,b){return this.clampX(a,b),this.clampY(a,b),this},a.prototype.clampX=function(a,b){return this.x=Math.max(Math.min(this.x,b),a),this},a.prototype.clampY=function(a,b){return this.x=Math.max(Math.min(this.x,b),a),this.y=Math.max(Math.min(this.y,b),a),this},a.prototype.clone=function(b){return"undefined"==typeof b&&(b=new a),b.setTo(this.x,this.y)},a.prototype.copyFrom=function(a){return this.setTo(a.x,a.y)},a.prototype.copyTo=function(a){return a.setTo(this.x,this.y)},a.prototype.angleTo=function(a){return Math.atan2(a.x-this.x,a.y-this.y)},a.prototype.angleToXY=function(a,b){return Math.atan2(a-this.x,b-this.y)},a.prototype.distanceTo=function(a,b){"undefined"==typeof b&&(b=!1);var c=this.x-a.x,d=this.y-a.y;return b===!0?Math.round(Math.sqrt(c*c+d*d)):Math.sqrt(c*c+d*d)},a.prototype.distanceToXY=function(a,b,c){"undefined"==typeof c&&(c=!1);var d=this.x-a,e=this.y-b;return c===!0?Math.round(Math.sqrt(d*d+e*e)):Math.sqrt(d*d+e*e)},a.distanceBetween=function(a,b,c){"undefined"==typeof c&&(c=!1);var d=a.x-b.x,e=a.y-b.y;return c===!0?Math.round(Math.sqrt(d*d+e*e)):Math.sqrt(d*d+e*e)},a.polar=function(b,c){return new a(b*Math.cos(c*Math.PI/180),b*Math.sin(c*Math.PI/180))},a.prototype.distanceCompare=function(a,b){return this.distanceTo(a)>=b?!0:!1},a.prototype.equals=function(a){return this.x===a.x&&this.y===a.y?!0:!1},a.interpolate=function(b,c,d){var e=c.x-b.x,f=c.y-b.y;return new a(c.x-e*d,c.y-f*d)},a.prototype.offset=function(a,b){return this.x+=a,this.y+=b,this},a.prototype.setTo=function(a,b){return this.x=a,this.y=b,this},a.prototype.subtract=function(b,c){return"undefined"==typeof c&&(c=new a),c.setTo(this.x-b.x,this.y-b.y)},a.prototype.getCSS=function(){return this.x+"px "+this.y+"px"},a.prototype.toString=function(){return"[{Point (x="+this.x+" y="+this.y+")}]"},a}();a.Point=b}(a.Geom||(a.Geom={}));a.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function c(a,b,c,d){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),this.x=0,this.y=0,this.width=0,this.height=0,this.setTo(a,b,c,d)}return c.prototype.objType=function(){return"Rectangle"},Object.defineProperty(c.prototype,"bottom",{get:function(){return this.y+this.height},set:function(a){a&&(this.height=a<this.y?0:a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"center",{get:function(){var a=new b.Point;return a.setTo(Math.round(this.width/2),Math.round(this.height/2))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"bottomRight",{get:function(){var a=new b.Point;return a.setTo(this.right,this.bottom)},set:function(a){a&&(this.right=a.x,this.bottom=a.y)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"left",{get:function(){return this.x},set:function(a){if(a){var b=this.x-a;this.width+b<0?(this.width=0,this.x=a):(this.width+=b,this.x=a)}},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"right",{get:function(){return this.x+this.width},set:function(a){a&&(this.width=a<this.x?0:a-this.x)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"size",{get:function(){var a=new b.Point;return a.setTo(this.width,this.height)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"volume",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"top",{get:function(){return this.y},set:function(a){if(a){var b=this.y-a;this.height+b<0?(this.height=0,this.y=a):(this.height+=b,this.y=a)}},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"topLeft",{get:function(){var a=new b.Point;return a.setTo(this.x,this.y)},set:function(a){a&&(this.x=a.x,this.y=a.y)},enumerable:!0,configurable:!0}),c.prototype.clone=function(a){return"undefined"==typeof a&&(a=new c),a.setTo(this.x,this.y,this.width,this.height)},c.prototype.contains=function(a,b){return a>=this.x&&a<=this.right&&b>=this.y&&b<=this.bottom?!0:!1},c.prototype.containsPoint=function(a){return this.contains(a.x,a.y)},c.prototype.containsRect=function(a){return a.volume>this.volume?!1:a.x>=this.x&&a.y>=this.y&&a.right<=this.right&&a.bottom<=this.bottom?!0:!1},c.prototype.copyFrom=function(a){return this.setTo(a.x,a.y,a.width,a.height)},c.prototype.copyTo=function(a){return"undefined"==typeof a&&(a=new c),a.copyFrom(this)},c.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height?!0:!1},c.prototype.inflate=function(a,b){return isNaN(a)||isNaN(b)||(this.x-=a,this.width+=2*a,this.y-=b,this.height+=2*b),this},c.prototype.inflatePoint=function(a){return this.inflate(a.x,a.y)},c.prototype.intersection=function(a,b){return"undefined"==typeof b&&(b=new c),this.intersects(a)===!0&&(b.x=Math.max(a.x,this.x),b.y=Math.max(a.y,this.y),b.width=Math.min(a.right,this.right)-b.x,b.height=Math.min(a.bottom,this.bottom)-b.y),b},c.prototype.intersects=function(a){return a.x>this.right-1?!1:a.right-1<this.x?!1:a.bottom-1<this.y?!1:a.y>this.bottom-1?!1:!0},c.prototype.overlap=function(a){var b={top:!1,bottom:!1,left:!1,right:!1,contains:!1,contained:!1},c=this.intersection(a);return c.isEmpty?b:(this.containsRect(a)&&(b.contains=!0),a.containsRect(this)&&(b.contained=!0),this.top<a.top&&(b.top=!0),this.bottom>a.bottom&&(b.bottom=!0),this.left<a.left&&(b.left=!0),this.right>a.right&&(b.right=!0),b)},c.prototype.isEmpty=function(){return this.width<1||this.height<1?!0:!1},c.prototype.offset=function(a,b){return isNaN(a)||isNaN(b)||(this.x+=a,this.y+=b),this},c.prototype.offsetPoint=function(a){return this.offset(a.x,a.y)},c.prototype.setEmpty=function(){return this.setTo(0,0,0,0)},c.prototype.setTo=function(a,b,c,d){return isNaN(a)||isNaN(b)||isNaN(c)||isNaN(d)||(this.x=a,this.y=b,c>=0&&(this.width=c),d>=0&&(this.height=d)),this},c.prototype.union=function(a,b){return"undefined"==typeof b&&(b=new c),b.setTo(Math.min(a.x,this.x),Math.min(a.y,this.y),Math.max(a.right,this.right),Math.max(a.bottom,this.bottom))},c.prototype.scale=function(b,c,d){var e=new a.Geom.Transform;e.scaleX=b,e.scaleY=c,e.x=d.x,e.y=d.y;var f=this.topLeft;return e.transformPoint(f),this.topLeft=f,this.width*=b,this.height*=c,this},c.prototype.toString=function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" isEmpty="+this.isEmpty()+")}]"},c}();b.Rectangle=c}(a.Geom||(a.Geom={}));a.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function c(a,c,d,e,f,g,h){"undefined"==typeof a&&(a=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=1),"undefined"==typeof e&&(e=1),"undefined"==typeof f&&(f=0),"undefined"==typeof g&&(g=0),"undefined"==typeof h&&(h=0),this._x=0,this._y=0,this._scaleX=1,this._scaleY=1,this._rotation=0,this._rotPointX=0,this._rotPointY=0,this.setTransform(a,c,d,e,f,g,h),this._matrix=new b.Matrix,this._matrix.setFromOffsetTransform(this._x,this._y,this._scaleX,this._scaleY,this._rotation,this._rotPointX,this._rotPointY),this._cachedConcatenatedMatrix=this.getConcatenatedMatrix()}return c.prototype.objType=function(){return"Transform"},Object.defineProperty(c.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scaleX",{get:function(){return this._scaleX},set:function(a){this._scaleX=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scaleY",{get:function(){return this._scaleY},set:function(a){this._scaleY=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotation",{get:function(){return this._rotation},set:function(a){this._rotation=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotPointX",{get:function(){return this._rotPointX},set:function(a){this._rotPointX=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotPointY",{get:function(){return this._rotPointY},set:function(a){this._rotPointY=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"anchorPointX",{get:function(){return this.rotPointX},set:function(a){this.rotPointX=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"anchorPointY",{get:function(){return this._rotPointY},set:function(a){this._rotPointY=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"matrix",{get:function(){return this._matrix},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"worldX",{get:function(){return this.getConcatenatedMatrix().tx-this._rotPointX},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"worldY",{get:function(){return this.getConcatenatedMatrix().ty-this._rotPointY},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"parent",{get:function(){return this._parent},set:function(a){this.checkAncestor(a)||(this._parent=a)},enumerable:!0,configurable:!0}),c.prototype.setPosition=function(a,b){return this._x=a,this._y=b,this},c.prototype.setPositionFromPoint=function(a){return this._x=a.x,this._y=a.y,this},c.prototype.translatePositionFromPoint=function(a){return this._x+=a.x,this._y+=a.y,this},c.prototype.getPositionPoint=function(b){return"undefined"==typeof b&&(b=new a.Geom.Point),b.setTo(this._x,this._y)},Object.defineProperty(c.prototype,"scale",{set:function(a){this._scaleX=a,this._scaleY=a},enumerable:!0,configurable:!0}),c.prototype.setTransform=function(a,b,c,d,e,f,g){return"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=1),"undefined"==typeof d&&(d=1),"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=0),"undefined"==typeof g&&(g=0),this._x=a,this._y=b,this._scaleX=c,this._scaleY=d,this._rotation=e,this._rotPointX=f,this._rotPointY=g,this},c.prototype.getParentMatrix=function(){return this._parent?this._parent.getConcatenatedMatrix():null},c.prototype.getConcatenatedMatrix=function(){this._matrix.setFromOffsetTransform(this._x,this._y,this._scaleX,this._scaleY,this._rotation,this._rotPointX,this._rotPointY);var a=this.getParentMatrix();if(a){var b=this._matrix.clone();return b.prependMatrix(a),this._cachedConcatenatedMatrix.copyFrom(b),b}return this._matrix},c.prototype.transformPoint=function(a){var b=this.getConcatenatedMatrix();return b.transformPoint(a)},c.prototype.copyFrom=function(a){return this.setTransform(a.x,a.y,a.scaleX,a.scaleY,a.rotation,a.rotPointX,a.rotPointY),this.parent=a.parent,this._matrix=a.matrix.clone(),this},c.prototype.copyTo=function(a){return a.copyFrom(this),this},c.prototype.clone=function(a){return"undefined"==typeof a&&(a=new c),a.copyFrom(this),a},c.prototype.checkAncestor=function(){return!1},Object.defineProperty(c.prototype,"toString",{get:function(){return"[{Transform (x="+this._x+" y="+this._y+" scaleX="+this._scaleX+" scaleY="+this._scaleY+" rotation="+this._rotation+" regX="+this._rotPointX+" regY="+this.rotPointY+" matrix="+this._matrix+")}]"
},enumerable:!0,configurable:!0}),c}();b.Transform=c}(a.Geom||(a.Geom={}));a.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function c(a,b){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),this.setTo(a,b)}return c.prototype.objType=function(){return"Vector2"},c.fromAngle=function(a){return new c(Math.cos(a),Math.sin(a))},c.randomRadius=function(a){return new c(2*Math.random()-1,2*Math.random()-1).multiplyScalar(a)},c.fromPoint=function(a){return new c(a.x,a.y)},c.prototype.add=function(a){return new c(this.x+a.x,this.y+a.y)},c.prototype.addX=function(a){return new c(this.x+a.x,this.y)},c.prototype.addY=function(a){return new c(this.x,this.y+a.y)},c.prototype.subtract=function(b){return new a.Geom.Vector2(this.x-b.x,this.y-b.y)},c.prototype.multiply=function(b){return new a.Geom.Vector2(this.x*b.x,this.y*b.y)},c.prototype.multiplyScalar=function(b){return new a.Geom.Vector2(this.x*b,this.y*b)},c.prototype.dot=function(a){return this.x*a.x+this.y*a.y},c.prototype.lenSqr=function(){return this.x*this.x+this.y*this.y},c.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},c.prototype.unit=function(){var a=1/this.len();return this.multiplyScalar(a)},c.prototype.floor=function(){return new c(Math.floor(this.x),Math.floor(this.y))},c.prototype.ceil=function(){return new c(Math.ceil(this.x),Math.ceil(this.y))},c.prototype.round=function(){return new c(Math.round(this.x),Math.round(this.y))},c.prototype.clamp=function(a,b){return new c(Math.max(Math.min(this.x,b.x),a.x),Math.max(Math.min(this.y,b.y),a.y))},c.prototype.perp=function(){return new c(-this.y,this.x)},c.prototype.neg=function(){return new c(-this.x,-this.y)},c.prototype.equal=function(a){return this.x===a.x&&this.y===a.y},c.prototype.point=function(){return new b.Point(this.x,this.y)},c.prototype.clear=function(){return this.x=0,this.y=0,this},c.prototype.clone=function(a){return a?a.setTo(this.x,this.y):new c(this.x,this.y)},c.prototype.copyFrom=function(a){return this.x=a.x,this.y=a.y,this},c.prototype.copyTo=function(a){return a.x=this.x,a.y=this.y,a},c.prototype.setTo=function(a,b){return this.x=a,this.y=b,this},c.prototype.toString=function(){return"[{Vector2 (x="+this.x+" y="+this.y+")}]"},c}();b.Vector2=c}(a.Geom||(a.Geom={}));a.Geom}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(b,c){if(this._game=b,this.name=c,this._manager=this._game.huds,this._device=this._game.deviceTargetOption,this._manager.supported){switch(this._device){case a.TARGET_BROWSER:this.container=document.createElement("div"),this.container.id="HUD-layer-"+b.rnd.uuid(),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="absolute",this._widgets=new Array}this.class="kiwi-display"}}return b.prototype.objType=function(){return"HUDDisplay"},b.prototype.addWidget=function(b){return this._manager.supported&&(this._widgets.push(b),this._device==a.TARGET_BROWSER)?(this.container.appendChild(b.container),!0):!1},b.prototype.removeWidget=function(a){if(this._manager.supported&&this.removeFromContainer(a)){var b=this._widgets.indexOf(a);if(-1!==b)return this._widgets.splice(b,1),!0}return!1},b.prototype.removeAllWidgets=function(){for(var a=0;a<this._widgets.length;a++)this.removeFromContainer(this._widgets[a]);this._widgets=[]},b.prototype.removeFromContainer=function(b){return this._manager.supported&&this._device==a.TARGET_BROWSER&&this.container.contains(b.container)?(this.container.removeChild(b.container),!0):!1},b.prototype.update=function(){for(var a=0;a<this._widgets.length;a++)this._widgets[a].update()},b.prototype.show=function(){this.container.style.display="block"},b.prototype.hide=function(){this.container.style.display="none"},Object.defineProperty(b.prototype,"class",{get:function(){return this._device==a.TARGET_BROWSER?this.container.className:void 0},set:function(b){this._device==a.TARGET_BROWSER&&(this.container.className=b)},enumerable:!0,configurable:!0}),b}();b.HUDDisplay=c}(a.HUD||(a.HUD={}));a.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a){this._game=a,this._device=this._game.deviceTargetOption}return Object.defineProperty(b.prototype,"supported",{get:function(){return this._supported},enumerable:!0,configurable:!0}),b.prototype.boot=function(){this._device===a.TARGET_BROWSER?(this._supported=!0,this._hudContainer=document.createElement("div"),this._hudContainer.id="HUDContainer",this._hudContainer.style.position="absolute",this._hudContainer.style.width="100%",this._hudContainer.style.height="100%",this._hudContainer.style.top="0",this._hudContainer.style.left="0",this._game.stage.container.appendChild(this._hudContainer),this._huds=new Array,this._defaultHUD=this.createHUD("defaultHUD"),this._currentHUD=this._defaultHUD,this.setHUD(this._defaultHUD)):this._supported=!1},b.prototype.objType=function(){return"HUDManager"},Object.defineProperty(b.prototype,"defaultHUD",{get:function(){return this._defaultHUD},set:function(a){this._currentHUD===this._defaultHUD&&(this._currentHUD=a,this.setHUD(this._currentHUD)),this._defaultHUD=a},enumerable:!0,configurable:!0}),b.prototype.setHUD=function(a){this.supported&&(this.hideHUD(),this._currentHUD=a,this.showHUD())},b.prototype.showHUD=function(a){"undefined"==typeof a&&(a=this._currentHUD),a.show()},b.prototype.hideHUD=function(a){"undefined"==typeof a&&(a=this._currentHUD),a.hide()},b.prototype.createHUD=function(b,c){if("undefined"==typeof c&&(c=!1),this.supported){var d=new a.HUD.HUDDisplay(this._game,b);return d.hide(),this.addToContainer(d),this._huds.push(d),c===!0&&this.setHUD(d),d}},b.prototype.removeHUD=function(a){if(this.supported){if(a===this._defaultHUD)return!1;this._currentHUD===a&&this.setHUD(this._defaultHUD),this.removeFromContainer(a);var b=this._huds.indexOf(a);return-1!==b&&this._huds.splice(b,1),!0}},b.prototype.addToContainer=function(b){this._device==a.TARGET_BROWSER&&this._hudContainer.appendChild(b.container)},b.prototype.removeFromContainer=function(b){this._device==a.TARGET_BROWSER&&this._hudContainer.contains(b.container)&&this._hudContainer.removeChild(b.container)},b.prototype.update=function(){if(this._supported)for(var a=0;a<this._huds.length;a++)this._huds[a].update()},b}();b.HUDManager=c}(a.HUD||(a.HUD={}));a.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(b,c,d,e){this.name=c,this.game=b,this._manager=this.game.huds,this._device=this.game.deviceTargetOption,this.components=new a.ComponentManager(a.HUD_WIDGET,this),this._manager.supported&&(this._device===a.TARGET_BROWSER&&(this.container=document.createElement("div"),this.container.id="HUD-widget-"+this.game.rnd.uuid(),this.container.className="HUD-widget",this.container.style.position="absolute"),this.onCoordsUpdate=new a.Signal,this.x=d,this.y=e)}return b.prototype.objType=function(){return"HUDWidget"},Object.defineProperty(b.prototype,"style",{get:function(){return this._device===a.TARGET_BROWSER?this.container.style:void 0},set:function(b){this._device===a.TARGET_BROWSER&&(this.container.style=b)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"x",{get:function(){return this._x},set:function(b){this._manager.supported&&(this._x=b,this._device==a.TARGET_BROWSER&&(this.container.style.left=this.x+"px"),this.onCoordsUpdate.dispatch(this.x,this.y))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this._y},set:function(b){this._manager.supported&&(this._y=b,this._device==a.TARGET_BROWSER&&(this.container.style.top=this.y+"px"),this.onCoordsUpdate.dispatch(this.x,this.y))},enumerable:!0,configurable:!0}),b.prototype.setTemplate=function(b,c){for(var d=[],e=0;e<arguments.length-2;e++)d[e]=arguments[e+2];if(this._device==a.TARGET_BROWSER){var f=document.getElementById(b);if(void 0===f)return;if(void 0===c)var g=f;else{var g=document.getElementById(c);if(void 0===g||f.contains(g)===!1)return}this.tempElement=g,this._tempContainer=f,this._tempParent=f.parentElement,this._tempParent.removeChild(f),this.container.appendChild(f)}},b.prototype.removeTemplate=function(){this._device==a.TARGET_BROWSER&&void 0!==this.tempElement&&(this.container.removeChild(this._tempContainer),this._tempParent.appendChild(this._tempContainer),this.tempElement=null,this._tempParent=null,this._tempContainer=null)},Object.defineProperty(b.prototype,"class",{get:function(){return this._device==a.TARGET_BROWSER?this.container.className:void 0},set:function(b){this._device==a.TARGET_BROWSER&&(this.container.className=b)},enumerable:!0,configurable:!0}),b.prototype.update=function(){this.components.update()},b.prototype.destroy=function(){delete this.game,delete this._manager,delete this._device,this.onCoordsUpdate&&this.onCoordsUpdate.dispose(),delete this.onCoordsUpdate},b}();b.HUDWidget=c}(a.HUD||(a.HUD={}));a.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(b){function c(c,d,e,f){b.call(this,c,"textField",e,f),this._prefix="",this._suffix="",this.class="kiwi-textfield-widget kiwi-widget",this._manager.supported&&this._device===a.TARGET_BROWSER&&(this._textField=this.container,this._textField.innerHTML=d)}return __extends(c,b),c.prototype.objType=function(){return"TextFieldWidget"},c.prototype.setTemplate=function(c,d){this._device===a.TARGET_BROWSER&&(this._textField.innerText="",b.prototype.setTemplate.call(this,c,d),void 0!==this.tempElement&&(this._textField=this.tempElement),this._textField.innerHTML=this._text)},c.prototype.removeTemplate=function(){this._device===a.TARGET_BROWSER&&(b.prototype.removeTemplate.call(this),this._device===a.TARGET_BROWSER&&(this._textField=this.container,this._textField.innerHTML=this._text))},Object.defineProperty(c.prototype,"text",{get:function(){return this._text},set:function(b){this._manager.supported&&this._device===a.TARGET_BROWSER&&(""!==this._prefix&&(b=this._prefix+b),""!==this._suffix&&(b+=this._suffix),this._text=b,this._textField.innerHTML=this._text)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"suffix",{get:function(){return this._suffix},set:function(a){this._suffix=a,this._updateText()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"prefix",{get:function(){return this._prefix},set:function(a){this._prefix=a,this._updateText()},enumerable:!0,configurable:!0}),c.prototype._updateText=function(){this.text=this._text},c}(a.HUD.HUDWidget);b.TextField=c}(b.Widget||(b.Widget={}));b.Widget}(a.HUD||(a.HUD={}));a.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(b){function c(c,d,e,f,g,h,i,j){"undefined"==typeof h&&(h=120),"undefined"==typeof i&&(i=20),"undefined"==typeof j&&(j="#000"),b.call(this,c,"bar",f,g),this._horizontal=!0,this.class="kiwi-bar-widget kiwi-widget",this._manager.supported&&(this._device==a.TARGET_BROWSER&&(this._bar=document.createElement("div"),this._bar.className="kiwi-innerbar-widget",this._bar.style.backgroundColor=j,this.bar=this._bar,this.container.appendChild(this.bar)),this.counter=this.components.add(new a.HUD.HUDComponents.Counter(this,d,e,0)),this.counter.updated.add(this.updateCSS,this),this.width=h,this.height=i,this._bar.style.height="100%",this._bar.style.width="100%",this.updateCSS())}return __extends(c,b),c.prototype.objType=function(){return"BarWidget"},Object.defineProperty(c.prototype,"width",{get:function(){return this._width},set:function(b){this._device==a.TARGET_BROWSER&&(this.container.style.width=b+"px"),this._width=b},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"height",{get:function(){return this._height},set:function(b){this._device==a.TARGET_BROWSER&&(this.container.style.height=b+"px"),this._height=b},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"horizontal",{get:function(){return this._horizontal},set:function(a){this._horizontal=a,this.updateCSS()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"vertical",{get:function(){return!this._horizontal},set:function(a){this._horizontal=!a,this.updateCSS()},enumerable:!0,configurable:!0}),c.prototype.setTemplate=function(c,d){this._device==a.TARGET_BROWSER&&(b.prototype.setTemplate.call(this,c,d),void 0!==this.tempElement&&(this.bar=this.tempElement))},c.prototype.removeTemplate=function(){this._device==a.TARGET_BROWSER&&(b.prototype.removeTemplate.call(this),this.bar=this._bar,this.container.appendChild(this.bar),this.updateCSS())},c.prototype.updateCSS=function(){this.horizontal===!0?(this.bar.style.width=String(this.counter.currentPercent())+"%",this.bar.style.height="100%"):(this.bar.style.height=String(this.counter.currentPercent())+"%",this.bar.style.width="100%")},c}(a.HUD.HUDWidget);b.Bar=c}(b.Widget||(b.Widget={}));b.Widget}(a.HUD||(a.HUD={}));a.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(b){function c(a,c,d,e){b.call(this,a,"Icon",d,e),this._cellIndex=0,this.class="kiwi-icon-widget kiwi-widget",this.atlas=c,this.icon=this.container,this._applyCSS()}return __extends(c,b),Object.defineProperty(c.prototype,"cellIndex",{get:function(){return this._cellIndex},set:function(a){this._cellIndex=a,this.width=this.atlas.cells[this.cellIndex].w,this.height=this.atlas.cells[this.cellIndex].h,this._applyCSS()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"width",{get:function(){return this.atlas.cells[this.cellIndex].w},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"height",{get:function(){return this.atlas.cells[this.cellIndex].h},enumerable:!0,configurable:!0}),c.prototype._removeCSS=function(){this.icon.style.width="",this.icon.style.height="",this.icon.style.backgroundImage="",this.icon.style.backgroundRepeat=""},c.prototype._applyCSS=function(){this.icon.style.width=this.width+"px",this.icon.style.height=this.height+"px",this.icon.style.backgroundPositionX=-this.atlas.cells[this.cellIndex].x+"px",this.icon.style.backgroundPositionY=-this.atlas.cells[this.cellIndex].y+"px",this.icon.style.backgroundRepeat="no-repeat",this.icon.style.backgroundImage=0==a.Utils.Common.isUndefined(this.atlas.image.src)?'url("'+this.atlas.image.src+'")':'url("'+this.atlas.image.toDataURL("image/png")+'")'},c.prototype.setTemplate=function(c,d){this._device==a.TARGET_BROWSER&&(this._removeCSS(),b.prototype.setTemplate.call(this,c,d),void 0!==this.tempElement&&(this.icon=this.tempElement),this._applyCSS())},c.prototype.removeTemplate=function(){this._device==a.TARGET_BROWSER&&(b.prototype.removeTemplate.call(this),this._removeCSS(),this.icon=this.container,this._applyCSS())},c}(a.HUD.HUDWidget);b.Icon=c}(b.Widget||(b.Widget={}));b.Widget}(a.HUD||(a.HUD={}));a.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(b){function c(c,d,e,f,g,h){b.call(this,c,"IconBar",g,h),this.iconGap=0,this.class="kiwi-iconbar-widget kiwi-widget",this.atlas=d,this.width=this.atlas.cells[0].w,this.height=this.atlas.cells[0].h,this._horizontal=!0,this.counter=this.components.add(new a.HUD.HUDComponents.Counter(this,e,f,0)),this.counter.updated.add(this._amountChanged,this),this._icons=[],this._amountChanged()}return __extends(c,b),c.prototype.objType=function(){return"IconBarWidget"},c.prototype._amountChanged=function(){if(this.counter.max!==this._icons.length)if(this.counter.max>this._icons.length)for(var a=this.counter.max-this._icons.length,b=0;a>b;b++)this._addIcon();else for(var b=this.counter.max;b<this._icons.length;b++)this._removeIcon(this._icons[b]),this._icons[b].destroy(),this._icons.splice(b,1),b--;for(var b=0;b<this._icons.length;b++)this._icons[b].style.display=b>this.counter.current-1?"none":"block"},c.prototype._addIcon=function(){if(this.horizontal)var b=new a.HUD.Widget.Icon(this.game,this.atlas,this.x+(this.width+this.iconGap)*(this._icons.length-1),this.y);else var b=new a.HUD.Widget.Icon(this.game,this.atlas,this.x,(this.height+this.iconGap)*(this._icons.length-1)+this.y);this._icons.push(b),this._device==a.TARGET_BROWSER&&this.container.appendChild(b.container)},c.prototype._removeIcon=function(b){this._device==a.TARGET_BROWSER&&this.container.removeChild(b.container)},Object.defineProperty(c.prototype,"horizontal",{get:function(){return this._horizontal},set:function(a){this._horizontal=a,this._amountChanged()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"vertical",{get:function(){return!this._horizontal},set:function(a){this._horizontal=!a,this._amountChanged()},enumerable:!0,configurable:!0}),c}(a.HUD.HUDWidget);b.IconBar=c}(b.Widget||(b.Widget={}));b.Widget}(a.HUD||(a.HUD={}));a.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(b){function c(c,d,e,f){"undefined"==typeof f&&(f=0),b.call(this,c,"basicScore",d,e),this.name="basicScore",this.class="kiwi-basicscore-widget kiwi-widget",this.counter=this.components.add(new a.HUD.HUDComponents.Counter(this,f)),this.counter.updated.add(this._updateText,this),this._updateText()}return __extends(c,b),c.prototype.objType=function(){return"BasicScoreWidget"},c.prototype._updateText=function(){this.text=String(this.counter.current)},c}(a.HUD.Widget.TextField);b.BasicScore=c}(b.Widget||(b.Widget={}));b.Widget}(a.HUD||(a.HUD={}));a.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(b){function c(c,d,e,f){b.call(this,c,d,e,f),this.name="button",this.class="kiwi-button-widget kiwi-widget",this.input=this.components.add(new a.HUD.HUDComponents.WidgetInput(this,this.container))}return __extends(c,b),c.prototype.objType=function(){return"ButtonWidget"},c}(a.HUD.Widget.TextField);b.Button=c}(b.Widget||(b.Widget={}));b.Widget}(a.HUD||(a.HUD={}));a.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(b){function c(c,d,e,f){b.call(this,c,"time",e,f),this.name="time",this.class="kiwi-time-widget kiwi-widget",this.time=this.components.add(new a.HUD.HUDComponents.Time(this,d))}return __extends(c,b),c.prototype.objType=function(){return"TimeWidget"},c.prototype.pause=function(){this.time.pause()},c.prototype.stop=function(){this.time.stop()},c.prototype.start=function(){this.time.start()},c.prototype.resume=function(){this.time.resume()},c.prototype.update=function(){b.prototype.update.call(this),this.time.isRunning&&(this.text=this.time.getTime())},c}(a.HUD.Widget.TextField);b.Time=c}(b.Widget||(b.Widget={}));b.Widget}(a.HUD||(a.HUD={}));a.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(b){function c(a,c,d){b.call(this,a,"menu",c,d),this._menuItems=[],this._styles=[],this.class="kiwi-menu-widget kiwi-widget"}return __extends(c,b),c.prototype.objType=function(){return"MenuWidget"},c.prototype.setIconStyle=function(a,b){this._styles.push({index:a,value:b});for(var c=0;c<this._menuItems.length;c++)this._menuItems[c].style[a]=b},Object.defineProperty(c.prototype,"menuItems",{get:function(){return this._menuItems},enumerable:!0,configurable:!0}),c.prototype.createMenuItem=function(b,c,d){return this.addMenuItem(new a.HUD.Widget.MenuItem(this.game,b,c,d))},c.prototype.addMenuItem=function(b){this._menuItems.push(b),b.menu=this;for(var c=0;c<this._styles.length;c++)b.style[this._styles[c].index]=this._styles[c].value;return this._device==a.TARGET_BROWSER&&this.container.appendChild(b.container),b},c.prototype.addMenuItems=function(a){for(var b=0;b<a.length;b++)this.addMenuItem(a[b])},c.prototype.getMenuItem=function(a){return this._menuItems[a]},c.prototype.setTemplate=function(a,b){},c.prototype.removeTemplate=function(){},c.prototype.update=function(){for(var a=0;a<this._menuItems.length;a++)this._menuItems[a].update();b.prototype.update.call(this)},c}(a.HUD.HUDWidget);b.Menu=c}(b.Widget||(b.Widget={}));b.Widget}(a.HUD||(a.HUD={}));a.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(a){function b(b,c,d,e){a.call(this,b,c,d,e),this.name="menuItem",this.class="kiwi-menuitem-widget kiwi-widget"}return __extends(b,a),b.prototype.objType=function(){return"MenuItem"},b}(a.HUD.Widget.Button);b.MenuItem=c}(b.Widget||(b.Widget={}));b.Widget}(a.HUD||(a.HUD={}));a.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(b){function c(c,d,e,f){"undefined"==typeof e&&(e=null),"undefined"==typeof f&&(f=null),b.call(this,c,"counter"),this._current=d,this._max=e,this._min=f,this.updated=new a.Signal}return __extends(c,b),c.prototype.objType=function(){return"CounterComponent"},Object.defineProperty(c.prototype,"max",{get:function(){return this._max},set:function(a){this._max=a,this.updated.dispatch(this._current,this._max,this._min)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"min",{get:function(){return this._min},set:function(a){this._min=a,this.updated.dispatch(this._current,this._max,this._min)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"current",{get:function(){return this._current},set:function(a){this._current=null!==this._max&&a>this._max?this._max:null!==this._min&&a<this._min?this._min:a,this.updated.dispatch(this._current,this._max,this._min)},enumerable:!0,configurable:!0}),c.prototype.decrease=function(a){return"undefined"==typeof a&&(a=1),(null===this._min||this._current>this._min)&&(null!==this._min&&this._current-a<this._min?this._current=this._min:this._current-=a,this.updated.dispatch(this._current,this._max,this._min)),this._current},c.prototype.increase=function(a){return"undefined"==typeof a&&(a=1),(null===this._max||this._current<this._max)&&(null!==this._max&&this._current+a>this._max?this._current=this._max:this._current+=a,this.updated.dispatch(this._current,this._max,this._min)),this._current},c.prototype.currentPercent=function(){return null!==this.max?this.current/this.max*100:void 0},c}(a.Component);b.Counter=c}(b.HUDComponents||(b.HUDComponents={}));b.HUDComponents}(a.HUD||(a.HUD={}));a.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(b){function c(c,d){b.call(this,c,"WidgetInput"),this._active=!1,this._container=d,this.onUp=new a.Signal,this.onDown=new a.Signal,this.onOver=new a.Signal,this.onOut=new a.Signal,this._addEvents()}return __extends(c,b),c.prototype.objType=function(){return"WidgetInputComponent"},c.prototype.setElement=function(a){this._removeEvents(),this._container=a,this._addEvents()},c.prototype._addEvents=function(){if(!this._active){this._binds=[],this._binds.push({event:"mouseup","function":this._up.bind(this)}),this._binds.push({event:"mousedown","function":this._down.bind(this)}),this._binds.push({event:"mouseover","function":this._over.bind(this)}),this._binds.push({event:"mouseout","function":this._out.bind(this)});for(var a=0;a<this._binds.length;a++)this._container.addEventListener(this._binds[a].event,this._binds[a].function,!1);this._active=!0}},c.prototype._removeEvents=function(){if(this._active){for(var a=0;a<this._binds.length;a++)this._container.removeEventListener(this._binds[a].event,this._binds[a].function,!1);this._binds=[],this._active=!1}},c.prototype._up=function(a){this.onUp.dispatch(a)},c.prototype._down=function(a){this.onDown.dispatch(a)},c.prototype._over=function(a){this.onOver.dispatch(a)},c.prototype._out=function(a){this.onOut.dispatch(a)},c}(a.Component);b.WidgetInput=c}(b.HUDComponents||(b.HUDComponents={}));b.HUDComponents}(a.HUD||(a.HUD={}));a.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){!function(b){var c=function(a){function b(b,c){"undefined"==typeof c&&(c=""),a.call(this,b,"time"),this.countDown=!1,this._displayString="",this._currentTime=0,this._timeBefore=0,this.speed=1,this.clock=this.game.time.addClock(name+"-clock",1e3),this.format=c}return __extends(b,a),b.prototype.objType=function(){return"TimeComponent"},Object.defineProperty(b.prototype,"isRunning",{get:function(){return this.clock.isRunning()},enumerable:!0,configurable:!0}),b.prototype.pause=function(){this.clock.pause()},b.prototype.stop=function(){this.clock.stop()},b.prototype.start=function(){this.clock.start(),this._timeBefore=this.clock.elapsed()},b.prototype.resume=function(){this.clock.resume()},Object.defineProperty(b.prototype,"format",{get:function(){return this._format},set:function(a){this._format=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"currentTime",{get:function(){return this._currentTime},enumerable:!0,configurable:!0}),b.prototype.setTime=function(a,b,c){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),this._currentTime=a,0!=b&&(this._currentTime+=1e3*b),0!=c&&(this._currentTime+=60*c*1e3)},b.prototype.addTime=function(a,b,c){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),this._currentTime+=a,0!=b&&(this._currentTime+=1e3*b),0!=c&&(this._currentTime+=60*c*1e3)},b.prototype.removeTime=function(a,b,c){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),this._currentTime-=a,0!=b&&(this._currentTime-=1e3*b),0!=c&&(this._currentTime-=60*c*1e3)},b.prototype.getTime=function(){if(this.countDown?this._currentTime-=(this.clock.elapsed()-this._timeBefore)*this.speed:this._currentTime+=(this.clock.elapsed()-this._timeBefore)*this.speed,this._timeBefore=this.clock.elapsed(),""!==this._format){if(this._displayString=this._format,-1!==this._displayString.indexOf("ms")){var a=String(Math.floor(1e3*this._currentTime)%1e3);this._displayString=this._displayString.replace("ms",a)}if(-1!=this._displayString.indexOf("ss")){var a=String(Math.floor(this._currentTime)%60);a.length<2&&(a="0"+a),this._displayString=this._displayString.replace("ss",a)}if(-1!==this._displayString.indexOf("mm")){var a=String(Math.floor(this._currentTime/60)%60);a.length<2&&(a="0"+a),this._displayString=this._displayString.replace("mm",a)}if(-1!=this._displayString.indexOf("s")){var a=String(Math.floor(this._currentTime)%60);this._displayString=this._displayString.replace("s",a)}if(-1!==this._displayString.indexOf("m")){var a=String(Math.floor(this._currentTime/60)%60);this._displayString=this._displayString.replace("m",a)}return this._displayString}return String(this._currentTime.toFixed(2))},b}(a.Component);b.Time=c}(b.HUDComponents||(b.HUDComponents={}));b.HUDComponents}(a.HUD||(a.HUD={}));a.HUD}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a){this.noAudio=!1,this.usingWebAudio=!1,this.usingAudioTag=!1,this.context=null,this.masterGain=null,this._unlockedSource=null,this._game=a}return b.prototype.objType=function(){return"AudioManager"},Object.defineProperty(b.prototype,"locked",{get:function(){return this._locked},enumerable:!0,configurable:!0}),b.prototype.boot=function(){this._volume=1,this._muted=!1,this._sounds=[],a.DEVICE.iOS&&0==a.DEVICE.webaudio&&(this.channels=1),a.DEVICE.iOS&&this._game.deviceTargetOption!==a.TARGET_COCOON?(this._locked=!0,this._game.input.onUp.addOnce(this._unlocked,this),console.log("Kiwi.AudioManager: Audio is currently Locked until at touch event.")):this._locked=!1,this.usingWebAudio=!0,this.usingAudioTag=!1,window.AudioContext?this.context=new window.AudioContext:window.webkitAudioContext?this.context=new window.webkitAudioContext:window.Audio?(this.usingWebAudio=!1,this.usingAudioTag=!0):(this.usingWebAudio=!1,this.noAudio=!0),null!==this.context&&(this.masterGain=void 0===this.context.createGain?this.context.createGainNode():this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},b.prototype._unlocked=function(){if(console.log("Kiwi.AudioManager: Audio now Unlocked"),this.usingAudioTag){this._locked=!1;for(var a=0;a<this._sounds.length;a++)this._sounds[a].playable=!0}else{var b=this.context.createBuffer(1,1,22050);this._unlockedSource=this.context.createBufferSource(),this._unlockedSource.buffer=b,this._unlockedSource.connect(this.context.destination),this._unlockedSource.noteOn(0)}},Object.defineProperty(b.prototype,"mute",{get:function(){return this._muted},set:function(a){if(a===!0){if(this._muted)return;if(this._muted=!0,this.usingWebAudio)this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0;else if(this.usingAudioTag)for(var b=0;b<this._sounds.length;b++)this._sounds[b].mute=!0}else{if(0==this._muted)return;if(this._muted=!1,this.usingWebAudio)this.masterGain.gain.value=this._muteVolume;else if(this.usingAudioTag)for(var b=0;b<this._sounds.length;b++)this._sounds[b].mute=!1}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"volume",{get:function(){return this._volume},set:function(b){if(void 0!==b)if(b=a.Utils.GameMath.clamp(b,1,0),this._volume=b,this._muted&&(this._muteVolume=this._volume),this.usingWebAudio)this.masterGain.gain.value=b;else if(this.usingAudioTag)for(var c=0;c<this._sounds.length;c++)this._sounds[c].volume=this._sounds[c].volume},enumerable:!0,configurable:!0}),b.prototype.isRegistered=function(a){return this.noAudio?void 0:-1!==this._sounds.indexOf(a)?!0:!1},b.prototype.registerSound=function(a){return this.isRegistered(a)===!1?(a.id=this._game.rnd.uuid(),this._sounds.push(a),!0):!1},b.prototype.add=function(b,c,d){if("undefined"==typeof c&&(c=1),"undefined"==typeof d&&(d=!1),!this.noAudio){var e=new a.Sound.Audio(this._game,b,c,d);return e}},b.prototype.remove=function(a,b){"undefined"==typeof b&&(b=!0);for(var c=0;c<this._sounds.length;c++)if(a.id==this._sounds[c].id)return this.usingWebAudio&&this._sounds[c].gainNode.disconnect(),1==b&&this._sounds[c].destroy(),void this._sounds.splice(c,1,0)},b.prototype.playAll=function(){for(var a=0;a<this._sounds.length;a++)this._sounds[a]&&this._sounds[a].play()},b.prototype.stopAll=function(){for(var a=0;a<this._sounds.length;a++)this._sounds[a]&&this._sounds[a].stop()},b.prototype.pauseAll=function(){for(var a=0;a<this._sounds.length;a++)this._sounds[a]&&this._sounds[a].pause()},b.prototype.resumeAll=function(){for(var a=0;a<this._sounds.length;a++)this._sounds[a]&&this._sounds[a].resume()},b.prototype.update=function(){if(this._locked&&this.usingWebAudio&&null!==this._unlockedSource&&(this._unlockedSource.playbackState===this._unlockedSource.PLAYING_STATE||this._unlockedSource.playbackState===this._unlockedSource.FINISHED_STATE)){this._locked=!1,this._unlockedSource=null;for(var a=0;a<this._sounds.length;a++)this._sounds[a].playable=!0}if(!this.noAudio)for(var a=0;a<this._sounds.length;a++)this._sounds[a].update()},b}();b.AudioManager=c}(a.Sound||(a.Sound={}));a.Sound}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(b,c,d,e){return this._muted=!1,this.totalDuration=0,this._buffer=null,this._decoded=!1,this._markers=[],this._currentMarker="default",this.ready=!1,this._game=b,this._game.audio.registerSound(this),this._usingAudioTag=this._game.audio.usingAudioTag,this._usingWebAudio=this._game.audio.usingWebAudio,this._playable=1==this._game.audio.locked?!1:!0,this.duration=0,this._volume=d,this._muteVolume=d,this._muted=this._game.audio.mute,this._loop=e,this.key=c,this._game.audio.noAudio||this._game.fileStore.exists(this.key)===!1?void(this._game.debugOption&&console.log("Could not play Audio. Either the browser doesn't support audio or the Audio file was not found on the filestore")):(this._usingWebAudio?(this._setAudio(),this.ready&&(this.context=this._game.audio.context,this.masterGainNode=this._game.audio.masterGain,this.gainNode="undefined"==typeof this.context.createGain?this.context.createGainNode():this.context.createGain(),this._decode(),this.gainNode.gain.value=this.volume*this._game.audio.volume,this.gainNode.connect(this.masterGainNode))):this._usingAudioTag&&this._playable===!0&&(this._setAudio(),this.ready&&(this.totalDuration=this._sound.duration,this._sound.volume=this.volume*this._game.audio.volume,(isNaN(this.totalDuration)||0==this.totalDuration)&&(this._pending=!0))),this.addMarker("default",0,this.totalDuration,this._loop),this._currentMarker="default",this.onPlay=new a.Signal,this.onStop=new a.Signal,this.onPause=new a.Signal,this.onResume=new a.Signal,this.onLoop=new a.Signal,void(this.onMute=new a.Signal))
}return Object.defineProperty(b.prototype,"playable",{get:function(){return this._playable},set:function(a){this._playable!==!0&&1==a&&(this._playable=a,this._setAudio(),this.ready&&this._usingAudioTag&&(this.totalDuration=this._sound.duration,this._sound.volume=this.volume*this._game.audio.volume))},enumerable:!0,configurable:!0}),b.prototype.objType=function(){return"Audio"},b.prototype._setAudio=function(){this._file=this._game.fileStore.getFile(this.key),"undefined"!=typeof this._file.data&&(this._usingAudioTag?(this._sound=this._file.data.cloneNode(!0),this._game.deviceTargetOption==a.TARGET_BROWSER&&(this._sound.play(),this._sound.pause())):this._sound=this._file.data,this.ready=!0)},b.prototype._decode=function(){if(0!=this.ready&&!this._usingAudioTag){if(this._file.data.decoded===!0&&null!==this._file.data.buffer)return this._buffer=this._file.data.buffer,void(this._decoded=!0);var a=this;this.context.decodeAudioData(this._file.data.raw,function(b){a._buffer=b,a._decoded=!0})}},Object.defineProperty(b.prototype,"volume",{get:function(){return this._volume},set:function(b){this._game.audio.noAudio||this.ready===!1||(b=a.Utils.GameMath.clamp(b,1,0),this._volume=b,this._muted&&(this._muteVolume=this._volume),this._playable&&(this._usingWebAudio?this.gainNode.gain.value=this._volume*this._game.audio.volume:this._usingAudioTag&&(this._sound.volume=this._volume*this._game.audio.volume)))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"mute",{get:function(){return this._muted},set:function(a){this._game.audio.noAudio||void 0!==a&&this._muted!==a&&(a===!0?(this._muteVolume=this._volume,this.volume=0,this._muted=!0):(this._muted=!1,this.volume=this._muteVolume),this.onMute.dispatch(this._muted))},enumerable:!0,configurable:!0}),b.prototype.addMarker=function(a,b,c,d){"undefined"==typeof d&&(d=!1),this._markers[a]={start:b,stop:c,duration:c-b,loop:d}},b.prototype.removeMarker=function(a){"default"!==a&&(this.isPlaying&&this._currentMarker==a&&(this.stop(),this._currentMarker="default"),delete this._markers[a])},b.prototype.play=function(b,c){return"undefined"==typeof b&&(b=this._currentMarker),"undefined"==typeof c&&(c=!1),this.isPlaying&&0==c||this._game.audio.noAudio||(c===!0&&this._pending===!1&&this.stop(),"undefined"==typeof this._markers[b]||this._currentMarker===b&&this.isPlaying&&0==c)?void 0:(this.paused=!1,this._currentMarker=b,this.duration=1e3*this._markers[this._currentMarker].duration,this._loop=this._markers[this._currentMarker].loop,this._playable===!1?void(this._pending=!0):void(this._usingWebAudio?this._decoded===!0?(null==this._buffer&&(this._buffer=this._file.data.buffer),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.gainNode),this.totalDuration=this._sound.buffer.duration,0==this.duration&&(this.duration=1e3*this.totalDuration),this._loop&&(this._sound.loop=!0),void 0===this._sound.start?this._sound.noteGrainOn(0,this._markers[this._currentMarker].start,this.duration/1e3):this._sound.start(0,this._markers[this._currentMarker].start,this.duration/1e3),this.isPlaying=!0,this._startTime=this._game.time.now(),this._currentTime=0,this._stopTime=this._startTime+this.duration,this.onPlay.dispatch()):(this._pending=!0,this._decode()):this._usingAudioTag&&(this._sound&&4==this._sound.readyState||this._game.deviceTargetOption==a.TARGET_COCOON?((0==this.duration||isNaN(this.duration))&&(this.duration=1e3*this.totalDuration),this._sound.volume=this._muted?0:this._volume,this._sound.currentTime=this._markers[this._currentMarker].start,this._sound.play(),this.isPlaying=!0,this._startTime=this._game.time.now(),this._currentTime=0,this._stopTime=this._startTime+this.duration,this.paused||this.onPlay.dispatch()):this._pending=!0)))},b.prototype.stop=function(){this.isPlaying&&this._sound&&(this._usingWebAudio?void 0===this._sound.stop?this._sound.noteOff(0):this._sound.stop(0):this._usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0),this.isPlaying=!1,0==this.paused&&this.onStop.dispatch())},b.prototype.pause=function(){this.isPlaying&&(this.paused=!0,this.stop(),this.onPause.dispatch())},b.prototype.resume=function(){this.paused&&0==this.isPlaying&&(this._usingWebAudio?(null==this._buffer&&(this._buffer=this._file.data.buffer),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.gainNode),void 0===this._sound.start?this._sound.noteGrainOn(0,this._markers[this._currentMarker].start+this._currentTime/1e3,this.duration/1e3):this._sound.start(0,this._markers[this._currentMarker].start+this._currentTime/1e3,this.duration/1e3)):(this._sound.currentTime=this._markers[this._currentMarker].start+this._currentTime/1e3,this._sound.play()),this.paused=!1,this.isPlaying=!0,this.onResume.dispatch())},b.prototype.update=function(){this.ready&&(this._playable&&this._pending&&(this._decoded===!0||this._file.data&&this._file.data.decoded?(this._pending=!1,this.play()):(this._usingAudioTag&&!isNaN(this._sound.duration)||this._game.deviceTargetOption==a.TARGET_COCOON&&0!==this._sound.duration)&&(this.totalDuration=this._sound.duration,this._markers["default"].duration=this.totalDuration,this._pending=!1,this.isPlaying&&"default"==this._currentMarker&&(this.duration=this.totalDuration))),this.isPlaying&&(this._currentTime=this._game.time.now()-this._startTime,this._currentTime>=this.duration&&(this._usingWebAudio?this._loop?("default"==this._currentMarker?(this._currentTime=0,this._startTime=this._game.time.now()):this.play(this._currentMarker,!0),this.onLoop.dispatch()):this.stop():this._usingAudioTag&&(this._loop?(this.play(this._currentMarker,!0),this.onLoop.dispatch()):this.stop()))))},b.prototype.destroy=function(){this._game&&this._game.audio.remove(this),this.onLoop&&this.onLoop.dispose(),this.onStop&&this.onStop.dispose(),this.onPlay&&this.onPlay.dispose(),this.onMute&&this.onMute.dispose(),this.onPause&&this.onPause.dispose(),this.onResume&&this.onResume.dispose(),delete this.onLoop,delete this.onStop,delete this.onPause,delete this.onMute,delete this.onPlay,delete this.onResume,delete this._game,delete this._sound,delete this._currentTime,delete this._startTime,delete this._stopTime,delete this._pending,delete this.masterGainNode,delete this.gainNode,delete this.totalDuration,delete this.duration,delete this._file,delete this._buffer,delete this._decoded},b}();b.Audio=c}(a.Sound||(a.Sound={}));a.Sound}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a){this._game=a,this.audio={}}return b.prototype.objType=function(){return"AudioLibrary"},b.prototype.clear=function(){for(var a in this.audio)delete this.audio[a]},b.prototype.rebuild=function(a,b){this.clear(),this._game.debug&&console.log("Kiwi.AudioLibrary: Rebuilding Audio Library");for(var c=a.keys,d=0;d<c.length;d++){var e=this._game.fileStore.getFile(c[d]);e.isAudio&&(this._game.debug&&console.log("  Kiwi.AudioLibrary: Adding Audio: "+e.fileName),b.audioLibrary.add(e))}},b.prototype.add=function(b){switch(b.dataType){case a.Files.File.AUDIO:this.audio[b.key]=b}},b}();b.AudioLibrary=c}(a.Sound||(a.Sound={}));a.Sound}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function b(a,b,c,d){"undefined"==typeof d&&(d=1e3),this._timeFirstStarted=null,this._timeLastStarted=null,this._timeLastStopped=null,this._timeLastPaused=null,this._timeLastUnpaused=null,this._totalPaused=0,this._isRunning=!1,this._isStopped=!0,this._isPaused=!1,this._elapsedState=0,this.manager=null,this.master=null,this.name=null,this.units=0,this.manager=a,this.master=b,this.name=c,this.units=d,this.timers=[],this.units<1&&(this.units=1)}return b.prototype.objType=function(){return"Clock"},b.prototype.elapsedSinceFirstStarted=function(){return this._timeLastStarted?(this.master.elapsed()-this._timeFirstStarted)/this.units:null},b.prototype.started=function(){return this._timeLastStarted},b.prototype.elapsed=function(){return 0===this._elapsedState?this._timeLastStarted?(this.master.elapsed()-this._timeLastStarted-this._totalPaused)/this.units:null:1===this._elapsedState?(this._timeLastPaused-this._timeLastStarted-this._totalPaused)/this.units:2===this._elapsedState?this._timeLastStarted?(this.master.elapsed()-this._timeLastStarted-this._totalPaused)/this.units:null:3===this._elapsedState?(this._timeLastStopped-this._timeLastStarted-this._totalPaused)/this.units:void 0},b.prototype.elapsedSinceLastStopped=function(){return this._timeLastStarted?(this.master.elapsed()-this._timeLastStopped)/this.units:null},b.prototype.elapsedSinceLastPaused=function(){return this._timeLastStarted?(this.master.elapsed()-this._timeLastPaused)/this.units:null},b.prototype.elapsedSinceLastUnpaused=function(){return this._timeLastStarted?(this.master.elapsed()-this._timeLastUnpaused)/this.units:null},b.prototype.isRunning=function(){return this._isRunning},b.prototype.isStopped=function(){return this._isStopped},b.prototype.isPaused=function(){return this._isPaused},b.prototype.addTimer=function(a){return this.timers.push(a),this},b.prototype.createTimer=function(b,c,d,e){return"undefined"==typeof c&&(c=1),"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=!0),this.timers.push(new a.Timer(b,this,c,d)),e===!0&&this.timers[this.timers.length-1].start(),this.timers[this.timers.length-1]},b.prototype.removeTimer=function(a,b){return"undefined"==typeof a&&(a=null),"undefined"==typeof b&&(b=""),null!==a?this.timers[a.name]?(delete this.timers[a.name],!0):!1:""!==b&&this.timers[b]?(delete this.timers[b],!0):!1},b.prototype.checkExists=function(a){return this.timers[a]?!0:!1},b.prototype.stopAllTimers=function(){for(var a=0;a<this.timers.length;a++)this.timers[a].stop();return this},b.prototype.convertToMilliseconds=function(a){return a*this.units},b.prototype.update=function(){for(var a=0;a<this.timers.length;a++)this.timers[a].update()},b.prototype.start=function(){return this._timeLastStarted=this.master.elapsed(),this._totalPaused=0,this._timeFirstStarted||(this._timeFirstStarted=this._timeLastStarted),this._isRunning=!0,this._isPaused=!1,this._isStopped=!1,this._elapsedState=0,this},b.prototype.pause=function(){return this._isRunning===!0&&(this._timeLastPaused=this.master.elapsed(),this._isRunning=!1,this._isPaused=!0,this._isStopped=!1,this._elapsedState=1),this},b.prototype.resume=function(){return this._isPaused===!0&&(this._timeLastUnpaused=this.master.elapsed(),this._totalPaused+=this._timeLastUnpaused-this._timeLastPaused,this._isRunning=!0,this._isPaused=!1,this._isStopped=!1,this._elapsedState=2),this},b.prototype.stop=function(){return this._isStopped===!1&&(this._timeLastStopped=this.master.elapsed(),this._isPaused===!0&&(this._totalPaused+=this._timeLastStopped-this._timeLastPaused),this._isRunning=!1,this._isPaused=!1,this._isStopped=!0,this._elapsedState=3),this},b.prototype.toString=function(){return"[{Clock (name="+this.name+" units="+this.units+" running="+this._isRunning+")}]"},b}();a.Clock=b}(a.Time||(a.Time={}));a.Time}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function c(a){this._clocks=[],this.rate=1,this._game=a}return c.prototype.objType=function(){return"ClockManager"},c.prototype.boot=function(){this.master=new a.Time.MasterClock,this.clock=new b.Clock(this,this.master,"default",1e3),this.clock.start()},c.prototype.addClock=function(a,c){return"undefined"==typeof c&&(c=1e3),this._clocks.push(new b.Clock(this,this.master,a,c)),this._clocks[this._clocks.length-1]},c.prototype.getClock=function(a){for(var b=0;b<this._clocks.length;b++)if(this._clocks[b].name===a)return this._clocks[b]},c.prototype.update=function(){this.master.update(),this.clock.update();for(var a=0;a<this._clocks.length;a++)this._clocks[a].update();this.rate=this.master.rate},c.prototype.now=function(){return this.master.now},c.prototype.elapsed=function(){return this.master.elapsed()},c.prototype.delta=function(){return this.master.delta},c.prototype.setMasterInterval=function(a){this.master.idealDelta=a},c}();b.ClockManager=c}(a.Time||(a.Time={}));a.Time}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(){this.time=0,this.now=0,this.delta=0,this.rate=1,this.idealDelta=1e3/60,this._started=Date.now(),this.time=this._started}return a.prototype.objType=function(){return"MasterClock"},a.prototype.elapsed=function(){return this.now-this._started},a.prototype.totalElapsedSeconds=function(){return.001*(this.now-this._started)},a.prototype.update=function(){this.now=Date.now(),this.delta=this.now-this.time,this.time=this.now,this.rate=this.delta/this.idealDelta},a.prototype.elapsedSince=function(a){return this.now-a},a.prototype.elapsedSecondsSince=function(a){return.001*(this.now-a)},a.prototype.reset=function(){this._started=this.now},a}();a.MasterClock=b}(a.Time||(a.Time={}));a.Time}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function b(a,b,c,d){"undefined"==typeof d&&(d=0),this._currentCount=0,this._startEvents=null,this._countEvents=null,this._stopEvents=null,this._clock=null,this._timeLastCount=null,this._isRunning=!1,this._isStopped=!0,this._isPaused=!1,this.name=null,this.delay=0,this.repeatCount=0,this._clock=b,this._startEvents=[],this._countEvents=[],this._stopEvents=[],this.name=a,this.delay=c,this.repeatCount=d}return b.prototype.objType=function(){return"Timer"},b.prototype.currentCount=function(){return this._currentCount},b.prototype.isRunning=function(){return this._isRunning},b.prototype.isStopped=function(){return this._isStopped},b.prototype.isPaused=function(){return this._isPaused},b.prototype.processEvents=function(b){if(b===a.TimerEvent.TIMER_START)for(var c=0;c<this._startEvents.length;c++)this._startEvents[c].run();else if(b===a.TimerEvent.TIMER_COUNT)for(var c=0;c<this._countEvents.length;c++)this._countEvents[c].run();else if(b===a.TimerEvent.TIMER_STOP)for(var c=0;c<this._stopEvents.length;c++)this._stopEvents[c].run()},b.prototype.update=function(){this._isRunning&&this._clock.elapsed()-this._timeLastCount>=this.delay&&this._isPaused===!1&&(this._currentCount++,this.processEvents(a.TimerEvent.TIMER_COUNT),this._timeLastCount=this._clock.elapsed()||0,-1!==this.repeatCount&&this._currentCount>=this.repeatCount&&this.stop())},b.prototype.start=function(){return this._isStopped===!0&&(this._isRunning=!0,this._isPaused=!1,this._isStopped=!1,this._currentCount=0,this._timeLastCount=this._clock.elapsed()||0,this.processEvents(a.TimerEvent.TIMER_START)),this},b.prototype.stop=function(){return(this._isRunning===!0||this._isPaused===!0)&&(this._isRunning=!1,this._isPaused=!1,this._isStopped=!0,this.processEvents(a.TimerEvent.TIMER_STOP)),this},b.prototype.pause=function(){return this._isRunning===!0&&(this._isRunning=!1,this._isPaused=!0),this},b.prototype.resume=function(){return this._isPaused===!0&&(this._isRunning=!0,this._isPaused=!1),this},b.prototype.addTimerEvent=function(b){return b.type===a.TimerEvent.TIMER_START?this._startEvents.push(b):b.type===a.TimerEvent.TIMER_COUNT?this._countEvents.push(b):b.type===a.TimerEvent.TIMER_STOP&&this._stopEvents.push(b),b},b.prototype.createTimerEvent=function(b,c,d){return b===a.TimerEvent.TIMER_START?(this._startEvents.push(new a.TimerEvent(b,c,d)),this._startEvents[this._startEvents.length-1]):b===a.TimerEvent.TIMER_COUNT?(this._countEvents.push(new a.TimerEvent(b,c,d)),this._countEvents[this._countEvents.length-1]):b===a.TimerEvent.TIMER_STOP?(this._stopEvents.push(new a.TimerEvent(b,c,d)),this._stopEvents[this._stopEvents.length-1]):null},b.prototype.removeTimerEvent=function(b){var c=[];return b.type===a.TimerEvent.TIMER_START?c=this._startEvents.splice(this._startEvents.indexOf(b),1):b.type===a.TimerEvent.TIMER_COUNT?c=this._countEvents.splice(this._countEvents.indexOf(b),1):b.type===a.TimerEvent.TIMER_STOP&&(c=this._stopEvents.splice(this._stopEvents.indexOf(b),1)),1===c.length?!0:!1},b.prototype.clear=function(b){"undefined"==typeof b&&(b=0),0===b?(this._startEvents.length=0,this._countEvents.length=0,this._stopEvents.length=0):b===a.TimerEvent.TIMER_START?this._startEvents.length=0:b===a.TimerEvent.TIMER_COUNT?this._countEvents.length=0:b===a.TimerEvent.TIMER_STOP&&(this._stopEvents.length=0)},b.prototype.toString=function(){return"[{Timer (name="+this.name+" delay="+this.delay+" repeatCount="+this.repeatCount+" running="+this._isRunning+")}]"},b}();a.Timer=b}(a.Time||(a.Time={}));a.Time}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(a,b,c){this._callback=null,this.type=0,this.type=a,this._callback=b,this._callbackContext=c}return a.prototype.objType=function(){return"TimerEvent"},a.prototype.run=function(){this._callback&&this._callback.apply(this._callbackContext)},a.TIMER_START=1,a.TIMER_COUNT=2,a.TIMER_STOP=3,a}();a.TimerEvent=b}(a.Time||(a.Time={}));a.Time}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(a,b,c,d){"undefined"==typeof c&&(c=!0),"undefined"==typeof d&&(d=!1),this.domElement=null,this.context=null,this._visible=!0,this._offScreen=!1,this._clearMode=1,this.bgColor="rgb(0, 0, 0)",this.domElement=document.createElement("canvas"),this.domElement.width=a,this.domElement.height=b,this._width=a,this._height=b,this.context=this.domElement.getContext("2d"),this._offScreen=d,this._visible=c,c===!1&&(this.domElement.style.display="none")}return Object.defineProperty(b.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a,this._updatedSize()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a,this._updatedSize()},enumerable:!0,configurable:!0}),b.prototype.objType=function(){return"Canvas"},b.prototype._updatedSize=function(){this.domElement.width=this._width,this.domElement.height=this._height},b.prototype.destroy=function(){this._offScreen===!1&&(this.domElement.style.display="none")},Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},set:function(a){null!==a&&a!==this._visible&&(this._visible=a,this.domElement.style.display=a===!0?"block":"none")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"clearMode",{get:function(){return this._clearMode},set:function(b){null!==b&&b!==this._clearMode&&b>=a.Utils.Canvas.CLEARMODE_NONE&&b<=a.Utils.Canvas.CLEARMODE_FILLRECT_ALPHA&&(this._clearMode=b)},enumerable:!0,configurable:!0}),b.prototype.clear=function(){this._clearMode===b.CLEARMODE_NONE||(this._clearMode===b.CLEARMODE_CLEARRECT?this.context.clearRect(0,0,this.domElement.width,this.domElement.height):this._clearMode===b.CLEARMODE_FILLRECT?(this.context.fillStyle=this.bgColor,this.context.fillRect(0,0,this.domElement.width,this.domElement.height)):this._clearMode===b.CLEARMODE_FILLRECT_ALPHA&&(this.context.clearRect(0,0,this.domElement.width,this.domElement.height),this.context.fillStyle=this.bgColor,this.context.fillRect(0,0,this.domElement.width,this.domElement.height)))},b.prototype.saveAsPNG=function(){return this.domElement.toDataURL()},b.prototype.toString=function(){return"[{Canvas (width="+this.width+" height="+this.height+" visible="+this.visible+" offScreen="+this._offScreen+" clearMode="+this.clearMode+")}]"},b.CLEARMODE_NONE=0,b.CLEARMODE_CLEARRECT=1,b.CLEARMODE_FILLRECT=2,b.CLEARMODE_FILLRECT_ALPHA=3,b}();b.Canvas=c}(a.Utils||(a.Utils={}));a.Utils}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(){}return b.defaultCompare=function(a,b){return b>a?-1:a===b?0:1},b.prototype.objType=function(){return"Common"},b.defaultEquals=function(a,b){return a===b},b.defaultTostring=function(b){return null===b?"KIWI_NULL":a.Utils.Common.isUndefined(b)?"KIWI_UNDEFINED":a.Utils.Common.isString(b)?b:b.toString()},b.isFunction=function(a){return"function"==typeof a},b.isNumeric=function(a){return!isNaN(a)},b.isUndefined=function(a){return"undefined"==typeof a},b.isString=function(a){return"[object String]"===Object.prototype.toString.call(a)},b.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},b.reverseCompareFunction=function(b){return a.Utils.Common.isFunction(b)?function(a,c){return-1*b(a,c)}:function(a,b){return b>a?1:a===b?0:-1}},b.compareToEquals=function(a){return function(b,c){return 0===a(b,c)}},b.shuffleArray=function(a){for(var b=a.length-1;b>0;b--){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a},b.convertToBase2=function(a){var b=a.width,c=a.height;if(-1==this.base2Sizes.indexOf(b)){for(var d=0;b>this.base2Sizes[d];)d++;b=this.base2Sizes[d]}if(-1==this.base2Sizes.indexOf(c)){for(var d=0;c>this.base2Sizes[d];)d++;c=this.base2Sizes[d]}if(a.width!==b||a.height!==c){var e=document.createElement("canvas");return e.width=b,e.height=c,e.getContext("2d").drawImage(a,0,0),e}return a},b.base2Sizes=[2,4,16,32,64,128,256,512,1024,2048,4096],b}();b.Common=c}(a.Utils||(a.Utils={}));a.Utils}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(b){var c=function(){function b(){}return b.prototype.objType=function(){return"GameMath"},b.computeMachineEpsilon=function(){var a=4/3,b=a-1,c=b+b+b;return Math.abs(1-c)},b.fuzzyEqual=function(a,b,c){return"undefined"==typeof c&&(c=1e-4),Math.abs(a-b)<c},b.fuzzyLessThan=function(a,b,c){return"undefined"==typeof c&&(c=1e-4),b+c>a},b.fuzzyGreaterThan=function(a,b,c){return"undefined"==typeof c&&(c=1e-4),a>b-c},b.fuzzyCeil=function(a,b){return"undefined"==typeof b&&(b=1e-4),Math.ceil(a-b)},b.fuzzyFloor=function(a,b){return"undefined"==typeof b&&(b=1e-4),Math.floor(a+b)},b.average=function(){for(var a=[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0];for(var c=0,d=0;d<a.length;d++)c+=a[d];return c/a.length},b.slam=function(a,b,c){return"undefined"==typeof c&&(c=1e-4),Math.abs(a-b)<c?b:a},b.percentageMinMax=function(a,b,c){return"undefined"==typeof c&&(c=0),a-=c,b-=c,b?a/b:0},b.sign=function(a){return a?a/Math.abs(a):0},b.truncate=function(a){return a>0?Math.floor(a):Math.ceil(a)},b.shear=function(a){return a%1},b.wrap=function(a,b,c){if("undefined"==typeof c&&(c=0),a-=c,b-=c,0==b)return c;for(a%=b,a+=c;c>a;)a+=b;return a},b.arithWrap=function(a,b,c){return"undefined"==typeof c&&(c=0),b-=c,0==b?c:a-b*Math.floor((a-c)/b)},b.clamp=function(a,b,c){return"undefined"==typeof c&&(c=0),Math.max(c,Math.min(b,a))},b.snapTo=function(a,b,c){return"undefined"==typeof c&&(c=0),0==b?a:(a-=c,a=b*Math.round(a/b),c+a)},b.snapToFloor=function(a,b,c){return"undefined"==typeof c&&(c=0),0==b?a:(a-=c,a=b*Math.floor(a/b),c+a)},b.snapToCeil=function(a,b,c){return"undefined"==typeof c&&(c=0),0==b?a:(a-=c,a=b*Math.ceil(a/b),c+a)},b.snapToInArray=function(a,b,c){if("undefined"==typeof c&&(c=!0),c&&b.sort(),a<b[0])return b[0];for(var d=1;b[d]<a;)d++;var e=b[d-1],f=d<b.length?b[d]:Number.POSITIVE_INFINITY;return a-e>=f-a?f:e},b.roundTo=function(a,b,c){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=10);var d=Math.pow(c,-b);return Math.round(a*d)/d},b.floorTo=function(a,b,c){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=10);var d=Math.pow(c,-b);return Math.floor(a*d)/d},b.ceilTo=function(a,b,c){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=10);var d=Math.pow(c,-b);return Math.ceil(a*d)/d},b.interpolateFloat=function(a,b,c){return(b-a)*c+a},b.radiansToDegrees=function(a){return a*b.RAD_TO_DEG},b.degreesToRadians=function(a){return a*b.DEG_TO_RAD},b.angleBetween=function(a,b,c,d){return Math.atan2(d-b,c-a)},b.normalizeAngle=function(a,c){"undefined"==typeof c&&(c=!0);var d=c?b.PI:180;return b.wrap(a,d,-d)},b.nearestAngleBetween=function(a,c,d){"undefined"==typeof d&&(d=!0);var e=d?b.PI:180;return a=b.normalizeAngle(a,d),c=b.normalizeAngle(c,d),-e/2>a&&c>e/2&&(a+=2*e),-e/2>c&&a>e/2&&(c+=2*e),c-a},b.normalizeAngleToAnother=function(b,c,d){return"undefined"==typeof d&&(d=!0),c+a.Utils.GameMath.nearestAngleBetween(c,b,d)},b.normalizeAngleAfterAnother=function(b,c,d){return"undefined"==typeof d&&(d=!0),b=a.Utils.GameMath.normalizeAngle(b-c,d),c+b},b.normalizeAngleBeforeAnother=function(b,c,d){return"undefined"==typeof d&&(d=!0),b=a.Utils.GameMath.normalizeAngle(c-b,d),c-b},b.interpolateAngles=function(b,c,d,e,f){return"undefined"==typeof e&&(e=!0),"undefined"==typeof f&&(f=null),b=a.Utils.GameMath.normalizeAngle(b,e),c=a.Utils.GameMath.normalizeAngleToAnother(c,b,e),"function"==typeof f?f(d,b,c-b,1):a.Utils.GameMath.interpolateFloat(b,c,d)},b.logBaseOf=function(a,b){return Math.log(a)/Math.log(b)},b.GCD=function(a,b){var c;for(a=Math.abs(a),b=Math.abs(b),b>a&&(c=a,a=b,b=c);;){if(c=a%b,!c)return b;a=b,b=c}return 1},b.LCM=function(b,c){return b*c/a.Utils.GameMath.GCD(b,c)},b.factorial=function(a){if(0==a)return 1;for(var b=a;--a;)b*=a;return b},b.gammaFunction=function(b){return a.Utils.GameMath.factorial(b-1)},b.fallingFactorial=function(b,c){return a.Utils.GameMath.factorial(b)/a.Utils.GameMath.factorial(b-c)},b.risingFactorial=function(b,c){return a.Utils.GameMath.factorial(b+c-1)/a.Utils.GameMath.factorial(b-1)},b.binCoef=function(b,c){return a.Utils.GameMath.fallingFactorial(b,c)/a.Utils.GameMath.factorial(c)},b.risingBinCoef=function(b,c){return a.Utils.GameMath.risingFactorial(b,c)/a.Utils.GameMath.factorial(c)},b.chanceRoll=function(a){return"undefined"==typeof a&&(a=50),0>=a?!1:a>=100?!0:100*Math.random()>=a?!1:!0},b.maxAdd=function(a,b,c){return a+=b,a>c&&(a=c),a},b.minSub=function(a,b,c){return a-=b,c>a&&(a=c),a},b.wrapValue=function(a,b,c){var d;return a=Math.abs(a),b=Math.abs(b),c=Math.abs(c),d=(a+b)%c},b.randomSign=function(){return Math.random()>.5?1:-1},b.isOdd=function(a){return 1&a?!0:!1},b.isEven=function(a){return 1&a?!1:!0},b.wrapAngle=function(a){var b=a;return a>=-180&&180>=a?a:(b=(a+180)%360,0>b&&(b+=360),b-180)},b.angleLimit=function(a,b,c){var d=a;return a>c?d=c:b>a&&(d=b),d},b.linearInterpolation=function(b,c){var d=b.length-1,e=d*c,f=Math.floor(e);return 0>c?a.Utils.GameMath.linear(b[0],b[1],e):c>1?a.Utils.GameMath.linear(b[d],b[d-1],d-e):a.Utils.GameMath.linear(b[f],b[f+1>d?d:f+1],e-f)},b.bezierInterpolation=function(b,c){for(var d=0,e=b.length-1,f=0;e>=f;f++)d+=Math.pow(1-c,e-f)*Math.pow(c,f)*b[f]*a.Utils.GameMath.bernstein(e,f);return d},b.catmullRomInterpolation=function(b,c){var d=b.length-1,e=d*c,f=Math.floor(e);return b[0]===b[d]?(0>c&&(f=Math.floor(e=d*(1+c))),a.Utils.GameMath.catmullRom(b[(f-1+d)%d],b[f],b[(f+1)%d],b[(f+2)%d],e-f)):0>c?b[0]-(a.Utils.GameMath.catmullRom(b[0],b[0],b[1],b[1],-e)-b[0]):c>1?b[d]-(a.Utils.GameMath.catmullRom(b[d],b[d],b[d-1],b[d-1],e-d)-b[d]):a.Utils.GameMath.catmullRom(b[f?f-1:0],b[f],b[f+1>d?d:f+1],b[f+2>d?d:f+2],e-f)},b.linear=function(a,b,c){return(b-a)*c+a},b.bernstein=function(b,c){return a.Utils.GameMath.factorial(b)/a.Utils.GameMath.factorial(c)/a.Utils.GameMath.factorial(b-c)},b.catmullRom=function(a,b,c,d,e){var f=.5*(c-a),g=.5*(d-b),h=e*e,i=e*h;return(2*b-2*c+f+g)*i+(-3*b+3*c-2*f-g)*h+f*e+b},b.difference=function(a,b){return Math.abs(a-b)},b.PI=3.141592653589793,b.PI_2=1.5707963267948966,b.PI_4=.7853981633974483,b.PI_8=.39269908169872414,b.PI_16=.19634954084936207,b.TWO_PI=6.283185307179586,b.THREE_PI_2=4.71238898038469,b.E=2.71828182845905,b.LN10=2.302585092994046,b.LN2=.6931471805599453,b.LOG10E=.4342944819032518,b.LOG2E=1.4426950408889634,b.SQRT1_2=.7071067811865476,b.SQRT2=1.4142135623730951,b.DEG_TO_RAD=.017453292519943295,b.RAD_TO_DEG=57.29577951308232,b.B_16=65536,b.B_31=2147483648,b.B_32=4294967296,b.B_48=281474976710656,b.B_53=9007199254740992,b.B_64=0x10000000000000000,b.ONE_THIRD=.3333333333333333,b.TWO_THIRDS=.6666666666666666,b.ONE_SIXTH=.16666666666666666,b.COS_PI_3=.8660254037844386,b.SIN_2PI_3=.03654595,b.CIRCLE_ALPHA=.5522847498307935,b.ON=!0,b.OFF=!1,b.SHORT_EPSILON=.1,b.PERC_EPSILON=.001,b.EPSILON=1e-4,b.LONG_EPSILON=1e-8,b}();b.GameMath=c}(a.Utils||(a.Utils={}));a.Utils}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(a){"undefined"==typeof a&&(a=[]),this.c=1,this._data={lipsum:["lorem","ipsum","dolor","sit","amet","consectetur","adipiscing","elit","nunc","sagittis","tortor","ac","mi","pretium","sed","convallis","massa","pulvinar","curabitur","non","turpis","velit","vitae","rutrum","odio","aliquam","sapien","orci","tempor","sed","elementum","sit","amet","tincidunt","sed","risus","etiam","nec","lacus","id","ante","hendrerit","malesuada","donec","porttitor","magna","eget","libero","pharetra","sollicitudin","aliquam","mattis","mattis","massa","et","porta","morbi","vitae","magna","augue","vestibulum","at","lectus","sed","tellus","facilisis","tincidunt","suspendisse","eros","magna","consequat","at","sollicitudin","ac","vestibulum","vel","dolor","in","egestas","lacus","quis","lacus","placerat","et","molestie","ipsum","scelerisque","nullam","sit","amet","tortor","dui","aenean","pulvinar","odio","nec","placerat","fringilla","neque","dolor"]},this.sow(a)}return a.prototype.objType=function(){return"RandomDataGenerator"},a.prototype.uint32=function(){return 4294967296*this.rnd.apply(this)},a.prototype.fract32=function(){return this.rnd.apply(this)+1.1102230246251565e-16*(2097152*this.rnd.apply(this)|0)},a.prototype.rnd=function(){var a=2091639*this.s0+2.3283064365386963e-10*this.c;return this.c=0|a,this.s0=this.s1,this.s1=this.s2,this.s2=a-this.c,this.s2},a.prototype.hash=function(a){var b,c,d;for(d=4022871197,a=a.toString(),c=0;c<a.length;c++)d+=a.charCodeAt(c),b=.02519603282416938*d,d=b>>>0,b-=d,b*=d,d=b>>>0,b-=d,d+=4294967296*b;return 2.3283064365386963e-10*(d>>>0)},a.prototype.sow=function(a){"undefined"==typeof a&&(a=[]),this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1);for(var b,c=0;b=a[c++];)this.s0-=this.hash(b),this.s0+=~~(this.s0<0),this.s1-=this.hash(b),this.s1+=~~(this.s1<0),this.s2-=this.hash(b),this.s2+=~~(this.s2<0)},a.prototype.integer=function(){return this.uint32()},a.prototype.frac=function(){return this.fract32()},a.prototype.real=function(){return this.uint32()+this.fract32()},a.prototype.integerInRange=function(a,b){return Math.floor(this.realInRange(a,b))},a.prototype.realInRange=function(a,b){return a=a||0,b=b||0,this.frac()*(b-a)+a},a.prototype.normal=function(){return 1-2*this.frac()},a.prototype.uuid=function(){var a,b;for(b=a="";a++<36;b+=~a%5|3*a&4?(15^a?8^this.frac()*(20^a?16:4):4).toString(16):"-");return b},a.prototype.pick=function(a){return a[this.integerInRange(0,a.length)]},a.prototype.weightedPick=function(a){return a[~~(Math.pow(this.frac(),2)*a.length)]},a.prototype.word=function(){return this.pick(this._data.lipsum)},a.prototype.words=function(a){"undefined"==typeof a&&(a=3);for(var b=[],c=0;a>c;c++)b.push(this.pick(this._data.lipsum));return b.join(" ")},a.prototype.sentence=function(){var a;return a=this.words(this.integerInRange(2,16)).replace(/[a-z]/,function(a){return a.toUpperCase()}),a+"."},a.prototype.sentences=function(a){"undefined"==typeof a&&(a=3);for(var b=[],c=0;a>c;c++)b.push(this.sentence());return b.join(" ")},a.prototype.timestamp=function(a,b){return"undefined"==typeof a&&(a=9466848e5),"undefined"==typeof b&&(b=1577862e6),this.realInRange(a,b)},a.prototype.angle=function(){return this.integerInRange(-180,180)},a}();a.RandomDataGenerator=b}(a.Utils||(a.Utils={}));a.Utils}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(a){this._isSetTimeOut=!1,this.lastTime=0,this.currentTime=0,this.isRunning=!1,this._callback=a;for(var b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;c++)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]}return a.prototype.objType=function(){return"RequestAnimationFrame"},a.prototype.setCallback=function(a){this._callback=a},a.prototype.isUsingSetTimeOut=function(){return this._isSetTimeOut},a.prototype.isUsingRAF=function(){return this._isSetTimeOut===!0?!1:!0},a.prototype.start=function(a){var b=this;"undefined"==typeof a&&(a=null),a&&(this._callback=a),window.requestAnimationFrame?(this._isSetTimeOut=!1,window.requestAnimationFrame(function(){return b.RAFUpdate()})):(this._isSetTimeOut=!0,this._timeOutID=window.setTimeout(function(){return b.SetTimeoutUpdate()
},0)),this.isRunning=!0},a.prototype.stop=function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame,this.isRunning=!1},a.prototype.RAFUpdate=function(){var a=this;this.currentTime=Date.now(),this._callback&&this._callback();var b=Math.max(0,16-(this.currentTime-this.lastTime));window.requestAnimationFrame(function(){return a.RAFUpdate()}),this.lastTime=this.currentTime+b},a.prototype.SetTimeoutUpdate=function(){var a=this;this.currentTime=Date.now(),this._callback&&this._callback();var b=Math.max(0,16-(this.currentTime-this.lastTime));this._timeOutID=window.setTimeout(function(){return a.SetTimeoutUpdate()},b),this.lastTime=this.currentTime+b},a}();a.RequestAnimationFrame=b}(a.Utils||(a.Utils={}));a.Utils}(Kiwi||(Kiwi={}));var Kiwi;!function(a){!function(a){var b=function(){function a(){}return a.parseVersion=function(a){var b=a.split(".");return{majorVersion:parseInt(b[0]),minorVersion:parseInt(b[1]),patchVersion:parseInt(b[2])}},a.compareVersions=function(b,c){var d=a.parseVersion(b),e=a.parseVersion(c);return d.majorVersion>e.majorVersion?"greater":d.majorVersion<e.majorVersion?"less":d.minorVersion>e.minorVersion?"greater":d.minorVersion<e.minorVersion?"less":d.patchVersion>e.patchVersion?"greater":d.patchVersion<e.patchVersion?"less":"equal"},a.greaterOrEqual=function(b,c){var d=a.compareVersions(b,c);return"greater"==d||"equal"==d},a}();a.Version=b}(a.Utils||(a.Utils={}));a.Utils}(Kiwi||(Kiwi={}));var Kiwi;!function(a){a.VERSION="1.1.0",a.RENDERER_CANVAS=0,a.RENDERER_WEBGL=1,a.RENDERER_AUTO=2,a.TARGET_BROWSER=0,a.TARGET_COCOON=1,a.DEBUG_ON=0,a.DEBUG_OFF=1,a.DEVICE=null,a.STATE=0,a.GROUP=2,a.ENTITY=3,a.CAMERA=4,a.HUD_WIDGET=5,a.TILE_LAYER=6;var b=function(){function b(){}return b.prototype.objType=function(){return"GameManager"},b.register=function(b){return a.GameManager._games.push(b)},b.total=function(){return a.GameManager._games.length},b._games=[],b}();a.GameManager=b,a.Plugins={},a.extend=function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c}}(Kiwi||(Kiwi={})),function(a){"use strict";var b={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(b.exports={},define(function(){return b.exports})):b.exports="undefined"!=typeof window?window:a:b.exports=exports,function(a){if(!b)var b=1e-6;if(!c)var c="undefined"!=typeof Float32Array?Float32Array:Array;if(!d)var d=Math.random;var e={};e.setMatrixArrayType=function(a){c=a},"undefined"!=typeof a&&(a.glMatrix=e);var f={};f.create=function(){var a=new c(2);return a[0]=0,a[1]=0,a},f.clone=function(a){var b=new c(2);return b[0]=a[0],b[1]=a[1],b},f.fromValues=function(a,b){var d=new c(2);return d[0]=a,d[1]=b,d},f.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},f.set=function(a,b,c){return a[0]=b,a[1]=c,a},f.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},f.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},f.sub=f.subtract,f.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},f.mul=f.multiply,f.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},f.div=f.divide,f.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},f.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},f.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},f.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a},f.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},f.dist=f.distance,f.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},f.sqrDist=f.squaredDistance,f.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},f.len=f.length,f.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},f.sqrLen=f.squaredLength,f.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},f.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},f.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},f.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},f.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},f.random=function(a,b){b=b||1;var c=2*d()*Math.PI;return a[0]=Math.cos(c)*b,a[1]=Math.sin(c)*b,a},f.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e,a[1]=c[1]*d+c[3]*e,a},f.transformMat2d=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a},f.transformMat3=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[3]*e+c[6],a[1]=c[1]*d+c[4]*e+c[7],a},f.transformMat4=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[4]*e+c[12],a[1]=c[1]*d+c[5]*e+c[13],a},f.forEach=function(){var a=f.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),f.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},"undefined"!=typeof a&&(a.vec2=f);var g={};g.create=function(){var a=new c(3);return a[0]=0,a[1]=0,a[2]=0,a},g.clone=function(a){var b=new c(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},g.fromValues=function(a,b,d){var e=new c(3);return e[0]=a,e[1]=b,e[2]=d,e},g.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},g.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},g.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},g.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},g.sub=g.subtract,g.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},g.mul=g.multiply,g.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},g.div=g.divide,g.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},g.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},g.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},g.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},g.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},g.dist=g.distance,g.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},g.sqrDist=g.squaredDistance,g.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},g.len=g.length,g.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},g.sqrLen=g.squaredLength,g.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},g.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},g.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},g.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},g.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},g.random=function(a,b){b=b||1;var c=2*d()*Math.PI,e=2*d()-1,f=Math.sqrt(1-e*e)*b;return a[0]=Math.cos(c)*f,a[1]=Math.sin(c)*f,a[2]=e*b,a},g.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12],a[1]=c[1]*d+c[5]*e+c[9]*f+c[13],a[2]=c[2]*d+c[6]*e+c[10]*f+c[14],a},g.transformMat3=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a},g.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},g.forEach=function(){var a=g.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),g.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},"undefined"!=typeof a&&(a.vec3=g);var h={};h.create=function(){var a=new c(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},h.clone=function(a){var b=new c(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},h.fromValues=function(a,b,d,e){var f=new c(4);return f[0]=a,f[1]=b,f[2]=d,f[3]=e,f},h.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},h.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},h.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},h.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},h.sub=h.subtract,h.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},h.mul=h.multiply,h.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},h.div=h.divide,h.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},h.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},h.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},h.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},h.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},h.dist=h.distance,h.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},h.sqrDist=h.squaredDistance,h.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},h.len=h.length,h.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},h.sqrLen=h.squaredLength,h.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},h.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=b[0]*g,a[1]=b[1]*g,a[2]=b[2]*g,a[3]=b[3]*g),a},h.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},h.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},h.random=function(a,b){return b=b||1,a[0]=d(),a[1]=d(),a[2]=d(),a[3]=d(),h.normalize(a,a),h.scale(a,a,b),a},h.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},h.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},h.forEach=function(){var a=h.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),h.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.vec4=h);var i={};i.create=function(){var a=new c(4);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},i.clone=function(a){var b=new c(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},i.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},i.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},i.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2],a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},i.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;return g?(g=1/g,a[0]=f*g,a[1]=-d*g,a[2]=-e*g,a[3]=c*g,a):null},i.adjoint=function(a,b){var c=b[0];return a[0]=b[3],a[1]=-b[1],a[2]=-b[2],a[3]=c,a},i.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},i.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*h+e*j,a[1]=d*i+e*k,a[2]=f*h+g*j,a[3]=f*i+g*k,a},i.mul=i.multiply,i.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=d*-h+e*i,a[2]=f*i+g*h,a[3]=f*-h+g*i,a},i.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*i,a[2]=f*h,a[3]=g*i,a},i.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.mat2=i);var j={};j.create=function(){var a=new c(6);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},j.clone=function(a){var b=new c(6);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b},j.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a},j.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},j.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=c*f-d*e;return i?(i=1/i,a[0]=f*i,a[1]=-d*i,a[2]=-e*i,a[3]=c*i,a[4]=(e*h-f*g)*i,a[5]=(d*g-c*h)*i,a):null},j.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},j.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1],l=c[2],m=c[3],n=c[4],o=c[5];return a[0]=d*j+e*l,a[1]=d*k+e*m,a[2]=f*j+g*l,a[3]=f*k+g*m,a[4]=j*h+l*i+n,a[5]=k*h+m*i+o,a},j.mul=j.multiply,j.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=Math.sin(c),k=Math.cos(c);return a[0]=d*k+e*j,a[1]=-d*j+e*k,a[2]=f*k+g*j,a[3]=-f*j+k*g,a[4]=k*h+j*i,a[5]=k*i-j*h,a},j.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=b[0]*d,a[1]=b[1]*e,a[2]=b[2]*d,a[3]=b[3]*e,a[4]=b[4]*d,a[5]=b[5]*e,a},j.translate=function(a,b,c){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4]+c[0],a[5]=b[5]+c[1],a},j.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},"undefined"!=typeof a&&(a.mat2d=j);var k={};k.create=function(){var a=new c(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},k.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},k.clone=function(a){var b=new c(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},k.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},k.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},k.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},k.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},k.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},k.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},k.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},k.mul=k.multiply,k.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},k.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},k.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},k.fromMat2d=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a},k.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-(m+o),a[3]=k+r,a[6]=l-q,a[1]=k-r,a[4]=1-(j+o),a[7]=n+p,a[2]=l+q,a[5]=n-p,a[8]=1-(j+m),a},k.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},k.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},"undefined"!=typeof a&&(a.mat3=k);var l={};l.create=function(){var a=new c(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.clone=function(a){var b=new c(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},l.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},l.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},l.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},l.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},l.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},l.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},l.mul=l.multiply,l.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},l.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},l.rotate=function(a,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<b?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(d),g=Math.cos(d),h=1-g,i=c[0],j=c[1],k=c[2],l=c[3],m=c[4],n=c[5],o=c[6],p=c[7],q=c[8],r=c[9],s=c[10],t=c[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,c!==a&&(a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]),a)},l.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},l.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},l.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},l.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},l.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-(m+o),a[1]=k+r,a[2]=l-q,a[3]=0,a[4]=k-r,a[5]=1-(j+o),a[6]=n+p,a[7]=0,a[8]=l+q,a[9]=n-p,a[10]=1-(j+m),a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a},l.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},l.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},l.lookAt=function(a,c,d,e){var f,g,h,i,j,k,m,n,o,p,q=c[0],r=c[1],s=c[2],t=e[0],u=e[1],v=e[2],w=d[0],x=d[1],y=d[2];return Math.abs(q-w)<b&&Math.abs(r-x)<b&&Math.abs(s-y)<b?l.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,f=u*o-v*n,g=v*m-t*o,h=t*n-u*m,p=Math.sqrt(f*f+g*g+h*h),p?(p=1/p,f*=p,g*=p,h*=p):(f=0,g=0,h=0),i=n*h-o*g,j=o*f-m*h,k=m*g-n*f,p=Math.sqrt(i*i+j*j+k*k),p?(p=1/p,i*=p,j*=p,k*=p):(i=0,j=0,k=0),a[0]=f,a[1]=i,a[2]=m,a[3]=0,a[4]=g,a[5]=j,a[6]=n,a[7]=0,a[8]=h,a[9]=k,a[10]=o,a[11]=0,a[12]=-(f*q+g*r+h*s),a[13]=-(i*q+j*r+k*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},l.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},"undefined"!=typeof a&&(a.mat4=l);var m={};m.create=function(){var a=new c(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},m.rotationTo=function(){var a=g.create(),b=g.fromValues(1,0,0),c=g.fromValues(0,1,0);return function(d,e,f){var h=g.dot(e,f);return-.999999>h?(g.cross(a,b,e),g.length(a)<1e-6&&g.cross(a,c,e),g.normalize(a,a),m.setAxisAngle(d,a,Math.PI),d):h>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(g.cross(a,e,f),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+h,m.normalize(d,d))}}(),m.setAxes=function(){var a=k.create();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=c[0],a[5]=c[1],a[8]=c[2],m.normalize(b,m.fromMat3(b,a))}}(),m.clone=h.clone,m.fromValues=h.fromValues,m.copy=h.copy,m.set=h.set,m.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},m.setAxisAngle=function(a,b,c){c*=.5;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},m.add=h.add,m.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},m.mul=m.multiply,m.scale=h.scale,m.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},m.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},m.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},m.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},m.dot=h.dot,m.lerp=h.lerp,m.slerp=function(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return f=j*n+k*o+l*p+m*q,0>f&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a},m.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},m.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},m.length=h.length,m.len=m.length,m.squaredLength=h.squaredLength,m.sqrLen=m.squaredLength,m.normalize=h.normalize,m.fromMat3=function(){var a="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(b,c){var d,e=c[0]+c[4]+c[8];if(e>0)d=Math.sqrt(e+1),b[3]=.5*d,d=.5/d,b[0]=(c[7]-c[5])*d,b[1]=(c[2]-c[6])*d,b[2]=(c[3]-c[1])*d;else{var f=0;c[4]>c[0]&&(f=1),c[8]>c[3*f+f]&&(f=2);var g=a[f],h=a[g];d=Math.sqrt(c[3*f+f]-c[3*g+g]-c[3*h+h]+1),b[f]=.5*d,d=.5/d,b[3]=(c[3*h+g]-c[3*g+h])*d,b[g]=(c[3*g+f]+c[3*f+g])*d,b[h]=(c[3*h+f]+c[3*f+h])*d}return b}}(),m.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.quat=m)}(b.exports)}(this);