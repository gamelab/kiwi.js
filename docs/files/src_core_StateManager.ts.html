<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/core/StateManager.ts - Kiwi.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Kiwi.js"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Kiwi.Animations.Animation.html">Kiwi.Animations.Animation</a></li>
            
                <li><a href="../classes/Kiwi.Animations.Sequence.html">Kiwi.Animations.Sequence</a></li>
            
                <li><a href="../classes/Kiwi.Animations.Tween.html">Kiwi.Animations.Tween</a></li>
            
                <li><a href="../classes/Kiwi.Animations.Tweens.Easing.Back.html">Kiwi.Animations.Tweens.Easing.Back</a></li>
            
                <li><a href="../classes/Kiwi.Animations.Tweens.Easing.Bounce.html">Kiwi.Animations.Tweens.Easing.Bounce</a></li>
            
                <li><a href="../classes/Kiwi.Animations.Tweens.Easing.Circular.html">Kiwi.Animations.Tweens.Easing.Circular</a></li>
            
                <li><a href="../classes/Kiwi.Animations.Tweens.Easing.Cubic.html">Kiwi.Animations.Tweens.Easing.Cubic</a></li>
            
                <li><a href="../classes/Kiwi.Animations.Tweens.Easing.Elastic.html">Kiwi.Animations.Tweens.Easing.Elastic</a></li>
            
                <li><a href="../classes/Kiwi.Animations.Tweens.Easing.Exponential.html">Kiwi.Animations.Tweens.Easing.Exponential</a></li>
            
                <li><a href="../classes/Kiwi.Animations.Tweens.Easing.Linear.html">Kiwi.Animations.Tweens.Easing.Linear</a></li>
            
                <li><a href="../classes/Kiwi.Animations.Tweens.Easing.Quadratic.html">Kiwi.Animations.Tweens.Easing.Quadratic</a></li>
            
                <li><a href="../classes/Kiwi.Animations.Tweens.Easing.Quartic.html">Kiwi.Animations.Tweens.Easing.Quartic</a></li>
            
                <li><a href="../classes/Kiwi.Animations.Tweens.Easing.Quintic.html">Kiwi.Animations.Tweens.Easing.Quintic</a></li>
            
                <li><a href="../classes/Kiwi.Animations.Tweens.Easing.Sinusoidal.html">Kiwi.Animations.Tweens.Easing.Sinusoidal</a></li>
            
                <li><a href="../classes/Kiwi.Animations.Tweens.TweenManager.html">Kiwi.Animations.Tweens.TweenManager</a></li>
            
                <li><a href="../classes/Kiwi.Camera.html">Kiwi.Camera</a></li>
            
                <li><a href="../classes/Kiwi.CameraManager.html">Kiwi.CameraManager</a></li>
            
                <li><a href="../classes/Kiwi.Component.html">Kiwi.Component</a></li>
            
                <li><a href="../classes/Kiwi.ComponentManager.html">Kiwi.ComponentManager</a></li>
            
                <li><a href="../classes/Kiwi.Components.AnimationManager.html">Kiwi.Components.AnimationManager</a></li>
            
                <li><a href="../classes/Kiwi.Components.ArcadePhysics.html">Kiwi.Components.ArcadePhysics</a></li>
            
                <li><a href="../classes/Kiwi.Components.Box.html">Kiwi.Components.Box</a></li>
            
                <li><a href="../classes/Kiwi.Components.Input.html">Kiwi.Components.Input</a></li>
            
                <li><a href="../classes/Kiwi.Components.Sound.html">Kiwi.Components.Sound</a></li>
            
                <li><a href="../classes/Kiwi.Entity.html">Kiwi.Entity</a></li>
            
                <li><a href="../classes/Kiwi.Files.DataLibrary.html">Kiwi.Files.DataLibrary</a></li>
            
                <li><a href="../classes/Kiwi.Files.File.html">Kiwi.Files.File</a></li>
            
                <li><a href="../classes/Kiwi.Files.FileStore.html">Kiwi.Files.FileStore</a></li>
            
                <li><a href="../classes/Kiwi.Files.Loader.html">Kiwi.Files.Loader</a></li>
            
                <li><a href="../classes/Kiwi.Game.html">Kiwi.Game</a></li>
            
                <li><a href="../classes/Kiwi.GameManager.html">Kiwi.GameManager</a></li>
            
                <li><a href="../classes/Kiwi.GameObjects.Sprite.html">Kiwi.GameObjects.Sprite</a></li>
            
                <li><a href="../classes/Kiwi.GameObjects.StaticImage.html">Kiwi.GameObjects.StaticImage</a></li>
            
                <li><a href="../classes/Kiwi.GameObjects.Textfield.html">Kiwi.GameObjects.Textfield</a></li>
            
                <li><a href="../classes/Kiwi.GameObjects.Tilemap.TileMap.html">Kiwi.GameObjects.Tilemap.TileMap</a></li>
            
                <li><a href="../classes/Kiwi.GameObjects.Tilemap.TileMapLayer.html">Kiwi.GameObjects.Tilemap.TileMapLayer</a></li>
            
                <li><a href="../classes/Kiwi.GameObjects.Tilemap.TileType.html">Kiwi.GameObjects.Tilemap.TileType</a></li>
            
                <li><a href="../classes/Kiwi.Geom.AABB.html">Kiwi.Geom.AABB</a></li>
            
                <li><a href="../classes/Kiwi.Geom.Circle.html">Kiwi.Geom.Circle</a></li>
            
                <li><a href="../classes/Kiwi.Geom.Intersect.html">Kiwi.Geom.Intersect</a></li>
            
                <li><a href="../classes/Kiwi.Geom.IntersectResult.html">Kiwi.Geom.IntersectResult</a></li>
            
                <li><a href="../classes/Kiwi.Geom.Line.html">Kiwi.Geom.Line</a></li>
            
                <li><a href="../classes/Kiwi.Geom.Matrix.html">Kiwi.Geom.Matrix</a></li>
            
                <li><a href="../classes/Kiwi.Geom.Point.html">Kiwi.Geom.Point</a></li>
            
                <li><a href="../classes/Kiwi.Geom.Ray.html">Kiwi.Geom.Ray</a></li>
            
                <li><a href="../classes/Kiwi.Geom.Rectangle.html">Kiwi.Geom.Rectangle</a></li>
            
                <li><a href="../classes/Kiwi.Geom.Transform.html">Kiwi.Geom.Transform</a></li>
            
                <li><a href="../classes/Kiwi.Geom.Vector2.html">Kiwi.Geom.Vector2</a></li>
            
                <li><a href="../classes/Kiwi.Group.html">Kiwi.Group</a></li>
            
                <li><a href="../classes/Kiwi.HUD.HUDComponents.Counter.html">Kiwi.HUD.HUDComponents.Counter</a></li>
            
                <li><a href="../classes/Kiwi.HUD.HUDComponents.Time.html">Kiwi.HUD.HUDComponents.Time</a></li>
            
                <li><a href="../classes/Kiwi.HUD.HUDComponents.WidgetInput.html">Kiwi.HUD.HUDComponents.WidgetInput</a></li>
            
                <li><a href="../classes/Kiwi.HUD.HUDDisplay.html">Kiwi.HUD.HUDDisplay</a></li>
            
                <li><a href="../classes/Kiwi.HUD.HUDManager.html">Kiwi.HUD.HUDManager</a></li>
            
                <li><a href="../classes/Kiwi.HUD.HUDWidget.html">Kiwi.HUD.HUDWidget</a></li>
            
                <li><a href="../classes/Kiwi.HUD.Widget.Bar.html">Kiwi.HUD.Widget.Bar</a></li>
            
                <li><a href="../classes/Kiwi.HUD.Widget.BasicScore.html">Kiwi.HUD.Widget.BasicScore</a></li>
            
                <li><a href="../classes/Kiwi.HUD.Widget.Button.html">Kiwi.HUD.Widget.Button</a></li>
            
                <li><a href="../classes/Kiwi.HUD.Widget.Icon.html">Kiwi.HUD.Widget.Icon</a></li>
            
                <li><a href="../classes/Kiwi.HUD.Widget.IconBar.html">Kiwi.HUD.Widget.IconBar</a></li>
            
                <li><a href="../classes/Kiwi.HUD.Widget.Menu.html">Kiwi.HUD.Widget.Menu</a></li>
            
                <li><a href="../classes/Kiwi.HUD.Widget.MenuItem.html">Kiwi.HUD.Widget.MenuItem</a></li>
            
                <li><a href="../classes/Kiwi.HUD.Widget.TextField.html">Kiwi.HUD.Widget.TextField</a></li>
            
                <li><a href="../classes/Kiwi.HUD.Widget.Time.html">Kiwi.HUD.Widget.Time</a></li>
            
                <li><a href="../classes/Kiwi.IChild.html">Kiwi.IChild</a></li>
            
                <li><a href="../classes/Kiwi.Input.Finger.html">Kiwi.Input.Finger</a></li>
            
                <li><a href="../classes/Kiwi.Input.InputManager.html">Kiwi.Input.InputManager</a></li>
            
                <li><a href="../classes/Kiwi.Input.Key.html">Kiwi.Input.Key</a></li>
            
                <li><a href="../classes/Kiwi.Input.Keyboard.html">Kiwi.Input.Keyboard</a></li>
            
                <li><a href="../classes/Kiwi.Input.Keycodes.html">Kiwi.Input.Keycodes</a></li>
            
                <li><a href="../classes/Kiwi.Input.Mouse.html">Kiwi.Input.Mouse</a></li>
            
                <li><a href="../classes/Kiwi.Input.MouseCursor.html">Kiwi.Input.MouseCursor</a></li>
            
                <li><a href="../classes/Kiwi.Input.Pointer.html">Kiwi.Input.Pointer</a></li>
            
                <li><a href="../classes/Kiwi.Input.Touch.html">Kiwi.Input.Touch</a></li>
            
                <li><a href="../classes/Kiwi.PluginManager.html">Kiwi.PluginManager</a></li>
            
                <li><a href="../classes/Kiwi.Renderers.CanvasRenderer.html">Kiwi.Renderers.CanvasRenderer</a></li>
            
                <li><a href="../classes/Kiwi.Renderers.GLArrayBuffer.html">Kiwi.Renderers.GLArrayBuffer</a></li>
            
                <li><a href="../classes/Kiwi.Renderers.GLBlendMode.html">Kiwi.Renderers.GLBlendMode</a></li>
            
                <li><a href="../classes/Kiwi.Renderers.GLElementArrayBuffer.html">Kiwi.Renderers.GLElementArrayBuffer</a></li>
            
                <li><a href="../classes/Kiwi.Renderers.GLRenderManager.html">Kiwi.Renderers.GLRenderManager</a></li>
            
                <li><a href="../classes/Kiwi.Renderers.GLTextureManager.html">Kiwi.Renderers.GLTextureManager</a></li>
            
                <li><a href="../classes/Kiwi.Renderers.GLTextureWrapper.html">Kiwi.Renderers.GLTextureWrapper</a></li>
            
                <li><a href="../classes/Kiwi.Renderers.Renderer.html">Kiwi.Renderers.Renderer</a></li>
            
                <li><a href="../classes/Kiwi.Renderers.TextureAtlasRenderer.html">Kiwi.Renderers.TextureAtlasRenderer</a></li>
            
                <li><a href="../classes/Kiwi.Shaders.ShaderManager.html">Kiwi.Shaders.ShaderManager</a></li>
            
                <li><a href="../classes/Kiwi.Shaders.ShaderPair.html">Kiwi.Shaders.ShaderPair</a></li>
            
                <li><a href="../classes/Kiwi.Shaders.TextureAtlasShader.html">Kiwi.Shaders.TextureAtlasShader</a></li>
            
                <li><a href="../classes/Kiwi.Signal.html">Kiwi.Signal</a></li>
            
                <li><a href="../classes/Kiwi.SignalBinding.html">Kiwi.SignalBinding</a></li>
            
                <li><a href="../classes/Kiwi.Sound.Audio.html">Kiwi.Sound.Audio</a></li>
            
                <li><a href="../classes/Kiwi.Sound.AudioLibrary.html">Kiwi.Sound.AudioLibrary</a></li>
            
                <li><a href="../classes/Kiwi.Sound.AudioManager.html">Kiwi.Sound.AudioManager</a></li>
            
                <li><a href="../classes/Kiwi.Stage.html">Kiwi.Stage</a></li>
            
                <li><a href="../classes/Kiwi.State.html">Kiwi.State</a></li>
            
                <li><a href="../classes/Kiwi.StateConfig.html">Kiwi.StateConfig</a></li>
            
                <li><a href="../classes/Kiwi.StateManager.html">Kiwi.StateManager</a></li>
            
                <li><a href="../classes/Kiwi.System.Bootstrap.html">Kiwi.System.Bootstrap</a></li>
            
                <li><a href="../classes/Kiwi.System.Device.html">Kiwi.System.Device</a></li>
            
                <li><a href="../classes/Kiwi.Textures.SingleImage.html">Kiwi.Textures.SingleImage</a></li>
            
                <li><a href="../classes/Kiwi.Textures.SpriteSheet.html">Kiwi.Textures.SpriteSheet</a></li>
            
                <li><a href="../classes/Kiwi.Textures.TextureAtlas.html">Kiwi.Textures.TextureAtlas</a></li>
            
                <li><a href="../classes/Kiwi.Textures.TextureLibrary.html">Kiwi.Textures.TextureLibrary</a></li>
            
                <li><a href="../classes/Kiwi.Time.Clock.html">Kiwi.Time.Clock</a></li>
            
                <li><a href="../classes/Kiwi.Time.ClockManager.html">Kiwi.Time.ClockManager</a></li>
            
                <li><a href="../classes/Kiwi.Time.MasterClock.html">Kiwi.Time.MasterClock</a></li>
            
                <li><a href="../classes/Kiwi.Time.Timer.html">Kiwi.Time.Timer</a></li>
            
                <li><a href="../classes/Kiwi.Time.TimerEvent.html">Kiwi.Time.TimerEvent</a></li>
            
                <li><a href="../classes/Kiwi.Utils.Canvas.html">Kiwi.Utils.Canvas</a></li>
            
                <li><a href="../classes/Kiwi.Utils.Common.html">Kiwi.Utils.Common</a></li>
            
                <li><a href="../classes/Kiwi.Utils.GameMath.html">Kiwi.Utils.GameMath</a></li>
            
                <li><a href="../classes/Kiwi.Utils.RandomDataGenerator.html">Kiwi.Utils.RandomDataGenerator</a></li>
            
                <li><a href="../classes/Kiwi.Utils.RequestAnimationFrame.html">Kiwi.Utils.RequestAnimationFrame</a></li>
            
                <li><a href="../classes/Kiwi.Utils.Version.html">Kiwi.Utils.Version</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Animations.html">Animations</a></li>
            
                <li><a href="../modules/Components.html">Components</a></li>
            
                <li><a href="../modules/Easing.html">Easing</a></li>
            
                <li><a href="../modules/Files.html">Files</a></li>
            
                <li><a href="../modules/GameObjects.html">GameObjects</a></li>
            
                <li><a href="../modules/Geom.html">Geom</a></li>
            
                <li><a href="../modules/HUD.html">HUD</a></li>
            
                <li><a href="../modules/HUDComponents.html">HUDComponents</a></li>
            
                <li><a href="../modules/Input.html">Input</a></li>
            
                <li><a href="../modules/Kiwi.html">Kiwi</a></li>
            
                <li><a href="../modules/Renderers.html">Renderers</a></li>
            
                <li><a href="../modules/Shaders.html">Shaders</a></li>
            
                <li><a href="../modules/Sound.html">Sound</a></li>
            
                <li><a href="../modules/System.html">System</a></li>
            
                <li><a href="../modules/Textures.html">Textures</a></li>
            
                <li><a href="../modules/Tilemap.html">Tilemap</a></li>
            
                <li><a href="../modules/Time.html">Time</a></li>
            
                <li><a href="../modules/Tweens.html">Tweens</a></li>
            
                <li><a href="../modules/Utils.html">Utils</a></li>
            
                <li><a href="../modules/Widget.html">Widget</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/core/StateManager.ts</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
* 
* @module Kiwi
* 
*/  

module Kiwi {

    /**
    * The State Manager handles the starting, parsing, looping and swapping of game States within a Kiwi Game
    * There is only ever one State Manager per game, but a single Game can contain multiple States.
    *
    * @class StateManager
    * @namespace Kiwi
    * @constructor
    * @param game {Kiwi.Game} The game that this statemanager belongs to.
    * @return {Kiwi.StateMananger} 
    *
    */
    export class StateManager {
         
        constructor(game: Kiwi.Game) {

            this._game = game;

            this._states = [];

        }

        /**
        * The type of object this is.
        * @method objType
        * @return {string} &quot;StateManager&quot;
        * @public
        */
        public objType() {
            return &quot;StateManager&quot;;
        }

        /**
        * The game that this manager belongs to.
        * @property _game
        * @type Kiwi.Game
        * @private
        */
        private _game: Kiwi.Game;

        /**
        * An array of all of the states that are contained within this manager.
        * @property _states
        * @type Array
        * @private
        */
        private _states: Kiwi.State[];

        /**
        * The current State that the game is at.
        * @property current
        * @type Kiwi.State
        * @default null
        * @public
        */
        public current: Kiwi.State = null;

        /**
        * The name of the new State that is to be switched to.
        * @property _newStateKey
        * @type string
        * @default null
        * @private
        */
        private _newStateKey: string = null;

        /**
        * Checks to see if a key exists. Internal use only.
        * @method checkKeyExists
        * @param key {String}
        * @return {boolean}
        * @private
        */
        private checkKeyExists(key: string): boolean {

            for (var i = 0; i &lt; this._states.length; i++)
            {
                if (this._states[i].config.name === key)
                {
                    return true;
                }
            }

            return false;

        }

        /**
        * Checks to see if the State passed is valid or not.
        * @method checkValidState
        * @param state {Kiwi.State}
        * @return {boolean}
        * @private
        */
        private checkValidState(state: Kiwi.State): boolean {

            if (!state[&#x27;game&#x27;] || !state[&#x27;config&#x27;]) {
                return false;
            }

            return true;

        }

        /**
        * Adds the given State to the StateManager.
        * The State must have a unique key set on it, or it will fail to be added to the manager.
        * Returns true if added successfully, otherwise false (can happen if State is already in the StateManager)
        * 
        * @method addState
        * @param state {Any} The Kiwi.State instance to add.
        * @param [switchTo=false] {boolean} If set to true automatically switch to the given state after adding it
        * @return {boolean} true if the State was added successfully, otherwise false
        * @public
        */
        public addState(state: any, switchTo:boolean = false): boolean {
            console.log(&#x27;Kiwi.StateManager: Adding state&#x27;);
            var tempState;

            //What type is the state that was passed.
            if (typeof state === &#x27;function&#x27;) {
                tempState = new state();

            } else if (typeof state === &#x27;string&#x27;) {
                tempState = window[state];  

            } else {
                tempState = state;
            }

            //Does a state with that name already exist?
            if (tempState.config.name &amp;&amp; this.checkKeyExists(tempState.config.name) === true) {

                if (this._game.debug)
                    console.error(&#x27;  Kiwi.StateManager: Could not add &#x27; + tempState.config.name + &#x27; as a State with that name already exists.&#x27;);

                return false;
            }

            tempState.game = this._game;
            
            //Is it a valid state?
            if (this.checkValidState(tempState) === false) {

                if (this._game.debug)
                    console.error(&#x27;  Kiwi.StateManager: &#x27; + tempState.config.name + &#x27; isn\&#x27;t a valid state. Make sure you are using the Kiwi.State class!&#x27;);

                return false;

            } else {

                this._states.push(tempState);

                if (this._game.debug)
                    console.log(&#x27;  Kiwi.StateManager: &#x27; + tempState.config.name + &#x27; was successfully added.&#x27;);

                if (switchTo === true) {
                    this.setCurrentState(tempState.config.name);
                }

                return true;

            }

        }

        /**
        * Is executed once the DOM has finished loading.
        * This is an INTERNAL Kiwi method. 
        * @method boot
        * @public
        */
        boot() {                                         

        }

        /**
        * Switches to the name (key) of the state that you pass. 
        * Does not work if the state you are switching to is already the current state OR if that state does not exist yet.
        * @method setCurrentState
        * @param key {String}
        * @return {boolean}
        * @private
        */
        private setCurrentState(key: string): boolean {

            //  Bail out if they are trying to switch to the already current state
            if (this.current !== null &amp;&amp; this.current.config.name === key || this.checkKeyExists(key) === false) {
                return false;
            }

            if (this._game.debug)
                console.log(&#x27;Kiwi.StateManager: Switching to &quot;&#x27; + key + &#x27;&quot; State.&#x27;); 

            this._newStateKey = key;
            return true;
        }

        /**
        * Actually switches to a state that is stored in the &#x27;newStateKey&#x27; property. This method is executed after the update loops have been executed to help prevent developer errors. 
        * @method bootNewState
        * @private
        */
        private bootNewState() {
            
            // Destroy the current if there is one.
            if (this.current !== null) {

                this.current.shutDown();

                
                this._game.input.reset();   //Reset the input component
                this.current.destroy(true); //Destroy ALL IChildren ever created on that state.
                this._game.fileStore.removeStateFiles(this.current); //Clear the fileStore of not global files.
                this.current.config.reset(); //Reset the config setting
                this._game.cameras.zeroAllCameras(); // Reset cameras
            } 


            //Set the current state, reset the key
            this.current = this.getState(this._newStateKey);
            this._newStateKey = null;


            //Initalise the state and execute the preload method?
            this.checkInit();
            this.checkPreload();

        }

        /**
        * Swaps the current state.
        * If the state has already been loaded (via addState) then you can just pass the key.
        * Otherwise you can pass the state object as well and it will load it then swap to it.
        *
        * @method switchState
        * @param key {String} The name/key of the state you would like to switch to.
        * @param [state=null] {Any} The state that you want to switch to. This is only used to create the state if it doesn&#x27;t exist already.
        * @param [initParams=null] {Object} Any parameters that you would like to pass to the init method of that new state.
        * @param [createParams=null] {Object} Any parameters that you would like to pass to the create method of that new state.
        * @return {boolean} Whether the State is going to be switched to or not.
        * @public
        */
        public switchState(key: string, state: any = null, initParams = null, createParams = null): boolean {

            //  If we have a current state that isn&#x27;t yet ready (preload hasn&#x27;t finished) then abort now
            if (this.current !== null &amp;&amp; this.current.config.isReady === false) {

                if(this._game.debug)
                    console.error(&#x27;Kiwi.StateManager: Cannot change to a new state till the current state has finished loading!&#x27;);

                return false;
            }

            // If state key doesn&#x27;t exist then lets add it.
            if (this.checkKeyExists(key) === false &amp;&amp; state !== null) {

                if (this.addState(state, false) === false) {
                    return false;
                }
            }

            // Store the parameters (if any)
            if (initParams !== null || createParams !== null) {

                var newState = this.getState(key);
                newState.config.initParams = [];
                newState.config.createParams = [];

                for (var initParameter in initParams) {
                    newState.config.initParams.push(initParams[initParameter]);
                }

                for (var createParameter in createParams) {
                    newState.config.createParams.push(createParams[createParameter]);
                }

            }
            
            return this.setCurrentState(key);

        }

        /**
        * Gets a state by the key that is passed.
        * @method getState
        * @param key {String}
        * @return {Kiwi.State}
        * @private
        */
        private getState(key: string): Kiwi.State {

            for (var i = 0; i &lt; this._states.length; i++)
            {
                if (this._states[i].config.name === key)
                {
                    return this._states[i];
                }
            }

            return null;

        }


        /*
        *----------------
        * Check Methods 
        *----------------
        */


        /**
        * Checks to see if the state that is being switched to needs to load some files or not.
        * If it does it loads the file, if it does not it runs the create method.
        * @method checkPreload
        * @private
        */
        private checkPreload() {

            //Rebuild the Libraries before the preload is executed
            this.rebuildLibraries();

            this._game.loader.init( (percent, bytes, file) =&gt; this.onLoadProgress(percent, bytes, file), () =&gt; this.onLoadComplete());
            this.current.preload();
            this._game.loader.startLoad();
        }

        /**
        * Checks to see if the state being switched to contains a create method.
        * If it does then it calls the create method.
        * @method callCreate
        * @private
        */
        private callCreate() {

            if (this._game.debug)
                console.log(&quot;Kiwi.StateManager: Calling &quot; + this.current.name + &quot;:Create&quot;);

            //Execute the create with params if there are some there.
            if (this.current.config.createParams) {
                this.current.create.apply(this.current, this.current.config.createParams);

            //Otherwise just execute the method.
            } else {
                this.current.create.call(this.current);
            }

            this.current.config.runCount++;
            this.current.config.isCreated = true;
        }

        /**
        * Checks to see if the state has a init method and then executes that method if it is found.
        * @method checkInit
        * @private
        */
        private checkInit() {
            
            //Has the state already been initialised?
            if (this.current.config.isInitialised === false) {

                //Boot the state.
                this.current.boot();

                //Execute the Init method with params
                if (this.current.config.initParams) {
                    this.current.init.apply(this.current, this.current.config.initParams);

                //Execute the Init method with out params
                } else {
                    this.current.init.call(this.current);
                }

                
                this.current.config.isInitialised = true;
            }

        }

        /**
        * Is execute whilst files are being loaded by the state.
        * @method onLoadProgress
        * @param percent {Number} The current percentage of files that have been loaded. Ranging from 0 - 1.
        * @param bytesLoaded {Number} The number of bytes that have been loaded so far.
        * @param file {Kiwi.Files.File} The last file that has been loaded.
        * @private
        */
        private onLoadProgress(percent: number, bytesLoaded: number, file: Kiwi.Files.File) {

            this.current.loadProgress(percent, bytesLoaded, file);
            
        }

        /**
        * Executed when the preloading has completed. Then executes the loadComplete and create methods of the new State.
        * @method onLoadComplete
        * @private
        */
        private onLoadComplete() {

            this.current.loadComplete();
            
            //Rebuild the Libraries again to have access the new files that were loaded.
            this.rebuildLibraries();
            this.current.config.isReady = true;
            this.callCreate();

        }

        /**
        * Rebuilds the texture, audio and data libraries that are on the current state. Thus updating what files the user has access to.
        * @method rebuildLibraries
        * @public
        */
        public rebuildLibraries() {
            
            this.current.audioLibrary.rebuild(this._game.fileStore, this.current);
            this.current.dataLibrary.rebuild(this._game.fileStore, this.current);
            this.current.textureLibrary.rebuild(this._game.fileStore, this.current);
            if (this._game.renderOption == Kiwi.RENDERER_WEBGL) {
                this._game.renderer.initState(this.current);
            }
        }

        /**
        * The update loop that is accessible on the StateManager.
        * @method update
        * @public
        */
        public update() {

            if (this.current !== null)
            {
                //Is the state ready?
                if (this.current.config.isReady === true)
                {
                    this.current.preUpdate();
                    this.current.update();
                    this.current.postUpdate();
                }
                else
                {
                    this.current.loadUpdate();
                }
            }

            //Do we need to switch states?
            if (this._newStateKey !== null) {
                this.bootNewState();
            }

        }

        /**
        * PostRender - Called after all of the rendering has been executed in a frame.
        * @method postRender
        * @public
        */
        public postRender() {

            if (this.current !== null)
            {
                if (this.current.config.isReady === true)
                {
                    this.current.postRender();
                }
            }

        }

    }

}

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
